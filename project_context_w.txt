Next.js Project Context
Generated On: 2026-02-27 21:39:33
Root: C:\Users\hp\Documents\stage gabriel\SALMA\salma-frontend
===============================================

// FILE: docs/modeling/Salma class diagram detail.puml
-----------------------------------------------
@startuml SALMA_Class_Diagram_V4

skinparam classAttributeIconSize 0
skinparam classFontSize 12
skinparam packageFontSize 13
skinparam linetype polyline
skinparam nodesep 70
skinparam ranksep 60
skinparam padding 5

title **Diagramme de Classes — Projet SALMA v4**\nAG Technologies — Vue d'ensemble validée

' ============================================================
'  AUTH
' ============================================================

package "Authentification" {
  class "Administrateur\n//(AdminUser)//" as Admin
}

' ============================================================
'  MÉDIAS
' ============================================================

package "Médias" {
  class "Fichier Média\n//(MediaAsset)//" as Media
}

' ============================================================
'  BOURSES
' ============================================================

package "Gestion des Bourses" {
  class "Bourse\n//(Scholarship)//" as Scholarship
  class "Domaine d'Études\n//(ScholarshipField)//" as Field
  class "Avantage\n//(ScholarshipBenefit)//" as Benefit
  class "Critère d'Éligibilité\n//(ScholarshipEligibility)//" as Eligibility
  class "Visibilité Champs\n//(FieldVisibility)//" as Visibility
}

Scholarship "1" -down-> "*" Field
Scholarship "1" -down-> "*" Benefit
Scholarship "1" -down-> "*" Eligibility
Scholarship "1" -down-> "*" Visibility
Scholarship "1" --> "1..*" Media : images\n(1 principale\n+ N optionnelles)

' ============================================================
'  DEMANDES DE CONTACT
' ============================================================

package "Demandes de Contact" {
  class "Demande Contact\n//(ContactRequest)//" as Contact
  class "Demande × Bourse\n//(ContactRequestScholarship)//" as ContactScholarship
}

Contact "1" -down-> "*" ContactScholarship
ContactScholarship "*" --> "1" Scholarship

' ============================================================
'  NEWSLETTER & ANNONCES
' ============================================================

package "Newsletter & Annonces" {
  class "Abonné Newsletter\n//(NewsletterSubscriber)//" as Newsletter
  class "Annonce\n//(Announcement)//" as Announcement
  class "Annonce × Bourse\n//(AnnouncementScholarship)//" as AnnouncementScholarship
}

Announcement "1" -down-> "*" AnnouncementScholarship
AnnouncementScholarship "*" --> "1" Scholarship
Announcement "*" --> "0..1" Media : image

' ============================================================
'  TÉMOIGNAGES
' ============================================================

package "Témoignages" {
  class "Témoignage\n//(Testimonial)//" as Testimonial
}

Testimonial "*" --> "0..1" Media : photo client
Testimonial "*" --> "0..1" Media : fichier joint

' ============================================================
'  CHATBOT
' ============================================================

package "Chatbot IA" {
  class "Question FAQ\n//(FaqEntry)//" as Faq
}

' ============================================================
'  CMS
' ============================================================

package "CMS — Contenu du Site" {
  class "Page du Site\n//(SitePage)//" as Page
  class "Bloc de Contenu\n//(ContentBlock)//" as Block
  class "Config Globale\n//(SiteConfig)//" as Config
  class "Vidéo de Pitch\n//(PitchVideo)//" as Video
}

Page "1" -down-> "*" Block
Block "*" --> "0..1" Media : image du bloc
Video "*" --> "0..1" Media : thumbnail

' ============================================================
'  SERVICES
' ============================================================

package "Services" {
  class "Service\n//(Service)//" as Service
}

Service "1" --> "1..*" Media : images\n(1 principale\n+ N optionnelles)

' ============================================================
'  KPI
' ============================================================

package "KPI & Analytics" {
  class "Événement Visiteur\n//(VisitorEvent)//" as Event
  class "Snapshot KPI\n//(KpiSnapshot)//" as Kpi
}

Event "*" --> "0..1" Scholarship : bourse consultée

' ============================================================
'  RELATIONS ADMIN (pointillés)
' ============================================================

Admin ..> Scholarship : gère
Admin ..> Contact : traite
Admin ..> Testimonial : gère
Admin ..> Faq : gère
Admin ..> Block : modifie
Admin ..> Config : configure
Admin ..> Video : gère
Admin ..> Service : gère
Admin ..> Media : uploade
Admin ..> Newsletter : consulte
Admin ..> Visibility : contrôle
Admin ..> Kpi : consulte
Admin ..> Announcement : rédige

@enduml


// END OF FILE: docs/modeling/Salma class diagram detail.puml


// FILE: docs/modeling/Salma class diagram.puml
-----------------------------------------------
@startuml SALMA_Class_Diagram_V4_Detail

skinparam classAttributeIconSize 0
skinparam classFontSize 11
skinparam packageFontSize 13
skinparam linetype polyline
skinparam nodesep 70
skinparam ranksep 50
skinparam padding 5

title **Diagramme de Classes Détaillé — Projet SALMA v4**\nAG Technologies — Version finale

' ============================================================
'  ENUMS
' ============================================================

enum NiveauEtudes {
  LICENCE
  MASTER
  DOCTORAT
  POST_DOC
}

enum StatutBourse {
  OUVERT
  FERME
  URGENT
  EN_ATTENTE
}

enum TypeCouverture {
  TOTALE
  PARTIELLE
  SCOLARITE
  ALLOCATION
}

enum PaysDestination {
  CHINE
  ALLEMAGNE
}

enum TypeAction {
  PAGE_VUE
  CLIC_CTA
  SOUMISSION_FORMULAIRE
  INTERACTION_CHATBOT
  INSCRIPTION_NEWSLETTER
}

enum StatutAnnonce {
  BROUILLON
  PROGRAMME
  ENVOYE
}

enum SourceTemoignage {
  SITE
  WHATSAPP
  EMAIL
}

enum TypeBloc {
  HERO
  TEXTE
  IMAGE
  CTA
  STATS
  BARRE_CONFIANCE
  VIDEO
  TEMOIGNAGES
}

' ============================================================
'  AUTH
' ============================================================

package "Authentification" {
  class "Administrateur\n//(AdminUser)//" as Admin {
    + id : UUID
    + email : String
    + motDePasseHash : String
    + nomComplet : String
    + role : String
    + estActif : Boolean
    + derniereConnexion : DateTime
    + dateCreation : DateTime
  }
}

' ============================================================
'  MÉDIAS
' ============================================================

package "Médias" {
  class "Fichier Média\n//(MediaAsset)//" as Media {
    + id : UUID
    + nomFichier : String
    + urlFichier : String
    + texteAltFr : String {optionnel}
    + texteAltEn : String {optionnel}
    + typeMime : String
    + tailleOctets : Integer
    + dateUpload : DateTime
  }
}

' ============================================================
'  BOURSES
' ============================================================

package "Gestion des Bourses" {
  class "Bourse\n//(Scholarship)//" as Scholarship {
    + id : UUID
    + titreFr : String
    + titreEn : String
    + organismeFr : String
    + organismeEn : String
    + descriptionFr : Text
    + descriptionEn : Text
    + paysDestination : PaysDestination
    + niveau : NiveauEtudes
    + statut : StatutBourse
    + typeCouverture : TypeCouverture
    + dateLimite : Date
    + limiteAge : Integer {optionnel}
    + exigenceLangueFr : String
    + exigenceLangueEn : String
    + detailsMontantFr : String
    + detailsMontantEn : String
    + lienOfficiel : URL {optionnel}
    + estMiseEnAvant : Boolean
    + ordreAffichage : Integer
    + dateCreation : DateTime
    + dateModification : DateTime
  }

  class "Domaine d'Études\n//(ScholarshipField)//" as Field {
    + id : UUID
    + idBourse : UUID
    + nomFr : String
    + nomEn : String
    + icone : String
  }

  class "Avantage\n//(ScholarshipBenefit)//" as Benefit {
    + id : UUID
    + idBourse : UUID
    + libelleFr : String
    + libelleEn : String
    + icone : String
  }

  class "Critère d'Éligibilité\n//(ScholarshipEligibility)//" as Eligibility {
    + id : UUID
    + idBourse : UUID
    + libelleFr : String
    + libelleEn : String
    + icone : String
  }

  class "Visibilité Champs\n//(FieldVisibility)//" as Visibility {
    + id : UUID
    + idBourse : UUID
    + nomDuChamp : String
    + estVisible : Boolean
  }
}

Scholarship "1" -down-> "*" Field
Scholarship "1" -down-> "*" Benefit
Scholarship "1" -down-> "*" Eligibility
Scholarship "1" -down-> "*" Visibility
Scholarship "1" --> "1..*" Media : images\n(1 principale\n+ N optionnelles)

' ============================================================
'  DEMANDES DE CONTACT
' ============================================================

package "Demandes de Contact" {
  class "Demande Contact\n//(ContactRequest)//" as Contact {
    + id : UUID
    + nomComplet : String
    + email : String
    + telephone : String
    + whatsapp : String
    + message : Text
    + accepteNewsletter : Boolean
    + estLu : Boolean
    + notesAdmin : Text {optionnel}
    + dateCreation : DateTime
  }

  class "Demande × Bourse\n//(ContactRequestScholarship)//" as ContactScholarship {
    + id : UUID
    + idDemande : UUID
    + idBourse : UUID
  }
}

Contact "1" -down-> "*" ContactScholarship
ContactScholarship "*" --> "1" Scholarship

' ============================================================
'  NEWSLETTER & ANNONCES
' ============================================================

package "Newsletter & Annonces" {
  class "Abonné Newsletter\n//(NewsletterSubscriber)//" as Newsletter {
    + id : UUID
    + email : String
    + nomComplet : String {optionnel}
    + telephone : String {optionnel}
    + pays : String {optionnel}
    + niveauEtudes : NiveauEtudes {optionnel}
    + destinationSouhaitee : PaysDestination {optionnel}
    + source : String
    + estActif : Boolean
    + dateInscription : DateTime
    + dateDesinscription : DateTime {optionnel}
  }

  class "Annonce\n//(Announcement)//" as Announcement {
    + id : UUID
    + titreFr : String
    + titreEn : String
    + contenuFr : Text
    + contenuEn : Text
    + statut : StatutAnnonce
    + dateEnvoi : DateTime {optionnel}
    + dateCreation : DateTime
  }

  class "Annonce × Bourse\n//(AnnouncementScholarship)//" as AnnouncementScholarship {
    + id : UUID
    + idAnnonce : UUID
    + idBourse : UUID
  }
}

Announcement "1" -down-> "*" AnnouncementScholarship
AnnouncementScholarship "*" --> "1" Scholarship
Announcement "*" --> "0..1" Media : image

' ============================================================
'  TÉMOIGNAGES
' ============================================================

package "Témoignages" {
  class "Témoignage\n//(Testimonial)//" as Testimonial {
    + id : UUID
    + nomAuteur : String
    + paysAuteur : String
    + citationFr : Text
    + citationEn : Text
    + note : Integer
    + source : SourceTemoignage
    + estApprouve : Boolean
    + estAfficheSurSite : Boolean
    + ordreAffichage : Integer
    + dateCreation : DateTime
  }
}

Testimonial "*" --> "0..1" Media : photo client
Testimonial "*" --> "0..1" Media : fichier joint

' ============================================================
'  CHATBOT
' ============================================================

package "Chatbot IA" {
  class "Question FAQ\n//(FaqEntry)//" as Faq {
    + id : UUID
    + questionFr : String
    + questionEn : String
    + reponseFr : Text
    + reponseEn : Text
    + categorie : String
    + ordreAffichage : Integer
    + estActif : Boolean
  }
}

' ============================================================
'  CMS
' ============================================================

package "CMS — Contenu du Site" {
  class "Page du Site\n//(SitePage)//" as Page {
    + id : UUID
    + slug : String
    + titreFr : String
    + titreEn : String
    + estPubliee : Boolean
    + ordreAffichage : Integer
    + dateModification : DateTime
  }

  class "Bloc de Contenu\n//(ContentBlock)//" as Block {
    + id : UUID
    + idPage : UUID
    + cleBloc : String
    + typeBloc : TypeBloc
    + contenuFr : Text
    + contenuEn : Text
    + lienCta : String {optionnel}
    + estVisible : Boolean
    + ordreAffichage : Integer
    + dateModification : DateTime
  }

  class "Config Globale\n//(SiteConfig)//" as Config {
    + id : UUID
    + cleConfig : String
    + valeurFr : Text
    + valeurEn : Text
    + dateModification : DateTime
  }

  class "Vidéo de Pitch\n//(PitchVideo)//" as Video {
    + id : UUID
    + titreFr : String
    + titreEn : String
    + urlVideo : String
    + estActive : Boolean
    + pageAffichage : String
    + dateModification : DateTime
  }
}

Page "1" -down-> "*" Block
Block "*" --> "0..1" Media : image du bloc
Video "*" --> "0..1" Media : thumbnail

' ============================================================
'  SERVICES
' ============================================================

package "Services" {
  class "Service\n//(Service)//" as Service {
    + id : UUID
    + slug : String
    + nomFr : String
    + nomEn : String
    + descriptionFr : Text
    + descriptionEn : Text
    + icone : String
    + delaiTraitement : String {optionnel}
    + estActif : Boolean
    + ordreAffichage : Integer
  }
}

Service "1" --> "1..*" Media : images\n(1 principale\n+ N optionnelles)

' ============================================================
'  KPI
' ============================================================

package "KPI & Analytics" {
  class "Événement Visiteur\n//(VisitorEvent)//" as Event {
    + id : UUID
    + idSession : String
    + typeAction : TypeAction
    + slugPage : String {optionnel}
    + idBourse : UUID {optionnel}
    + referent : String {optionnel}
    + userAgent : String {optionnel}
    + paysIp : String {optionnel}
    + horodatage : DateTime
  }

  class "Snapshot KPI\n//(KpiSnapshot)//" as Kpi {
    + id : UUID
    + date : Date
    + totalVisiteurs : Integer
    + visiteursUniques : Integer
    + pagesVues : Integer
    + clicsCta : Integer
    + soumissionsFormulaire : Integer
    + inscriptionsNewsletter : Integer
    + sessionsChatbot : Integer
    + tauxConversion : Decimal
    + idBourseTop : UUID {optionnel}
  }
}

Event "*" --> "0..1" Scholarship : bourse consultée

' ============================================================
'  RELATIONS ADMIN (pointillés)
' ============================================================

Admin ..> Scholarship : gère
Admin ..> Contact : traite
Admin ..> Testimonial : gère
Admin ..> Faq : gère
Admin ..> Block : modifie
Admin ..> Config : configure
Admin ..> Video : gère
Admin ..> Service : gère
Admin ..> Media : uploade
Admin ..> Newsletter : consulte
Admin ..> Visibility : contrôle
Admin ..> Kpi : consulte
Admin ..> Announcement : rédige

@enduml


// END OF FILE: docs/modeling/Salma class diagram.puml


// FILE: docs/modeling/Salma contrats api.md
-----------------------------------------------
# Contrats d'API — Projet SALMA
## AG Technologies — Document de référence

---

## 1. AUTH — `/api/auth`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/auth/login` | Connexion → retourne le token | Non |
| POST | `/api/auth/logout` | Déconnexion → invalide le token | Oui |
| POST | `/api/auth/register` | Créer un compte admin | Oui (super admin) |
| GET | `/api/auth/me` | Récupérer son profil | Oui |
| PUT | `/api/auth/me` | Modifier son profil complet | Oui |
| PATCH | `/api/auth/me` | Modifier partiellement son profil | Oui |
| PUT | `/api/auth/change-password` | Modifier son mot de passe | Oui |
| POST | `/api/auth/reset-password` | Demander réinitialisation par email | Non |
| POST | `/api/auth/reset-password/confirm` | Confirmer nouveau mot de passe | Non |

---

## 2. BOURSES

### 2.1 Publique — `/api/bourses`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/bourses` | Liste avec filtres (pays, niveau, couverture, statut, recherche) | Non |
| GET | `/api/bourses/mise-en-avant` | Bourses à la une | Non |
| GET | `/api/bourses/{id}` | Fiche détaillée (visibilité appliquée) | Non |

### 2.2 Admin — `/api/admin/bourses`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/bourses` | Liste complète (tous champs) | Oui |
| GET | `/api/admin/bourses/{id}` | Détail complet | Oui |
| POST | `/api/admin/bourses` | Créer une bourse | Oui |
| PUT | `/api/admin/bourses/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/bourses/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/bourses/{id}` | Supprimer | Oui |
| PUT | `/api/admin/bourses/{id}/visibilite` | Modifier la visibilité complète | Oui |
| PATCH | `/api/admin/bourses/{id}/visibilite` | Modifier partiellement la visibilité | Oui |
| PUT | `/api/admin/bourses/{id}/mise-en-avant` | Activer/désactiver mise en avant | Oui |

#### Domaines d'études

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/admin/bourses/{id}/domaines` | Ajouter un domaine | Oui |
| PUT | `/api/admin/bourses/{id}/domaines/{domId}` | Modifier complètement | Oui |
| PATCH | `/api/admin/bourses/{id}/domaines/{domId}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/bourses/{id}/domaines/{domId}` | Supprimer | Oui |

#### Avantages

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/admin/bourses/{id}/avantages` | Ajouter un avantage | Oui |
| PUT | `/api/admin/bourses/{id}/avantages/{avId}` | Modifier complètement | Oui |
| PATCH | `/api/admin/bourses/{id}/avantages/{avId}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/bourses/{id}/avantages/{avId}` | Supprimer | Oui |

#### Critères d'éligibilité

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/admin/bourses/{id}/criteres` | Ajouter un critère | Oui |
| PUT | `/api/admin/bourses/{id}/criteres/{crId}` | Modifier complètement | Oui |
| PATCH | `/api/admin/bourses/{id}/criteres/{crId}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/bourses/{id}/criteres/{crId}` | Supprimer | Oui |

#### Images

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/admin/bourses/{id}/images` | Ajouter une image | Oui |
| DELETE | `/api/admin/bourses/{id}/images/{imgId}` | Supprimer une image | Oui |
| PUT | `/api/admin/bourses/{id}/images/{imgId}/principale` | Définir comme image principale | Oui |

---

## 3. DEMANDES DE CONTACT

### 3.1 Publique — `/api/contact`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/contact` | Soumettre une demande (+ bourses optionnelles + accepte newsletter) | Non |

### 3.2 Admin — `/api/admin/contacts`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/contacts` | Liste des demandes (filtres : lu/non lu, date) | Oui |
| GET | `/api/admin/contacts/{id}` | Détail avec bourses associées | Oui |
| PATCH | `/api/admin/contacts/{id}` | Marquer lu, ajouter notes | Oui |
| DELETE | `/api/admin/contacts/{id}` | Supprimer | Oui |

---

## 4. NEWSLETTER & ANNONCES

### 4.1 Publique — `/api/newsletter`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/newsletter/inscription` | S'inscrire (email obligatoire, reste optionnel) | Non |
| POST | `/api/newsletter/desinscription` | Se désinscrire | Non |

### 4.2 Admin Abonnés — `/api/admin/newsletter`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/newsletter/abonnes` | Liste des abonnés (filtres : actif, pays, niveau) | Oui |
| GET | `/api/admin/newsletter/abonnes/{id}` | Détail d'un abonné | Oui |
| DELETE | `/api/admin/newsletter/abonnes/{id}` | Supprimer un abonné | Oui |

### 4.3 Admin Annonces — `/api/admin/annonces`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/annonces` | Liste des annonces | Oui |
| GET | `/api/admin/annonces/{id}` | Détail avec bourses liées | Oui |
| POST | `/api/admin/annonces` | Créer une annonce (brouillon) | Oui |
| PUT | `/api/admin/annonces/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/annonces/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/annonces/{id}` | Supprimer | Oui |
| POST | `/api/admin/annonces/{id}/envoyer` | Envoyer à tous les abonnés actifs | Oui |

---

## 5. TÉMOIGNAGES

### 5.1 Publique — `/api/temoignages`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/temoignages` | Liste des témoignages approuvés et affichés | Non |
| POST | `/api/temoignages` | Soumettre un témoignage (formulaire site ou lien email) | Non |

### 5.2 Admin — `/api/admin/temoignages`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/temoignages` | Liste complète (approuvés + en attente) | Oui |
| GET | `/api/admin/temoignages/{id}` | Détail | Oui |
| POST | `/api/admin/temoignages` | Créer manuellement (depuis WhatsApp/mail) | Oui |
| PUT | `/api/admin/temoignages/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/temoignages/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/temoignages/{id}` | Supprimer | Oui |

---

## 6. CHATBOT IA

### 6.1 Publique — `/api/chatbot`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/chatbot/message` | Envoyer une question → Gemini répond via FAQ | Non |

### 6.2 Admin FAQ — `/api/admin/faq`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/faq` | Liste des FAQ | Oui |
| GET | `/api/admin/faq/{id}` | Détail | Oui |
| POST | `/api/admin/faq` | Créer une question/réponse | Oui |
| PUT | `/api/admin/faq/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/faq/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/faq/{id}` | Supprimer | Oui |

---

## 7. CMS — CONTENU DU SITE

### 7.1 Publique — `/api`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/pages` | Liste des pages publiées | Non |
| GET | `/api/pages/{slug}` | Contenu complet d'une page (blocs visibles) | Non |
| GET | `/api/config` | Configurations globales | Non |
| GET | `/api/videos` | Vidéos de pitch actives | Non |

### 7.2 Admin Pages — `/api/admin/pages`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/pages` | Liste de toutes les pages | Oui |
| GET | `/api/admin/pages/{id}` | Détail avec tous les blocs | Oui |
| POST | `/api/admin/pages` | Créer une page | Oui |
| PUT | `/api/admin/pages/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/pages/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/pages/{id}` | Supprimer | Oui |

#### Blocs de contenu

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/admin/pages/{id}/blocs` | Ajouter un bloc | Oui |
| PUT | `/api/admin/pages/{id}/blocs/{blocId}` | Modifier complètement | Oui |
| PATCH | `/api/admin/pages/{id}/blocs/{blocId}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/pages/{id}/blocs/{blocId}` | Supprimer | Oui |

### 7.3 Admin Config — `/api/admin/config`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/config` | Liste de toutes les configs | Oui |
| POST | `/api/admin/config` | Créer une config | Oui |
| PUT | `/api/admin/config/{cle}` | Modifier complètement | Oui |
| PATCH | `/api/admin/config/{cle}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/config/{cle}` | Supprimer | Oui |

### 7.4 Admin Vidéos — `/api/admin/videos`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/videos` | Liste des vidéos | Oui |
| GET | `/api/admin/videos/{id}` | Détail | Oui |
| POST | `/api/admin/videos` | Ajouter une vidéo | Oui |
| PUT | `/api/admin/videos/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/videos/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/videos/{id}` | Supprimer | Oui |

---

## 8. SERVICES

### 8.1 Publique — `/api/services`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/services` | Liste des services actifs | Non |
| GET | `/api/services/{slug}` | Détail d'un service | Non |

### 8.2 Admin — `/api/admin/services`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/services` | Liste complète | Oui |
| GET | `/api/admin/services/{id}` | Détail | Oui |
| POST | `/api/admin/services` | Créer | Oui |
| PUT | `/api/admin/services/{id}` | Modifier complètement | Oui |
| PATCH | `/api/admin/services/{id}` | Modifier partiellement | Oui |
| DELETE | `/api/admin/services/{id}` | Supprimer | Oui |

#### Images

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/admin/services/{id}/images` | Ajouter une image | Oui |
| DELETE | `/api/admin/services/{id}/images/{imgId}` | Supprimer une image | Oui |
| PUT | `/api/admin/services/{id}/images/{imgId}/principale` | Définir comme image principale | Oui |

---

## 9. MÉDIAS

### Admin uniquement — `/api/admin/medias`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/medias` | Bibliothèque de fichiers | Oui |
| GET | `/api/admin/medias/{id}` | Détail d'un fichier | Oui |
| POST | `/api/admin/medias` | Uploader un fichier | Oui |
| PATCH | `/api/admin/medias/{id}` | Modifier les métadonnées | Oui |
| DELETE | `/api/admin/medias/{id}` | Supprimer | Oui |

---

## 10. KPI & ANALYTICS

### 10.1 Publique — `/api/evenements`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/evenements` | Enregistrer un événement visiteur | Non |

### 10.2 Admin — `/api/admin/kpi`

| Méthode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/admin/kpi/snapshots` | Liste des snapshots (filtres : période) | Oui |
| GET | `/api/admin/kpi/snapshots/{date}` | Snapshot d'une date | Oui |
| GET | `/api/admin/kpi/temps-reel` | Stats en temps réel | Oui |
| GET | `/api/admin/kpi/conversion` | Taux de conversion (global + par bourse) | Oui |
| GET | `/api/admin/kpi/evenements` | Événements bruts (filtres : type, page, bourse, période) | Oui |

---

## Récapitulatif

| Module | Endpoints publics | Endpoints admin | Total |
|--------|:-:|:-:|:-:|
| Auth | 2 | 7 | 9 |
| Bourses | 3 | 22 | 25 |
| Contact | 1 | 4 | 5 |
| Newsletter & Annonces | 2 | 10 | 12 |
| Témoignages | 2 | 6 | 8 |
| Chatbot | 1 | 5 | 6 |
| CMS | 3 | 17 | 20 |
| Services | 2 | 9 | 11 |
| Médias | 0 | 5 | 5 |
| KPI | 1 | 5 | 6 |
| **TOTAL** | **17** | **90** | **107** |

// END OF FILE: docs/modeling/Salma contrats api.md


// FILE: docs/specifications/remarques_clients_sur_le_prototype.md
-----------------------------------------------
# Remarques Client — Projet SALMA
## AG Technologies — Liste complète

---

## 1. UI/UX & Design

- [ ] Le mode thème sombre n'est pas encore fonctionnel
- [ ] L'application doit être responsive
- [ ] Les images doivent être de qualité supérieure
- [ ] Améliorer les effets sur le site : animations, hover, descriptions au survol — bref l'expérience utilisateur
- [ ] Changer la photo sur la page d'accueil pour une photo plus claire
- [ ] Ce n'est pas une agence de voyage donc retirer "Travel Agency" sur la navbar

---

## 2. Modèle de Données & Bourses

- [ ] Bien concevoir les infos d'une bourse afin que le modèle de données soit exhaustif et complet
- [ ] Pour chaque champ d'une bourse, l'admin doit pouvoir dire si le champ s'affiche ou pas (tous les champs existent en BD)
- [ ] Une bourse a une image principale
- [ ] Pas de prix sur le site client — infos minimales — mais l'admin peut mettre s'il veut
- [ ] On doit publier le minimum d'infos pour intéresser mais inciter les clients à contacter l'entreprise pour en savoir plus (le but est de vendre ces infos)

---

## 3. Administration & CMS

- [ ] Chaque champ du frontend de chaque page doit être directement définissable via le dashboard admin, de sorte que le boss contrôle complètement chaque info du site et peut le mettre à jour sans avoir besoin du dev
- [ ] Le dashboard admin doit permettre une administration complète

---

## 4. KPI & Analytics

- [ ] Mettre en place des KPI dans le backend pour évaluer le taux de conversion et avoir les statistiques en temps réel

---

## 5. Cookies & Confidentialité

- [ ] Mettre en place la gestion des cookies et la politique de confidentialité

---

## 6. Newsletter & Collecte de Prospects

- [ ] Mettre en place une newsletter et un mécanisme pour récolter les emails et un maximum d'infos sur les visiteurs afin d'avoir une base de prospects à convertir

---

## 7. Retours Clients

- [ ] Mettre en place un système pour les retours clients (témoignages)

---

## 8. Chatbot IA

- [ ] Puisque le chatbot WhatsApp arrivera après, intégrer d'abord Gemini qui va simuler le chatbot
- [ ] L'objectif du chatbot est de répondre en langage naturel à une suite de questions fournies en BD
- [ ] Si le chatbot n'a pas la réponse → inciter le client à contacter l'entreprise
- [ ] Le chatbot doit inciter à prendre rendez-vous

---

## 9. Vidéo de Pitch

- [ ] Intégrer une vidéo de pitch sur le site — courte mais convaincante

---

## 10. Candidatures & Rendez-vous

- [ ] Gestion des candidatures et demandes de contact
- [ ] Après qu'un client ait programmé un rendez-vous avec l'agence, notifier l'agence par mail, WhatsApp et sur le site

---

## 11. Stratégie de Conversion

- [ ] On doit intéresser les visiteurs puis les convertir — au rendez-vous on pourra vendre
- [ ] Le site doit donner envie de contacter l'entreprise pour en savoir plus, pas tout dévoiler

// END OF FILE: docs/specifications/remarques_clients_sur_le_prototype.md


// FILE: docs/specifications/vision-project.md
-----------------------------------------------
# 🌍 Vision Stratégique & Architecture — Plateforme SALMA

Ce document définit les piliers techniques et fonctionnels de la plateforme SALMA (by AG Technologies) pour répondre aux exigences de performance, de conversion et de prestige de l'agence.

## 1. Quelle est la particularité de ce site ?
Contrairement aux sites de voyage classiques, SALMA se positionne comme une **plateforme de confiance et de réussite**. 
- **Focus Résultat :** Mise en avant de la garantie "Satisfait ou Remboursé" et des preuves sociales (Success Stories).
- **Spécialisation :** Une expérience utilisateur (UX) segmentée spécifiquement pour les corridors **Chine** et **Allemagne**, respectant les codes académiques de ces deux pays.

## 2. Interface & UX (Expérience Utilisateur)
L'interface est conçue pour réduire la charge cognitive et maximiser l'engagement :
- **Mobile-First :** 80% des étudiants consultent sur smartphone. L'interface est pensée comme une application mobile native.
- **Design Émotionnel :** Utilisation de la charte Bordeaux Royal et Or pour instaurer un sentiment de prestige et d'accessibilité au succès.
- **Micro-interactions :** Animations fluides pour guider l'œil vers les actions prioritaires (CTAs).

## 3. Structure de la Plateforme
Le site est structuré selon un **entonnoir de conversion** :
1. **Découverte (Home) :** Rassurer sur l'expertise d'AG Technologies.
2. **Exploration (Catalogue) :** Permettre un choix rapide via des filtres intelligents.
3. **Information (Détail Bourse) :** Lever tous les doutes (conditions, avantages, délais).
4. **Action (Conversion) :** Formulaire de contact simplifié et lien direct WhatsApp.

## 4. Architecture Technique (Stack Ingénieur)
Nous utilisons une architecture **"Headless"** pour une séparation totale des responsabilités :
- **Frontend :** Next.js 15 (App Router). Permet un référencement (SEO) optimal et une vitesse de navigation instantanée grâce au rendu hybride.
- **Backend :** Django REST Framework. Garantit une sécurité bancaire des données et une gestion robuste des bourses en interne.
- **API :** Communication via JSON, permettant de faire évoluer le site ou de créer une application mobile future sans changer le backend.

## 5. Gestion des Données (Data Management)
- **Centralisation :** Toutes les bourses sont gérées en un seul endroit par l'administrateur.
- **Performance :** Utilisation d'un système de mise en cache intelligent (ISR) : le site se met à jour instantanément dès qu'une bourse est modifiée en admin, sans ralentir l'utilisateur.

## 6. Fluidité & Optimisation
- **Zéro Latence :** Optimisation des images (Next/Image) et des scripts pour obtenir un score de performance proche de 100 sur Google Lighthouse.
- **Accessibilité :** Site fluide même avec une connexion internet instable (optimisation des paquets de données).

## 7. Chatbot & Assistance
- **WhatsApp Intelligent :** Intégration d'un bouton flottant qui pré-remplit le message en fonction de la page consultée (ex: *"Bonjour SALMA, je suis intéressé par la bourse Master en Allemagne..."*).
- **Assistant IA (Évolutif) :** Structure prête pour l'intégration d'un agent IA capable de répondre aux questions sur les procédures de visa 24h/24.

## 8. Caractère Innovateur & Conversion
L'innovation majeure est le **"Scholarship Matcher"** :
- Un outil interactif qui permet à l'étudiant de trouver sa bourse idéale en 3 clics (Niveau, Budget, Pays). 
- **Impact :** Transforme un visiteur passif en un prospect qualifié, augmentant radicalement le taux de conversion par rapport à une simple liste statique.

---
**AG Technologies — L'excellence au service de votre mobilité internationale.**

// END OF FILE: docs/specifications/vision-project.md


// FILE: src/app/(admin)/admin/dashboard/page.tsx
-----------------------------------------------
"use client";

import { useState, useEffect, useCallback } from "react";
import { scholarshipDictionary } from "@/dictionaries/data";
import AddScholarshipModal from "@/components/admin/AddScholarshipModal";
import type { ScholarshipAdmin, ScholarshipFilters, ScholarshipCountry } from "@/types";

export default function AdminDashboard() {
  // FIX : Retrait de 'dictionary' non utilisé
  const [scholarships, setScholarships] = useState<ScholarshipAdmin[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingId, setEditingId] = useState<string | null>(null);
  
  const [filters, setFilters] = useState<ScholarshipFilters>({ search: "", pays_destination: undefined });

  const fetchScholarships = useCallback(async () => {
    setIsLoading(true);
    try {
      const data = await scholarshipDictionary.admin.getList(filters);
      setScholarships(data.results);
    } catch (error) {
      console.error("Erreur:", error);
    } finally {
      setIsLoading(false);
    }
  }, [filters]);

  useEffect(() => { fetchScholarships(); }, [fetchScholarships]);

  return (
    <div className="p-8 space-y-6 animate-fade-in">
      <div className="flex justify-between items-end">
        <div className="space-y-4">
          <h2 className="text-2xl font-serif font-bold text-salma-primary">Gestion des Bourses</h2>
          <div className="flex gap-4">
            <input 
              type="text" 
              placeholder="Rechercher..." 
              className="px-4 py-2 border border-salma-border rounded-lg bg-white text-sm outline-none focus:border-salma-gold w-64"
              onChange={(e) => setFilters(f => ({ ...f, search: e.target.value }))}
            />
            <select 
              className="px-4 py-2 border border-salma-border rounded-lg bg-white text-sm outline-none"
              // FIX : Typage explicite du HTMLSelectElement et du cast de valeur
              onChange={(e: React.ChangeEvent<HTMLSelectElement>) => 
                setFilters(f => ({ ...f, pays_destination: (e.target.value as ScholarshipCountry) || undefined }))
              }
            >
              <option value="">Tous les pays</option>
              <option value="chine">Chine</option>
              <option value="allemagne">Allemagne</option>
            </select>
          </div>
        </div>
        <button 
          onClick={() => { setEditingId(null); setIsModalOpen(true); }}
          className="bg-salma-primary text-white px-6 py-3 rounded-xl font-bold hover:bg-salma-primary-light transition-all shadow-salma-md"
        >
          + Ajouter une bourse
        </button>
      </div>

      <div className="bg-white border border-salma-border rounded-2xl shadow-sm overflow-hidden">
        <table className="w-full text-left text-sm">
          <thead className="bg-salma-bg border-b border-salma-border text-salma-text-muted uppercase text-[10px] font-bold tracking-widest">
            <tr>
              <th className="p-5">Titre (FR)</th>
              <th className="p-5">Pays</th>
              <th className="p-5">Niveau</th>
              <th className="p-5">Visibilité</th>
              <th className="p-5 text-right">Actions</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-salma-border">
            {isLoading ? (
               <tr><td colSpan={5} className="p-10 text-center animate-pulse text-salma-text-muted">Synchronisation avec le serveur...</td></tr>
            ) : scholarships.map((s) => (
              <tr key={s.id} className="hover:bg-salma-bg/30 transition-colors group">
                <td className="p-5 font-bold text-salma-primary">{s.titre_fr}</td>
                <td className="p-5 uppercase text-xs">{s.pays_destination}</td>
                <td className="p-5 capitalize">{s.niveau}</td>
                <td className="p-5">
                   <div className="flex gap-1">
                      {s.visibilites.filter(v => v.est_visible).length} / {s.visibilites.length} champs
                   </div>
                </td>
                <td className="p-5 text-right">
                  <button 
                    onClick={() => { setEditingId(s.id); setIsModalOpen(true); }}
                    className="text-salma-gold hover:text-salma-primary font-bold mr-4 transition-colors"
                  >
                    Éditer
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {isModalOpen && (
        <AddScholarshipModal 
          isOpen={isModalOpen} 
          onClose={() => { setIsModalOpen(false); setEditingId(null); }} 
          onSave={fetchScholarships}
          scholarshipId={editingId} 
        />
      )}
    </div>
  );
}

// END OF FILE: src/app/(admin)/admin/dashboard/page.tsx


// FILE: src/app/(admin)/admin/login/page.tsx
-----------------------------------------------
// src/app/(admin)/admin/login/page.tsx
// ==============================================================================
//  Page Login Admin — /admin/login
//  Design : Bordeaux #6B1E2E + Or #C9A84C, sobre et professionnel
// ==============================================================================
"use client";

import { useState, useEffect } from "react";
import { useRouter, useSearchParams } from "next/navigation";
import { useAuth } from "@/hooks/useAuth";
import type { LoginPayload } from "@/types/api/auth.types";

export default function AdminLoginPage() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { login, isLoading, isAuthenticated, error, clearError } = useAuth();

  const [form, setForm] = useState<LoginPayload>({ email: "", password: "" });
  const [showPassword, setShowPassword] = useState(false);

  // Si déjà connecté → rediriger immédiatement
  useEffect(() => {
    if (isAuthenticated) {
      const redirect = searchParams.get("redirect") || "/admin/dashboard";
      router.replace(redirect);
    }
  }, [isAuthenticated, router, searchParams]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    clearError();
    setForm((prev) => ({ ...prev, [e.target.name]: e.target.value }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!form.email || !form.password) return;

    const redirect = searchParams.get("redirect") || "/admin/dashboard";
    await login(form, redirect).catch(() => {
      // L'erreur est déjà dans le state via useAuth
    });
  };

  return (
    <div className="min-h-screen bg-salma-bg flex items-center justify-center p-4">
      {/* Fond décoratif */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        <div className="absolute -top-40 -right-40 w-96 h-96 bg-salma-primary/5 rounded-full blur-3xl" />
        <div className="absolute -bottom-40 -left-40 w-96 h-96 bg-salma-gold/5 rounded-full blur-3xl" />
      </div>

      <div className="relative w-full max-w-md">
        {/* Card */}
        <div className="bg-salma-surface border border-salma-border rounded-2xl shadow-salma-lg overflow-hidden">
          
          {/* Header bordeaux */}
          <div className="bg-salma-primary px-8 py-10 text-center">
            <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/10 mb-4">
              <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5}
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </div>
            <h1 className="text-2xl font-serif font-bold text-white leading-tight">SALMA</h1>
            <p className="text-[11px] uppercase tracking-[0.35em] text-salma-gold mt-1 font-sans font-semibold">
              Espace Administration
            </p>
          </div>

          {/* Formulaire */}
          <div className="px-8 py-8">
            <p className="text-sm text-salma-text-muted text-center mb-6">
              Connectez-vous pour accéder au tableau de bord
            </p>

            {/* Message d'erreur */}
            {error && (
              <div className="mb-5 flex items-start gap-3 p-3.5 bg-red-50 border border-red-200 rounded-xl">
                <svg className="w-4 h-4 text-red-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd"/>
                </svg>
                <p className="text-sm text-red-700">{error}</p>
              </div>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              {/* Email */}
              <div>
                <label htmlFor="email" className="block text-xs font-semibold uppercase tracking-widest text-salma-text-muted mb-2">
                  Adresse email
                </label>
                <input
                  id="email"
                  name="email"
                  type="email"
                  autoComplete="email"
                  required
                  value={form.email}
                  onChange={handleChange}
                  placeholder="admin@salma.cm"
                  className="w-full px-4 py-3 rounded-xl bg-salma-bg border border-salma-border text-salma-text placeholder:text-salma-text-muted/50 text-sm outline-none focus:border-salma-primary focus:ring-2 focus:ring-salma-primary/10 transition-all"
                />
              </div>

              {/* Mot de passe */}
              <div>
                <label htmlFor="password" className="block text-xs font-semibold uppercase tracking-widest text-salma-text-muted mb-2">
                  Mot de passe
                </label>
                <div className="relative">
                  <input
                    id="password"
                    name="password"
                    type={showPassword ? "text" : "password"}
                    autoComplete="current-password"
                    required
                    value={form.password}
                    onChange={handleChange}
                    placeholder="••••••••"
                    className="w-full px-4 py-3 pr-12 rounded-xl bg-salma-bg border border-salma-border text-salma-text placeholder:text-salma-text-muted/50 text-sm outline-none focus:border-salma-primary focus:ring-2 focus:ring-salma-primary/10 transition-all"
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-4 top-1/2 -translate-y-1/2 text-salma-text-muted hover:text-salma-text transition-colors"
                  >
                    {showPassword ? (
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                      </svg>
                    ) : (
                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                    )}
                  </button>
                </div>
              </div>

              {/* Bouton submit */}
              <button
                type="submit"
                disabled={isLoading || !form.email || !form.password}
                className="w-full mt-2 py-3.5 rounded-xl bg-salma-primary hover:bg-salma-primary/90 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold text-sm tracking-wide transition-all flex items-center justify-center gap-2 shadow-md shadow-salma-primary/20"
              >
                {isLoading ? (
                  <>
                    <svg className="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
                    </svg>
                    Connexion...
                  </>
                ) : (
                  "Se connecter"
                )}
              </button>
            </form>

            {/* Lien reset password */}
            <p className="text-center mt-5 text-xs text-salma-text-muted">
              Mot de passe oublié ?{" "}
              <span className="text-salma-primary hover:underline cursor-pointer font-medium">
                Contacter l&apos;administrateur
              </span>
            </p>
          </div>
        </div>

        {/* Footer */}
        <p className="text-center mt-6 text-xs text-salma-text-muted/50">
          © 2026 SALMA · AG Technologies
        </p>
      </div>
    </div>
  );
}


// END OF FILE: src/app/(admin)/admin/login/page.tsx


// FILE: src/app/(admin)/admin/layout.tsx
-----------------------------------------------
// src/app/(admin)/admin/layout.tsx
// ==============================================================================
//  Layout Admin — protégé par JWT
//  Sidebar avec toutes les sections + badge notifications contacts
// ==============================================================================
"use client";

import { useEffect } from "react";
import Link from "next/link";
import { usePathname, useRouter } from "next/navigation";
import { useAuth } from "@/hooks/useAuth";

// Icônes SVG inline légères
const Icons = {
  dashboard: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
    </svg>
  ),
  scholarship: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
    </svg>
  ),
  cms: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
  ),
  media: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
    </svg>
  ),
  contact: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
    </svg>
  ),
  newsletter: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
    </svg>
  ),
  testimonial: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
    </svg>
  ),
  chatbot: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
    </svg>
  ),
  kpi: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
    </svg>
  ),
  logout: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
    </svg>
  ),
  site: (
    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.8} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
    </svg>
  ),
};

const NAV_SECTIONS = [
  {
    label: "Principal",
    items: [
      { href: "/admin/dashboard", label: "Tableau de bord", icon: Icons.dashboard },
      { href: "/admin/bourses", label: "Bourses", icon: Icons.scholarship },
      { href: "/admin/contacts", label: "Contacts & RDV", icon: Icons.contact, badge: true },
    ],
  },
  {
    label: "Contenu",
    items: [
      { href: "/admin/cms", label: "Pages & CMS", icon: Icons.cms },
      { href: "/admin/medias", label: "Médiathèque", icon: Icons.media },
      { href: "/admin/temoignages", label: "Témoignages", icon: Icons.testimonial },
      { href: "/admin/newsletter", label: "Newsletter", icon: Icons.newsletter },
    ],
  },
  {
    label: "Intelligence",
    items: [
      { href: "/admin/chatbot", label: "Chatbot / FAQ", icon: Icons.chatbot },
      { href: "/admin/kpi", label: "KPI & Analytics", icon: Icons.kpi },
    ],
  },
];

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  const pathname = usePathname();
  const router = useRouter();
  const { user, isLoading, isAuthenticated, logout } = useAuth();

  // Guard : rediriger vers login si non authentifié
  useEffect(() => {
    if (!isLoading && !isAuthenticated) {
      router.replace(`/admin/login?redirect=${pathname}`);
    }
  }, [isLoading, isAuthenticated, router, pathname]);

  // Affichage pendant le chargement de l'auth
  if (isLoading) {
    return (
      <div className="min-h-screen bg-salma-bg flex items-center justify-center">
        <div className="flex flex-col items-center gap-4">
          <div className="w-10 h-10 border-2 border-salma-primary border-t-transparent rounded-full animate-spin" />
          <p className="text-sm text-salma-text-muted">Vérification des accès...</p>
        </div>
      </div>
    );
  }

  if (!isAuthenticated) return null;

  const isActive = (href: string) =>
    pathname === href || pathname.startsWith(href + "/");

  return (
    <div className="min-h-screen bg-salma-bg flex">

      {/* ── Sidebar ──────────────────────────────────────────────────── */}
      <aside className="w-64 bg-salma-surface border-r border-salma-border flex flex-col fixed inset-y-0 left-0 z-30 hidden md:flex">

        {/* Logo */}
        <div className="h-16 flex items-center gap-3 px-5 border-b border-salma-border flex-shrink-0">
          <div className="w-8 h-8 rounded-lg bg-salma-primary flex items-center justify-center flex-shrink-0">
            <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l9-5-9-5-9 5 9 5z" />
            </svg>
          </div>
          <div>
            <span className="text-base font-serif font-bold text-salma-primary leading-none block">SALMA</span>
            <span className="text-[9px] uppercase tracking-[0.3em] text-salma-gold font-sans font-bold">Admin</span>
          </div>
        </div>

        {/* Navigation */}
        <nav className="flex-1 overflow-y-auto py-4 px-3 space-y-5">
          {NAV_SECTIONS.map((section) => (
            <div key={section.label}>
              <p className="px-3 mb-1.5 text-[10px] font-bold uppercase tracking-widest text-salma-text-muted/50">
                {section.label}
              </p>
              <div className="space-y-0.5">
                {section.items.map((item) => (
                  <Link
                    key={item.href}
                    href={item.href}
                    className={`
                      flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all
                      ${isActive(item.href)
                        ? "bg-salma-primary text-white shadow-sm"
                        : "text-salma-text-muted hover:bg-salma-bg hover:text-salma-text"
                      }
                    `}
                  >
                    <span className={isActive(item.href) ? "text-white" : "text-salma-text-muted"}>
                      {item.icon}
                    </span>
                    <span className="flex-1">{item.label}</span>
                    {/* Badge notifications (contacts non lus) */}
                    {item.badge && (
                      <span className="ml-auto w-2 h-2 rounded-full bg-salma-gold flex-shrink-0" />
                    )}
                  </Link>
                ))}
              </div>
            </div>
          ))}
        </nav>

        {/* Footer sidebar */}
        <div className="border-t border-salma-border p-3 space-y-1 flex-shrink-0">
          {/* Lien vers le site vitrine */}
          <Link
            href="/"
            target="_blank"
            className="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-salma-text-muted hover:bg-salma-bg hover:text-salma-text transition-all"
          >
            {Icons.site}
            <span>Voir le site</span>
          </Link>

          {/* Profil + Logout */}
          <div className="flex items-center gap-3 px-3 py-2.5 rounded-lg">
            <div className="w-7 h-7 rounded-full bg-salma-primary/10 flex items-center justify-center flex-shrink-0">
              <span className="text-xs font-bold text-salma-primary">
                {user?.nom_complet?.charAt(0).toUpperCase() ?? "A"}
              </span>
            </div>
            <div className="flex-1 min-w-0">
              <p className="text-xs font-semibold text-salma-text truncate">{user?.nom_complet}</p>
              <p className="text-[10px] text-salma-text-muted truncate">{user?.role}</p>
            </div>
            <button
              onClick={logout}
              className="text-salma-text-muted hover:text-red-500 transition-colors flex-shrink-0"
              title="Déconnexion"
            >
              {Icons.logout}
            </button>
          </div>
        </div>
      </aside>

      {/* ── Contenu principal ────────────────────────────────────────── */}
      <main className="flex-1 flex flex-col md:ml-64 min-h-screen">
        {children}
      </main>
    </div>
  );
}


// END OF FILE: src/app/(admin)/admin/layout.tsx


// FILE: src/app/(visitor)/a-propos/page.tsx
-----------------------------------------------
"use client";
import { useLanguage } from "@/hooks/useLanguage";
import SectionTitle from "@/components/ui/SectionTitle";
import Image from "next/image";

export default function AboutPage() {
  const { dictionary } = useLanguage();
  const a = dictionary.aboutPage;

  return (
    <div className="py-20 bg-white dark:bg-salma-bg min-h-screen">
      <div className="container mx-auto px-6">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center mb-24">
          <div className="relative h-[500px] rounded-3xl overflow-hidden shadow-salma-lg border-8 border-salma-surface">
            <Image src="/image.jpg" alt="AG Technologies" fill className="object-cover" />
          </div>
          <div className="space-y-8">
            <SectionTitle title={a.title} subtitle={a.subtitle} />
            <div className="space-y-6 text-salma-text-muted leading-relaxed">
              <h3 className="text-xl font-serif font-bold text-salma-primary dark:text-white">{a.missionTitle}</h3>
              <p>{a.missionDesc}</p>
              <h3 className="text-xl font-serif font-bold text-salma-primary dark:text-white">{a.visionTitle}</h3>
              <p>{a.visionDesc}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// END OF FILE: src/app/(visitor)/a-propos/page.tsx


// FILE: src/app/(visitor)/bourses/CatalogClient.tsx
-----------------------------------------------
// src/app/(visitor)/bourses/CatalogClient.tsx
// ==============================================================================
//  CatalogClient — Client Component
//  Gère les interactions filtres : met à jour l'URL → le Server Component refetch
//  Pattern : URL as source of truth (pas de state local pour les filtres)
// ==============================================================================
"use client";

import { useCallback, useTransition } from "react";
import { useRouter, usePathname } from "next/navigation";
import Link from "next/link";
import Image from "next/image";
import { useLanguage } from "@/hooks/useLanguage";
import SectionTitle from "@/components/ui/SectionTitle";
import SalmaButton from "@/components/ui/SalmaButton";
import { getMediaUrl } from "@/lib/api-client";
import { eventsRepository } from "@/repositories/events.repository";
import type {
  ScholarshipPublicListItem,
  ScholarshipFilters,
  PaginatedResponse,
} from "@/types/api/scholarship.types";

// --- Constantes UI -----------------------------------------------------------

const PAYS_OPTIONS = [
  { value: "", label: "Tous les pays" },
  { value: "chine", label: "🇨🇳 Chine" },
  { value: "allemagne", label: "🇩🇪 Allemagne" },
];

const NIVEAU_OPTIONS = [
  { value: "", label: "Tous les niveaux" },
  { value: "licence", label: "Licence" },
  { value: "master", label: "Master" },
  { value: "doctorat", label: "Doctorat" },
  { value: "postdoc", label: "Post-Doc" },
  { value: "formation", label: "Formation" },
];

const COUVERTURE_OPTIONS = [
  { value: "", label: "Toute couverture" },
  { value: "complete", label: "Bourse complète" },
  { value: "partielle", label: "Partielle" },
  { value: "logement", label: "Logement inclus" },
];

const COVERAGE_STYLE: Record<string, string> = {
  complete:  "bg-emerald-50 text-emerald-700 border-emerald-200",
  partielle: "bg-blue-50 text-blue-700 border-blue-200",
  logement:  "bg-purple-50 text-purple-700 border-purple-200",
  transport: "bg-orange-50 text-orange-700 border-orange-200",
  autre:     "bg-gray-50 text-gray-700 border-gray-200",
};

const COVERAGE_LABEL: Record<string, string> = {
  complete:  "Bourse complète",
  partielle: "Partielle",
  logement:  "Logement inclus",
  transport: "Transport",
  autre:     "Aide financière",
};

const LEVEL_LABEL: Record<string, string> = {
  licence: "Licence", master: "Master", doctorat: "Doctorat",
  postdoc: "Post-Doc", formation: "Formation", autre: "Autre",
};

const FLAG: Record<string, string> = {
  chine: "🇨🇳", allemagne: "🇩🇪", france: "🇫🇷", canada: "🇨🇦", autre: "🌍",
};

// --- Composant carte bourse --------------------------------------------------

function ScholarshipCard({
  scholarship,
  locale,
}: {
  scholarship: ScholarshipPublicListItem;
  locale: "fr" | "en";
}) {
  const title   = locale === "fr" ? scholarship.titre_fr : scholarship.titre_en;
  const org     = locale === "fr" ? scholarship.organisme_fr : scholarship.organisme_en;
  const imgUrl  = getMediaUrl(scholarship.image_principale?.url_fichier);
  const flag    = FLAG[scholarship.pays_destination] ?? "🌍";
  const covStyle = COVERAGE_STYLE[scholarship.type_couverture] ?? COVERAGE_STYLE.autre;
  const covLabel = COVERAGE_LABEL[scholarship.type_couverture] ?? "Aide financière";

  const deadline = scholarship.date_limite
    ? new Date(scholarship.date_limite).toLocaleDateString("fr-FR", {
        day: "2-digit", month: "short", year: "numeric",
      })
    : null;

  const isUrgent = scholarship.date_limite
    ? new Date(scholarship.date_limite).getTime() - Date.now() < 30 * 24 * 60 * 60 * 1000
    : false;

  return (
    <Link
      href={`/bourses/${scholarship.id}`}
      onClick={() => eventsRepository.trackScholarshipView(scholarship.id)}
      className="group flex flex-col bg-white border border-salma-border rounded-2xl overflow-hidden shadow-sm hover:shadow-salma-lg transition-all duration-300 hover:-translate-y-1"
    >
      {/* Image */}
      <div className="relative h-44 bg-salma-surface overflow-hidden flex-shrink-0">
        {imgUrl ? (
          <Image
            src={imgUrl}
            alt={title}
            fill
            className="object-cover group-hover:scale-105 transition-transform duration-500"
          />
        ) : (
          <div className="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-salma-primary/10 to-salma-gold/10">
            <span className="text-5xl">{flag}</span>
          </div>
        )}
        {isUrgent && (
          <span className="absolute top-3 left-3 px-2.5 py-1 bg-red-500 text-white text-[10px] font-bold uppercase tracking-widest rounded-full">
            ⚡ Urgent
          </span>
        )}
        {scholarship.est_mise_en_avant && (
          <span className="absolute top-3 right-3 px-2.5 py-1 bg-salma-gold text-white text-[10px] font-bold uppercase tracking-widest rounded-full">
            ⭐ Vedette
          </span>
        )}
      </div>

      {/* Corps */}
      <div className="flex flex-col flex-1 p-5 gap-2.5">
        <div className="flex items-center gap-2 text-[11px] font-semibold text-salma-text-muted">
          <span>{flag} {scholarship.pays_destination.charAt(0).toUpperCase() + scholarship.pays_destination.slice(1)}</span>
          <span className="text-salma-border">·</span>
          <span>{LEVEL_LABEL[scholarship.niveau] ?? scholarship.niveau}</span>
        </div>

        <h3 className="text-sm font-bold text-salma-primary leading-snug group-hover:text-salma-gold transition-colors line-clamp-2">
          {title}
        </h3>

        <p className="text-[11px] text-salma-text-muted truncate">{org}</p>

        {scholarship.domaines.length > 0 && (
          <div className="flex flex-wrap gap-1">
            {scholarship.domaines.slice(0, 3).map((d) => (
              <span key={d.id} className="px-2 py-0.5 bg-salma-bg border border-salma-border rounded-full text-[10px] text-salma-text-muted">
                {locale === "fr" ? d.nom_fr : d.nom_en}
              </span>
            ))}
          </div>
        )}

        <div className="mt-auto pt-3 border-t border-salma-border flex items-center justify-between gap-2">
          <span className={`px-2 py-0.5 text-[10px] font-semibold rounded-full border ${covStyle}`}>
            {covLabel}
          </span>
          {deadline && (
            <span className={`text-[10px] font-medium flex-shrink-0 ${isUrgent ? "text-red-500 font-bold" : "text-salma-text-muted"}`}>
              {isUrgent ? "⚠ " : ""}Limite : {deadline}
            </span>
          )}
        </div>
      </div>
    </Link>
  );
}

// --- Squelettes de chargement ------------------------------------------------

function SkeletonGrid() {
  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {Array.from({ length: 6 }).map((_, i) => (
        <div key={i} className="bg-white border border-salma-border rounded-2xl overflow-hidden animate-pulse">
          <div className="h-44 bg-salma-surface" />
          <div className="p-5 space-y-3">
            <div className="h-3 bg-salma-surface rounded w-1/3" />
            <div className="h-4 bg-salma-surface rounded w-5/6" />
            <div className="h-3 bg-salma-surface rounded w-2/3" />
            <div className="h-7 bg-salma-surface rounded-full w-1/2 mt-2" />
          </div>
        </div>
      ))}
    </div>
  );
}

// --- Composant principal -----------------------------------------------------

interface Props {
  initialData: PaginatedResponse<ScholarshipPublicListItem>;
  initialFilters: ScholarshipFilters;
}

export default function CatalogClient({ initialData, initialFilters }: Props) {
  const { dictionary, locale } = useLanguage();
  const router = useRouter();
  const pathname = usePathname();
  const [isPending, startTransition] = useTransition();

  // --- Mise à jour de l'URL (source de vérité des filtres) ------------------
  const updateURL = useCallback(
    (updates: Record<string, string | undefined>) => {
      const current = new URLSearchParams();

      // Recopier les filtres existants
      if (initialFilters.pays_destination) current.set("pays", initialFilters.pays_destination);
      if (initialFilters.niveau) current.set("niveau", initialFilters.niveau);
      if (initialFilters.type_couverture) current.set("couverture", initialFilters.type_couverture);
      if (initialFilters.search) current.set("q", initialFilters.search);

      // Appliquer les mises à jour
      Object.entries(updates).forEach(([key, val]) => {
        if (val) current.set(key, val);
        else current.delete(key);
      });

      // Reset page lors d'un changement de filtre (sauf si c'est une page)
      if (!("page" in updates)) current.delete("page");

      startTransition(() => {
        router.push(`${pathname}?${current.toString()}`);
      });
    },
    [initialFilters, pathname, router]
  );

  const handleSearch = useCallback(
    (e: React.ChangeEvent<HTMLInputElement>) => {
      const val = e.target.value;
      // Debounce léger via setTimeout natif
      const timer = setTimeout(() => updateURL({ q: val || undefined }), 400);
      return () => clearTimeout(timer);
    },
    [updateURL]
  );

  const activeFiltersCount = [
    initialFilters.pays_destination,
    initialFilters.niveau,
    initialFilters.type_couverture,
    initialFilters.search,
  ].filter(Boolean).length;

  const totalPages = Math.ceil(initialData.count / (initialFilters.page_size ?? 12));
  const currentPage = initialFilters.page ?? 1;

  return (
    <div className="min-h-screen bg-salma-bg">
      <div className="container mx-auto px-4 sm:px-6 py-16">

        {/* En-tête */}
        <div className="max-w-3xl mb-10">
          <SectionTitle
            title={dictionary.catalog?.title ?? "Catalogue des Bourses"}
            subtitle={dictionary.catalog?.subtitle ?? "Chine & Allemagne"}
            align="left"
          />
          <p className="text-salma-text-muted text-sm mt-2">
            {dictionary.catalog?.description ?? "Trouvez la bourse qui correspond à votre profil et lancez votre dossier avec SALMA."}
          </p>
        </div>

        {/* --- Barre de filtres --- */}
        <div className="bg-white border border-salma-border rounded-2xl p-4 sm:p-6 shadow-sm mb-8">
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">

            {/* Recherche textuelle */}
            <div className="relative lg:col-span-1">
              <svg className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-salma-text-muted pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <input
                type="text"
                defaultValue={initialFilters.search ?? ""}
                onChange={handleSearch}
                placeholder="Rechercher une bourse..."
                className="w-full pl-9 pr-4 py-2.5 text-sm border border-salma-border rounded-xl bg-salma-bg outline-none focus:border-salma-primary focus:ring-2 focus:ring-salma-primary/10 transition-all"
              />
            </div>

            {/* Filtre Pays */}
            <select
              value={initialFilters.pays_destination ?? ""}
              onChange={(e) => updateURL({ pays: e.target.value || undefined })}
              className="px-4 py-2.5 text-sm border border-salma-border rounded-xl bg-salma-bg outline-none focus:border-salma-primary cursor-pointer"
            >
              {PAYS_OPTIONS.map((o) => (
                <option key={o.value} value={o.value}>{o.label}</option>
              ))}
            </select>

            {/* Filtre Niveau */}
            <select
              value={initialFilters.niveau ?? ""}
              onChange={(e) => updateURL({ niveau: e.target.value || undefined })}
              className="px-4 py-2.5 text-sm border border-salma-border rounded-xl bg-salma-bg outline-none focus:border-salma-primary cursor-pointer"
            >
              {NIVEAU_OPTIONS.map((o) => (
                <option key={o.value} value={o.value}>{o.label}</option>
              ))}
            </select>

            {/* Filtre Couverture */}
            <select
              value={initialFilters.type_couverture ?? ""}
              onChange={(e) => updateURL({ couverture: e.target.value || undefined })}
              className="px-4 py-2.5 text-sm border border-salma-border rounded-xl bg-salma-bg outline-none focus:border-salma-primary cursor-pointer"
            >
              {COUVERTURE_OPTIONS.map((o) => (
                <option key={o.value} value={o.value}>{o.label}</option>
              ))}
            </select>
          </div>

          {/* Résumé + reset */}
          {(activeFiltersCount > 0 || isPending) && (
            <div className="mt-3 flex items-center justify-between">
              <p className="text-xs text-salma-text-muted">
                {isPending ? "Recherche en cours..." : `${initialData.count} bourse${initialData.count > 1 ? "s" : ""} trouvée${initialData.count > 1 ? "s" : ""}`}
              </p>
              {activeFiltersCount > 0 && (
                <button
                  onClick={() => router.push(pathname)}
                  className="text-xs text-salma-primary hover:underline font-medium"
                >
                  Effacer les filtres ({activeFiltersCount})
                </button>
              )}
            </div>
          )}
        </div>

        {/* --- Scholarship Matcher (CTA conversion) --- */}
        {activeFiltersCount === 0 && (
          <div className="mb-8 p-5 bg-gradient-to-r from-salma-primary to-salma-primary/80 rounded-2xl flex flex-col sm:flex-row items-center gap-4 text-white">
            <div className="flex-1">
              <p className="font-serif font-bold text-lg">🎯 Trouvez votre bourse en 3 clics</p>
              <p className="text-sm text-white/80 mt-1">Utilisez les filtres ci-dessus ou contactez-nous — nos conseillers identifient votre bourse idéale gratuitement.</p>
            </div>
            <Link href="/contact">
              <SalmaButton variant="outline" className="border-white text-white hover:bg-white hover:text-salma-primary whitespace-nowrap">
                Consulter gratuitement
              </SalmaButton>
            </Link>
          </div>
        )}

        {/* --- Grille des bourses --- */}
        {isPending ? (
          <SkeletonGrid />
        ) : initialData.results.length === 0 ? (
          <div className="flex flex-col items-center justify-center py-24 text-center">
            <span className="text-6xl mb-4">🔍</span>
            <h3 className="text-xl font-serif font-bold text-salma-primary mb-2">
              Aucune bourse trouvée
            </h3>
            <p className="text-salma-text-muted text-sm max-w-md">
              Aucune bourse ne correspond à vos critères. Essayez d&apos;élargir votre recherche ou contactez-nous.
            </p>
            <button
              onClick={() => router.push(pathname)}
              className="mt-6 px-6 py-2.5 rounded-xl bg-salma-primary text-white text-sm font-medium hover:bg-salma-primary/90 transition-all"
            >
              Voir toutes les bourses
            </button>
          </div>
        ) : (
          <>
            {/* Compteur résultats */}
            <p className="text-xs text-salma-text-muted mb-4 font-medium">
              {initialData.count} bourse{initialData.count > 1 ? "s" : ""} disponible{initialData.count > 1 ? "s" : ""}
              {currentPage > 1 && ` — Page ${currentPage}/${totalPages}`}
            </p>

            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {initialData.results.map((s) => (
                <ScholarshipCard key={s.id} scholarship={s} locale={locale} />
              ))}
            </div>

            {/* --- Pagination --- */}
            {totalPages > 1 && (
              <div className="mt-12 flex items-center justify-center gap-2">
                {/* Précédent */}
                <button
                  onClick={() => updateURL({ page: String(currentPage - 1) })}
                  disabled={currentPage <= 1}
                  className="px-4 py-2 rounded-xl border border-salma-border text-sm font-medium text-salma-text-muted hover:bg-salma-surface disabled:opacity-40 disabled:cursor-not-allowed transition-all"
                >
                  ← Précédent
                </button>

                {/* Pages numérotées */}
                {Array.from({ length: Math.min(totalPages, 5) }).map((_, i) => {
                  const page = i + 1;
                  return (
                    <button
                      key={page}
                      onClick={() => updateURL({ page: String(page) })}
                      className={`w-10 h-10 rounded-xl text-sm font-medium transition-all ${
                        page === currentPage
                          ? "bg-salma-primary text-white shadow-sm"
                          : "border border-salma-border text-salma-text-muted hover:bg-salma-surface"
                      }`}
                    >
                      {page}
                    </button>
                  );
                })}

                {/* Suivant */}
                <button
                  onClick={() => updateURL({ page: String(currentPage + 1) })}
                  disabled={currentPage >= totalPages}
                  className="px-4 py-2 rounded-xl border border-salma-border text-sm font-medium text-salma-text-muted hover:bg-salma-surface disabled:opacity-40 disabled:cursor-not-allowed transition-all"
                >
                  Suivant →
                </button>
              </div>
            )}
          </>
        )}

        {/* --- CTA bas de page --- */}
        <div className="mt-20 text-center py-12 px-6 bg-white border border-salma-border rounded-2xl">
          <p className="text-xl font-serif font-bold text-salma-primary mb-2">
            Vous ne trouvez pas votre bourse ?
          </p>
          <p className="text-salma-text-muted text-sm mb-6 max-w-lg mx-auto">
            Nos conseillers connaissent des dizaines d&apos;opportunités non listées ici. Contactez-nous pour une consultation gratuite.
          </p>
          <Link href="/contact">
            <SalmaButton variant="primary" size="lg">
              Parler à un conseiller
            </SalmaButton>
          </Link>
        </div>

      </div>
    </div>
  );
}


// END OF FILE: src/app/(visitor)/bourses/CatalogClient.tsx


// FILE: src/app/(visitor)/bourses/page.tsx
-----------------------------------------------
// src/app/(visitor)/bourses/page.tsx
// ==============================================================================
//  Catalogue Bourses — SERVER COMPONENT
//  Les filtres vivent dans l'URL (?pays=chine&niveau=master&page=2)
//  → SEO parfait, partage d'URL, navigation navigateur fonctionnelle
//  → fetch côté serveur avec ISR 60s
// ==============================================================================

import { Suspense } from "react";
import type { Metadata } from "next";
import { scholarshipDictionary } from "@/dictionaries/data/scholarship.data-dictionary";
import type { ScholarshipFilters } from "@/types/api/scholarship.types";
import CatalogClient from "./CatalogClient";

// Métadonnées SEO dynamiques
export const metadata: Metadata = {
  title: "Bourses d'études — Chine & Allemagne | SALMA",
  description:
    "Trouvez votre bourse d'études idéale en Chine ou en Allemagne. Filtrez par pays, niveau et type de couverture. Accompagnement complet par SALMA.",
  keywords: "bourses études Chine Cameroun, bourses Allemagne, CSC scholarship, DAAD bourse",
};

interface PageProps {
  searchParams: Promise<Record<string, string | string[] | undefined>>;
}

function getString(val: string | string[] | undefined): string | undefined {
  if (!val) return undefined;
  return Array.isArray(val) ? val[0] : val;
}

function getPage(val: string | string[] | undefined): number {
  const n = parseInt(getString(val) ?? "1", 10);
  return isNaN(n) || n < 1 ? 1 : n;
}

export default async function BoursesPage({ searchParams }: PageProps) {
  const params = await searchParams;

  // Lecture des filtres depuis l'URL
  const filters: ScholarshipFilters = {
    pays_destination: getString(params.pays) as ScholarshipFilters["pays_destination"],
    niveau: getString(params.niveau) as ScholarshipFilters["niveau"],
    type_couverture: getString(params.couverture) as ScholarshipFilters["type_couverture"],
    search: getString(params.q),
    page: getPage(params.page),
    page_size: 12,
    ordering: getString(params.tri) ?? "-est_mise_en_avant,-date_creation",
  };

  // Fetch côté serveur — Django filtre, pagine et trie
  let data;
  try {
    data = await scholarshipDictionary.getCatalog(filters);
  } catch {
    data = { count: 0, results: [], next: null, previous: null };
  }

  return (
    <Suspense fallback={null}>
      <CatalogClient
        initialData={data}
        initialFilters={filters}
      />
    </Suspense>
  );
}


// END OF FILE: src/app/(visitor)/bourses/page.tsx


// FILE: src/app/(visitor)/confidentialite/page.tsx
-----------------------------------------------
import SectionTitle from "@/components/ui/SectionTitle";

export default function PrivacyPage() {
  return (
    <div className="py-20 bg-salma-bg min-h-screen">
      <div className="container mx-auto px-6 max-w-4xl bg-white dark:bg-salma-surface p-12 rounded-[2rem] border border-salma-border">
        <SectionTitle title="Politique de Confidentialité" subtitle="RGPD & Protection" />
        <div className="prose prose-salma dark:prose-invert">
          <h3>1. Collecte des données</h3>
          <p>Nous collectons les informations que vous nous fournissez via les formulaires de contact (Nom, Email, Téléphone) pour traiter vos demandes de bourses.</p>
          <h3>2. Utilisation des données</h3>
          {/* FIX : Échappement de l'apostrophe */}
          <p>Vos données sont utilisées exclusivement par AG Technologies pour l&apos;accompagnement de votre dossier et l&apos;envoi de notre newsletter si vous l&apos;avez accepté.</p>
          <h3>3. Vos droits</h3>
          <p>Vous disposez d&apos;un droit d&apos;accès, de rectification et de suppression de vos données sur simple demande à : secretariatagtechnologies@gmail.com</p>
        </div>
      </div>
    </div>
  );
}

// END OF FILE: src/app/(visitor)/confidentialite/page.tsx


// FILE: src/app/(visitor)/contact/page.tsx
-----------------------------------------------
"use client";
import ContactForm from "@/sections/visitor/ContactForm";
import SectionTitle from "@/components/ui/SectionTitle";
import { useLanguage } from "@/hooks/useLanguage";

export default function ContactPage() {
  const { dictionary } = useLanguage();

  return (
    <div className="bg-salma-bg min-h-screen">
      {/* On peut ajouter une bannière ou une carte Google Maps ici plus tard */}
      <div className="pt-20">
        <ContactForm />
      </div>
      
      {/* Section FAQ intégrée pour réduire le nombre de pages */}
      <div className="container mx-auto px-6 pb-20">
        <SectionTitle title={dictionary.faq.title} subtitle={dictionary.faq.subtitle} align="center" />
        <div className="max-w-3xl mx-auto space-y-4">
          {dictionary.faq.items.map((item, i) => (
            <details key={i} className="group bg-white dark:bg-salma-surface border border-salma-border rounded-2xl p-6 cursor-pointer">
              <summary className="font-bold text-salma-primary dark:text-white flex justify-between items-center list-none">
                {item.q}
                <span className="text-salma-gold group-open:rotate-180 transition-transform">▼</span>
              </summary>
              <p className="mt-4 text-salma-text-muted text-sm">{item.a}</p>
            </details>
          ))}
        </div>
      </div>
    </div>
  );
}

// END OF FILE: src/app/(visitor)/contact/page.tsx


// FILE: src/app/(visitor)/services/page.tsx
-----------------------------------------------
"use client";
import { useLanguage } from "@/hooks/useLanguage";
import SectionTitle from "@/components/ui/SectionTitle";

export default function ServicesPage() {
  const { dictionary } = useLanguage();
  const s = dictionary.servicesPage;

  const cards = [
    { title: s.items.study.title, desc: s.items.study.desc, icon: "🎓" },
    { title: s.items.tourist.title, desc: s.items.tourist.desc, icon: "✈️" },
    { title: s.items.work.title, desc: s.items.work.desc, icon: "💼" },
    { title: s.items.insurance.title, desc: s.items.insurance.desc, icon: "🛡️" },
  ];

  return (
    <div className="py-20 bg-salma-bg min-h-screen">
      <div className="container mx-auto px-6">
        <SectionTitle title={s.title} subtitle={s.subtitle} align="center" />
        <p className="max-w-2xl mx-auto text-center text-salma-text-muted mb-16">{s.description}</p>
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {cards.map((card, i) => (
            <div key={i} className="p-8 bg-white dark:bg-salma-surface border border-salma-border rounded-3xl shadow-salma-sm hover:shadow-salma-md transition-all">
              <span className="text-4xl mb-6 block">{card.icon}</span>
              <h3 className="text-xl font-serif font-bold text-salma-primary dark:text-salma-gold mb-4">{card.title}</h3>
              <p className="text-sm text-salma-text-muted leading-relaxed">{card.desc}</p>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// END OF FILE: src/app/(visitor)/services/page.tsx


// FILE: src/app/globals copy.css
-----------------------------------------------
/* src/app/globals.css */
@import "tailwindcss";

@theme inline {
  /* --- Polices --- */
  --font-serif: var(--font-cormorant), Georgia, serif;
  --font-sans: var(--font-inter), system-ui, sans-serif;

  /* --- Couleurs SALMA (Inspirées de la bannière Facebook) --- */
  /* Bleu Marine (Confiance/Banque) */
  --color-salma-primary:       #1B365D; 
  --color-salma-primary-dark:  #11243D;
  --color-salma-primary-light: #2D5284;

  /* Bleu Azur (Voyage/Action) */
  --color-salma-accent:        #00AEEF; 

  /* Or (Excellence/Bourses) */
  --color-salma-gold:          #C9A84C;
  --color-salma-gold-light:    #E8C97A;
  --color-salma-gold-dark:     #A68635;

  /* --- Tokens sémantiques --- */
  --color-bg:         var(--bg);
  --color-surface:    var(--surface);
  --color-border:     var(--border);
  --color-text:       var(--text);
  --color-text-muted: var(--text-muted);

  /* --- Ombres (plus légères et aériennes) --- */
  --shadow-salma-sm:  0 2px 10px rgba(0, 174, 239, 0.05);
  --shadow-salma-md:  0 10px 30px rgba(27, 54, 93, 0.1);
  --shadow-salma-lg:  0 20px 50px rgba(27, 54, 93, 0.15);
}

:root {
  /* Fond CLAIR demandé (Pure White) */
  --bg:         #FFFFFF;
  --surface:    #F8FAFC;
  --border:     #E2E8F0;
  --text:       #0F172A;
  --text-muted: #64748B;
   --heading:    #1B365D; 
}

.dark {
  /* Mode Sombre (Bleu Nuit Profond) */
  --bg:         #0A0F1A;
  --surface:    #151D2E;
  --border:     #1E293B;
  --text:       #F1F5F9;
  --text-muted: #94A3B8;
   --heading:    #F1F5F9;
}

/* --- Reset & Base --- */
body {
  background-color: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  transition: background-color 0.4s ease, color 0.4s ease;
}

h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-serif);
  font-weight: 700;
 color: var(--heading); 
  transition: color 0.4s ease;
}

/* --- Utilitaires de test visuel --- */
.gold-divider {
  width: 50px;
  height: 3px;
  background-color: var(--color-salma-gold);
  border-radius: 10px;
}

.blue-gradient {
  background: linear-gradient(135deg, var(--color-salma-primary) 0%, var(--color-salma-accent) 100%);
}

// END OF FILE: src/app/globals copy.css


// FILE: src/app/globals.css
-----------------------------------------------
/* src/app/globals.css */
@import "tailwindcss";

@theme inline {
  --font-serif: var(--font-cormorant), Georgia, serif;
  --font-sans: var(--font-inter), system-ui, sans-serif;

  --color-salma-primary:       #1B365D; 
  --color-salma-primary-dark:  #11243D;
  --color-salma-primary-light: #2D5284;
  --color-salma-accent:        #00AEEF; 
  --color-salma-gold:          #C9A84C;
  --color-salma-gold-light:    #E8C97A;
  --color-salma-gold-dark:     #A68635;

  --color-bg:         var(--bg);
  --color-surface:    var(--surface);
  --color-border:     var(--border);
  --color-text:       var(--text);
  --color-text-muted: var(--text-muted);
  --color-heading:    var(--heading);

  --shadow-salma-sm:  0 2px 10px rgba(0, 174, 239, 0.05);
  --shadow-salma-md:  0 10px 30px rgba(27, 54, 93, 0.1);
  --shadow-salma-lg:  0 20px 50px rgba(27, 54, 93, 0.15);
}

:root {
  --bg:         #FFFFFF;
  --surface:    #F8FAFC;
  --border:     #E2E8F0;
  --text:       #0F172A;
  --text-muted: #64748B;
  --heading:    #1B365D; 
}

.dark {
  /* On utilise un bleu très sombre saturé pour garder l'identité Navy */
  --bg:         #0F172A; /* Bleu nuit profond */
  --surface:    #1E293B; /* Bleu ardoise pour les cartes */
  --border:     #334155; /* Bordures visibles mais discrètes */
  --text:       #94A3B8; /* Gris bleuté pour le texte */
  --text-muted: #64748B;
  --heading:    #F8FAFC; /* Titres en blanc cassé pour le contraste */
}

body {
  background-color: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  transition: background-color 0.4s ease, color 0.4s ease;
}

h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-serif);
  font-weight: 700;
  color: var(--heading); 
  transition: color 0.4s ease;
}

// END OF FILE: src/app/globals.css


// FILE: src/app/layout.tsx
-----------------------------------------------
import type { Metadata } from "next";
import { Cormorant_Garamond, Inter } from "next/font/google";
import "./globals.css";
import { ThemeProvider } from "@/contexts/ThemeContext";
import { LanguageProvider } from "@/contexts/LanguageContext";
import Navbar from "@/components/Navbar";
import WhatsAppButton from "@/components/ui/WhatsAppButton";
import ChatbotWidget from "@/components/ui/ChatbotWidget";
import Footer from "@/components/Footer";
import CookieBanner from "@/components/ui/CookieBanner";
// Polices configurées comme dans ton portfolio
const cormorant = Cormorant_Garamond({
  subsets: ["latin"],
  variable: "--font-cormorant",
  weight: ["300", "400", "500", "600", "700"],
  display: "swap",
});

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
  display: "swap",
});

export const metadata: Metadata = {
  title: "SALMA — Agence de Voyage & Bourses d'études",
  description: "Spécialiste des bourses d'études en Chine et en Allemagne.",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html
      lang="fr"
      className={`${cormorant.variable} ${inter.variable}`}
      suppressHydrationWarning
    >
      <body className="antialiased bg-salma-bg text-salma-text transition-colors duration-300">
        <ThemeProvider
        attribute="class" 
        defaultTheme="light" 
        forcedTheme="light" // Force le mode clair
        enableSystem={false}
        >
          <LanguageProvider>
            <Navbar />
            <main>{children}</main>
            <Footer /> 
            <WhatsAppButton />
            <ChatbotWidget />
            <CookieBanner />
          </LanguageProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}

// END OF FILE: src/app/layout.tsx


// FILE: src/app/page.tsx
-----------------------------------------------
// src/app/page.tsx
// ==============================================================================
//  Home Page — SERVER COMPONENT
//  Fetch en parallèle : bourses vedette + KPI publics + témoignages + config CMS
//  Les données sont passées en props aux sections (jamais de fetch côté client)
// ==============================================================================

import { Suspense } from "react";
import Hero from "@/sections/visitor/Hero";
import TrustBar from "@/sections/visitor/TrustBar";
import StatsCounter from "@/sections/visitor/StatsCounter";
import FeaturedScholarships from "@/sections/visitor/FeaturedScholarships";
import SuccessStories from "@/sections/visitor/SuccessStories";
import ContactForm from "@/sections/visitor/ContactForm";
import { scholarshipDictionary } from "@/dictionaries/data/scholarship.data-dictionary";
import { testimonialPublicRepository } from "@/repositories/testimonial.repository";
import { kpiRepository } from "@/repositories/kpi.repository";

// Squelettes de chargement légers
function SectionSkeleton({ height = "h-64" }: { height?: string }) {
  return (
    <div className={`${height} bg-salma-surface/50 animate-pulse rounded-2xl mx-6 my-4`} />
  );
}

// Fetch en parallèle de toutes les données de la Home
async function getHomeData() {
  try {
    const [featured, testimonials, kpiRealtime] = await Promise.allSettled([
      scholarshipDictionary.getFeatured(),
      testimonialPublicRepository.getList(),
      kpiRepository.adminGetRealtime().catch(() => null), // KPI optionnel
    ]);

    return {
      featured: featured.status === "fulfilled" ? featured.value : [],
      testimonials: testimonials.status === "fulfilled" ? testimonials.value : [],
      kpi: kpiRealtime.status === "fulfilled" ? kpiRealtime.value : null,
    };
  } catch {
    // Fallback silencieux si le backend est inaccessible
    return { featured: [], testimonials: [], kpi: null };
  }
}

export default async function Home() {
  const { featured, testimonials, kpi } = await getHomeData();

  return (
    <main>
      <Hero />
      <TrustBar />

      {/* Stats dynamiques si KPI disponibles, sinon stats statiques */}
      <Suspense fallback={<SectionSkeleton height="h-40" />}>
        <StatsCounter kpi={kpi} />
      </Suspense>

      {/* Bourses vedette — données réelles du backend */}
      <Suspense fallback={<SectionSkeleton height="h-96" />}>
        <FeaturedScholarships scholarships={featured} />
      </Suspense>

      {/* Témoignages approuvés */}
      <Suspense fallback={<SectionSkeleton height="h-64" />}>
        <SuccessStories testimonials={testimonials} />
      </Suspense>

      <ContactForm />
    </main>
  );
}


// END OF FILE: src/app/page.tsx


// FILE: src/components/admin/AddScholarshipModal.tsx
-----------------------------------------------
"use client";

import { useState, useEffect } from "react";
import { scholarshipDictionary } from "@/dictionaries/data";
import { SCHOLARSHIP_VISIBILITY_FIELDS, type UpdateScholarshipPayload, type FieldVisibilityMap,type CreateScholarshipPayload } from "@/types";
import SalmaButton from "../ui/SalmaButton";

interface Props {
  isOpen: boolean;
  onClose: () => void;
  onSave: () => void;
  scholarshipId?: string | null;
}

export default function AddScholarshipModal({ isOpen, onClose, onSave, scholarshipId }: Props) {
  const [activeTab, setActiveTab] = useState<"content" | "visibility" | "media">("content");
  const [loading, setLoading] = useState(false);
  
  // FIX : Typage UpdateScholarshipPayload au lieu de any
  const [form, setForm] = useState<UpdateScholarshipPayload>({
    titre_fr: "", titre_en: "", organisme_fr: "", organisme_en: "",
    description_fr: "", description_en: "", pays_destination: "chine",
    niveau: "master", statut: "publie", type_couverture: "complete"
  });
  const [visibility, setVisibility] = useState<FieldVisibilityMap>({});

  useEffect(() => {
    if (scholarshipId && isOpen) {
      setLoading(true);
      scholarshipDictionary.admin.getById(scholarshipId).then(data => {
        setForm(data);
        const vMap = data.visibilites.reduce((acc, v) => {
          acc[v.nom_du_champ] = v.est_visible;
          return acc;
        }, {} as FieldVisibilityMap);
        setVisibility(vMap);
        setLoading(false);
      });
    }
  }, [scholarshipId, isOpen]);

  const handleFinalSave = async () => {
    setLoading(true);
    try {
      if (scholarshipId) {
        await scholarshipDictionary.admin.patch(scholarshipId, form);
        await scholarshipDictionary.admin.saveVisibility(scholarshipId, visibility);
      } else {
        // En création, on cast en CreateScholarshipPayload (le type est compatible)
        await scholarshipDictionary.admin.create(form as CreateScholarshipPayload); 
      }
      onSave();
      onClose();
    } catch {
      // FIX : Retrait du 'e' non utilisé
      alert("Erreur lors de la sauvegarde");
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center bg-salma-primary/40 backdrop-blur-md p-4">
      <div className="bg-white rounded-[2rem] w-full max-w-5xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden border border-salma-border">
        <div className="p-8 border-b border-salma-border bg-salma-bg/50">
          <div className="flex justify-between items-center mb-6">
            <h2 className="text-2xl font-serif font-bold text-salma-primary">
              {scholarshipId ? "Édition Bourse" : "Nouvelle Bourse"}
            </h2>
            <button onClick={onClose} className="text-salma-text-muted hover:text-salma-primary text-2xl">✕</button>
          </div>
          
          <div className="flex gap-8">
            {["content", "visibility", "media"].map((tab) => (
              <button
                key={tab}
                // FIX : Cast du tab pour le setter
                onClick={() => setActiveTab(tab as "content" | "visibility" | "media")}
                className={`pb-2 text-sm font-bold uppercase tracking-widest transition-all border-b-2 ${
                  activeTab === tab ? "border-salma-gold text-salma-primary" : "border-transparent text-salma-text-muted"
                }`}
              >
                {tab === "content" ? "Contenu" : tab === "visibility" ? "Visibilité" : "Images"}
              </button>
            ))}
          </div>
        </div>

        <div className="flex-1 overflow-y-auto p-8">
          {loading ? (
            <div className="flex justify-center py-20 italic">Chargement des données...</div>
          ) : (
            <>
              {activeTab === "content" && (
                <div className="grid grid-cols-2 gap-8">
                  <div className="space-y-4">
                    <h3 className="text-xs font-black text-salma-gold uppercase">Français</h3>
                    <input value={form.titre_fr} onChange={e => setForm({...form, titre_fr: e.target.value})} placeholder="Titre FR" className="w-full p-4 rounded-xl border border-salma-border bg-salma-bg" />
                    <textarea value={form.description_fr} onChange={e => setForm({...form, description_fr: e.target.value})} placeholder="Description FR" rows={5} className="w-full p-4 rounded-xl border border-salma-border bg-salma-bg" />
                  </div>
                  <div className="space-y-4">
                    <h3 className="text-xs font-black text-salma-gold uppercase">Anglais</h3>
                    <input value={form.titre_en} onChange={e => setForm({...form, titre_en: e.target.value})} placeholder="Titre EN" className="w-full p-4 rounded-xl border border-salma-border bg-salma-bg" />
                    <textarea value={form.description_en} onChange={e => setForm({...form, description_en: e.target.value})} placeholder="Description EN" rows={5} className="w-full p-4 rounded-xl border border-salma-border bg-salma-bg" />
                  </div>
                </div>
              )}

              {activeTab === "visibility" && (
                <div className="space-y-6">
                  <div className="p-4 bg-blue-50 border border-blue-100 rounded-xl text-blue-800 text-sm">
                    💡 <strong>Note :</strong> Décochez un champ pour qu&apos;il n&apos;apparaisse pas sur le site public.
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    {SCHOLARSHIP_VISIBILITY_FIELDS.map(field => (
                      <label key={field} className="flex items-center justify-between p-4 bg-salma-bg rounded-xl border border-salma-border cursor-pointer hover:border-salma-gold transition-colors">
                        <span className="text-sm font-bold text-salma-primary">{field.replace('_', ' ')}</span>
                        <input 
                          type="checkbox" 
                          checked={visibility[field] ?? true} 
                          onChange={e => setVisibility({...visibility, [field]: e.target.checked})}
                          className="w-5 h-5 accent-salma-gold"
                        />
                      </label>
                    ))}
                  </div>
                </div>
              )}
            </>
          )}
        </div>

        <div className="p-8 border-t border-salma-border flex justify-end gap-4 bg-salma-bg/30">
          <button onClick={onClose} className="px-8 py-3 text-salma-text-muted font-bold uppercase text-xs tracking-widest">Annuler</button>
          <SalmaButton onClick={handleFinalSave} variant="primary" disabled={loading}>
            {loading ? "Sauvegarde..." : "Enregistrer les modifications"}
          </SalmaButton>
        </div>
      </div>
    </div>
  );
}

// END OF FILE: src/components/admin/AddScholarshipModal.tsx


// FILE: src/components/ui/ChatbotWidget.tsx
-----------------------------------------------
"use client";

import { useState, useEffect, useRef } from "react";
import { useLanguage } from "@/hooks/useLanguage";
import { chatbotRepository } from "@/repositories/chatbot.repository";
import { eventsRepository } from "@/repositories/events.repository";

interface Message {
  role: "user" | "bot";
  text: string;
}

export default function ChatbotWidget() {
  // FIX : Retrait de dictionary
  const { locale } = useLanguage(); 
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (isOpen && messages.length === 0) {
      const welcome = locale === "fr" 
        ? "Bonjour ! Je suis l'assistant SALMA. Comment puis-je vous aider pour votre projet d'études ?"
        : "Hello! I am the SALMA assistant. How can I help you with your study project?";
      setMessages([{ role: "bot", text: welcome }]);
      eventsRepository.trackChatbotOpen();
    }
  }, [isOpen, locale, messages.length]);

  useEffect(() => {
    if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
  }, [messages]);

  const handleSend = async () => {
    if (!input.trim() || isLoading) return;

    const userMsg = input;
    setInput("");
    setMessages((prev) => [...prev, { role: "user", text: userMsg }]);
    setIsLoading(true);

    try {
      const response = await chatbotRepository.query({ message: userMsg, langue: locale });
      setMessages((prev) => [...prev, { role: "bot", text: response.reponse }]);
    } catch {
      // FIX : Retrait de 'error'
      setMessages((prev) => [...prev, { role: "bot", text: "Désolé, une erreur est survenue." }]);
    } finally {
      setIsLoading(false);
    }
  };
  return (
    <div className="fixed bottom-28 right-8 z-50 flex flex-col items-end">
      {/* Fenêtre de Chat */}
      {isOpen && (
        <div className="mb-4 w-80 sm:w-96 h-[450px] bg-white dark:bg-salma-surface border border-salma-border rounded-3xl shadow-salma-lg flex flex-col overflow-hidden animate-fade-in">
          {/* Header */}
          <div className="bg-salma-primary p-4 text-white flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="w-8 h-8 rounded-full bg-salma-gold flex items-center justify-center text-salma-primary font-bold">S</div>
              <span className="font-serif font-bold">Assistant SALMA</span>
            </div>
            <button onClick={() => setIsOpen(false)} className="text-white/70 hover:text-white">✕</button>
          </div>

          {/* Messages */}
          <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 space-y-4 bg-salma-bg/30">
            {messages.map((m, i) => (
              <div key={i} className={`flex ${m.role === "user" ? "justify-end" : "justify-start"}`}>
                <div className={`max-w-[80%] p-3 rounded-2xl text-sm ${
                  m.role === "user" 
                    ? "bg-salma-primary text-white rounded-tr-none" 
                    : "bg-white dark:bg-salma-bg border border-salma-border text-salma-text rounded-tl-none shadow-sm"
                }`}>
                  {m.text}
                </div>
              </div>
            ))}
            {isLoading && <div className="text-xs text-salma-text-muted animate-pulse italic">SALMA réfléchit...</div>}
          </div>

          {/* Input */}
          <div className="p-4 border-t border-salma-border bg-white dark:bg-salma-surface">
            <div className="flex gap-2">
              <input
                type="text"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyDown={(e) => e.key === "Enter" && handleSend()}
                placeholder="Posez votre question..."
                className="flex-1 bg-salma-bg border border-salma-border rounded-xl px-4 py-2 text-sm outline-none focus:border-salma-gold"
              />
              <button onClick={handleSend} className="bg-salma-gold text-salma-primary p-2 rounded-xl hover:scale-105 transition-transform">
                ➤
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Bouton d'ouverture */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="bg-salma-primary text-white p-4 rounded-full shadow-salma-lg hover:scale-110 transition-all active:scale-95 border-2 border-salma-gold"
      >
        <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
        </svg>
      </button>
    </div>
  );
}

// END OF FILE: src/components/ui/ChatbotWidget.tsx


// FILE: src/components/ui/CookieBanner.tsx
-----------------------------------------------
"use client";
import { useState, useEffect } from "react";
import Link from "next/link";
import SalmaButton from "./SalmaButton";
import { useLanguage } from "@/hooks/useLanguage";

export default function CookieBanner() {
  const { dictionary } = useLanguage();
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const consent = localStorage.getItem("salma-cookie-consent");
    if (!consent) setIsVisible(true);
  }, []);

  const accept = () => {
    localStorage.setItem("salma-cookie-consent", "accepted");
    setIsVisible(false);
  };

  if (!isVisible) return null;

  return (
    <div className="fixed bottom-6 left-6 right-6 md:left-auto md:right-8 md:w-[400px] bg-white dark:bg-salma-surface border border-salma-border shadow-salma-lg rounded-3xl p-6 z-[60] animate-fade-in">
      <p className="text-sm text-salma-text-muted mb-4 leading-relaxed">
        {dictionary.cookies.text}{" "}
        <Link href="/confidentialite" className="text-salma-primary font-bold underline">
          {dictionary.cookies.link}
        </Link>.
      </p>
      <div className="flex gap-3">
        <SalmaButton onClick={accept} variant="primary" size="sm" className="flex-1">
          {dictionary.cookies.accept}
        </SalmaButton>
        <button onClick={() => setIsVisible(false)} className="text-xs text-salma-text-muted hover:underline">
          {dictionary.cookies.decline}
        </button>
      </div>
    </div>
  );
}

// END OF FILE: src/components/ui/CookieBanner.tsx


// FILE: src/components/ui/NewsletterForm.tsx
-----------------------------------------------
// src/components/ui/NewsletterForm.tsx
"use client";

import { useState } from "react";
import { useLanguage } from "@/hooks/useLanguage";
import { newsletterDictionary } from "@/dictionaries/data";
import { eventsRepository } from "@/repositories/events.repository";

export default function NewsletterForm() {
  const {locale } = useLanguage();
  const [email, setEmail] = useState("");
  const [status, setStatus] = useState<"idle" | "loading" | "success" | "error">("idle");

  const handleSubscribe = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!email) return;

    setStatus("loading");
    try {
      await newsletterDictionary.subscribe({ email, source: "footer" });
      eventsRepository.trackNewsletterSignup();
      setStatus("success");
      setEmail("");
    } catch {
      setStatus("error");
    }
  };

  return (
    <div className="w-full">
      {status === "success" ? (
        <p className="text-emerald-400 text-sm font-bold animate-fade-in">
          ✓ {locale === "fr" ? "Inscription réussie !" : "Subscribed successfully!"}
        </p>
      ) : (
        <form onSubmit={handleSubscribe} className="flex flex-col gap-3">
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="votre@email.com"
            required
            className="px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white text-sm outline-none focus:border-salma-gold transition-all"
          />
          <button
            type="submit"
            disabled={status === "loading"}
            className="bg-salma-gold text-salma-primary font-bold py-3 rounded-xl text-xs uppercase tracking-widest hover:bg-salma-gold-light transition-all disabled:opacity-50"
          >
            {status === "loading" ? "..." : (locale === "fr" ? "S'abonner" : "Subscribe")}
          </button>
          {status === "error" && (
            <p className="text-red-400 text-[10px]">Erreur. Réessayez.</p>
          )}
        </form>
      )}
    </div>
  );
}

// END OF FILE: src/components/ui/NewsletterForm.tsx


// FILE: src/components/ui/SalmaBadge.tsx
-----------------------------------------------
import React from "react";

interface SalmaBadgeProps {
  status: "open" | "urgent" | "closed";
  label: string;
}

export default function SalmaBadge({ status, label }: SalmaBadgeProps) {
  const styles = {
    open: "bg-green-100 text-green-700 border-green-200",
    urgent: "bg-amber-100 text-amber-700 border-amber-200 animate-pulse",
    closed: "bg-red-100 text-red-700 border-red-200"
  };

  return (
    <span className={`px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider border ${styles[status]}`}>
      {label}
    </span>
  );
}

// END OF FILE: src/components/ui/SalmaBadge.tsx


// FILE: src/components/ui/SalmaButton.tsx
-----------------------------------------------
"use client";

import React from "react";

interface SalmaButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: "primary" | "accent" | "gold" | "outline";
  size?: "sm" | "md" | "lg";
  children: React.ReactNode;
}

export default function SalmaButton({
  variant = "primary",
  size = "md",
  children,
  className = "",
  ...props
}: SalmaButtonProps) {
  
  const baseStyles = "inline-flex items-center justify-center font-sans font-bold transition-all duration-300 rounded-lg active:scale-95";
  
  const variants = {
    primary: "bg-salma-primary text-white hover:bg-salma-accent shadow-salma-sm",
    accent: "bg-salma-accent text-white hover:bg-salma-primary shadow-salma-sm",
    gold: "bg-salma-gold text-salma-primary hover:bg-salma-gold-light shadow-salma-sm",
    outline: "border-2 border-salma-gold text-salma-gold hover:bg-salma-gold hover:text-white"
  };

  const sizes = {
    sm: "px-4 py-2 text-xs",
    md: "px-6 py-3 text-sm tracking-widest uppercase",
    lg: "px-8 py-4 text-base tracking-widest uppercase"
  };

  return (
    <button 
      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}
      {...props}
    >
      {children}
    </button>
  );
}

// END OF FILE: src/components/ui/SalmaButton.tsx


// FILE: src/components/ui/ScholarshipCard.tsx
-----------------------------------------------
"use client";

import Image from "next/image";
import Link from "next/link";
import { useLanguage } from "@/hooks/useLanguage";
import { getMediaUrl } from "@/lib/api-client";
import type { ScholarshipPublicListItem } from "@/types"; // Import depuis le nouveau barrel
import SalmaBadge from "./SalmaBadge";
import SalmaButton from "./SalmaButton";

interface ScholarshipCardProps {
  scholarship: ScholarshipPublicListItem;
}

export default function ScholarshipCard({ scholarship }: ScholarshipCardProps) {
  const { locale, dictionary } = useLanguage();

  // Mapping des textes selon la langue
  const title = locale === "fr" ? scholarship.titre_fr : scholarship.titre_en;
  const org = locale === "fr" ? scholarship.organisme_fr : scholarship.organisme_en;
  const langReq = locale === "fr" ? scholarship.exigence_langue_fr : scholarship.exigence_langue_en;
  
  // URL de l'image via le helper
  const imageUrl = getMediaUrl(scholarship.image_principale?.url_fichier);

  // Mapping des drapeaux
  const countryFlags: Record<string, string> = {
    chine: "🇨🇳",
    allemagne: "🇩🇪",
    france: "🇫🇷",
    canada: "🇨🇦",
    autre: "🌍",
  };

  return (
    <div className="group bg-white dark:bg-salma-surface rounded-2xl border border-salma-border overflow-hidden shadow-salma-sm hover:shadow-salma-md transition-all duration-500 flex flex-col h-full">
      {/* --- HEADER : Image & Badges --- */}
      <div className="relative h-52 w-full overflow-hidden">
        <Image
          src={imageUrl || "/image.jpg"}
          alt={title}
          fill
          className="object-cover group-hover:scale-110 transition-transform duration-700"
        />
        <div className="absolute inset-0 bg-gradient-to-t from-salma-primary/60 to-transparent opacity-60" />

        {/* Badge Pays */}
        <div className="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-[10px] font-black text-salma-primary flex items-center gap-2 shadow-sm uppercase">
          <span>{countryFlags[scholarship.pays_destination] || "🌍"}</span>
          {scholarship.pays_destination}
        </div>

        {/* Badge Statut */}
        <div className="absolute bottom-4 left-4">
          <SalmaBadge 
            status={scholarship.statut === 'publie' ? 'open' : scholarship.statut === 'expire' ? 'closed' : 'urgent'} 
            label={scholarship.statut} 
          />
        </div>
      </div>

      {/* --- BODY : Contenu --- */}
      <div className="p-6 flex flex-col flex-1">
        <div className="flex items-center gap-2 mb-2">
          <span className="text-salma-gold text-[10px] font-bold uppercase tracking-widest">
            {scholarship.niveau}
          </span>
          <span className="text-salma-text-muted text-[10px]">•</span>
          <span className="text-salma-gold text-[10px] font-bold uppercase tracking-widest">
            {scholarship.type_couverture}
          </span>
        </div>

        <h3 className="text-xl font-serif font-bold text-salma-primary dark:text-white leading-tight mb-3 line-clamp-2">
          {title}
        </h3>

        <p className="text-sm text-salma-text-muted line-clamp-2 mb-6 font-sans">
          {org}
        </p>

        {/* --- DETAILS --- */}
        <div className="mt-auto pt-4 border-t border-salma-border grid grid-cols-2 gap-4">
          <div>
            <span className="block text-[9px] text-salma-text-muted uppercase font-bold tracking-tighter">
              {dictionary.scholarships.language}
            </span>
            <span className="text-xs font-bold text-salma-primary dark:text-salma-gold">
              {langReq}
            </span>
          </div>
          <div>
            <span className="block text-[9px] text-salma-text-muted uppercase font-bold tracking-tighter">
              {dictionary.scholarships.deadline}
            </span>
            <span className="text-xs font-bold text-red-500">
              {scholarship.date_limite ? new Date(scholarship.date_limite).toLocaleDateString(locale) : "N/A"}
            </span>
          </div>
        </div>

        <Link href={`/bourses/${scholarship.id}`} className="w-full mt-6">
          <SalmaButton variant="outline" size="sm" className="w-full">
            {dictionary.scholarships.viewDetails}
          </SalmaButton>
        </Link>
      </div>
    </div>
  );
}

// END OF FILE: src/components/ui/ScholarshipCard.tsx


// FILE: src/components/ui/SectionTitle.tsx
-----------------------------------------------
import React from "react";

interface SectionTitleProps {
  title: string;
  subtitle?: string;
  align?: "left" | "center";
}

export default function SectionTitle({ 
  title, 
  subtitle, 
  align = "left" 
}: SectionTitleProps) {
  return (
    <div className={`mb-12 flex flex-col ${align === "center" ? "items-center text-center" : "items-start"}`}>
      {subtitle && (
        <span className="text-salma-gold font-sans font-bold text-xs tracking-[0.3em] uppercase mb-2">
          {subtitle}
        </span>
      )}
      <h2 className="text-3xl md:text-4xl font-serif text-salma-primary dark:text-white leading-tight">
        {title}
      </h2>
      <div className="gold-divider mt-4" />
    </div>
  );
}

// END OF FILE: src/components/ui/SectionTitle.tsx


// FILE: src/components/ui/WhatsAppButton.tsx
-----------------------------------------------
"use client";
import { useLanguage } from "@/hooks/useLanguage";

export default function WhatsAppButton() {
  const { dictionary } = useLanguage();
  const phoneNumber = "237699450984"; // Numéro AGT
  const message = encodeURIComponent(dictionary.contact.info.whatsappMsg);

  return (
    <a 
      href={`https://wa.me/${phoneNumber}?text=${message}`}
      target="_blank"
      rel="noopener noreferrer"
      className="fixed bottom-8 right-8 z-50 bg-[#25D366] text-white p-4 rounded-full shadow-2xl hover:scale-110 transition-transform active:scale-95 group"
    >
      <div className="absolute -top-12 right-0 bg-white text-black text-[10px] font-bold px-3 py-1 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
       Besoin d&apos;aide ?
      </div>
      <svg className="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.94 3.659 1.437 5.634 1.437h.005c6.558 0 11.895-5.335 11.898-11.893a11.821 11.821 0 00-3.48-8.413z" />
      </svg>
    </a>
  );
}

// END OF FILE: src/components/ui/WhatsAppButton.tsx


// FILE: src/components/Footer.tsx
-----------------------------------------------
"use client";

import Link from "next/link";
import { useLanguage } from "@/hooks/useLanguage";

export default function Footer() {
  const { dictionary } = useLanguage();

  return (
    <footer className="bg-salma-primary-dark text-white pt-20 pb-10">
      <div className="container mx-auto px-6">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
          
          {/* Colonne 1 : Branding */}
          <div className="space-y-6">
            <Link href="/" className="flex flex-col">
              <span className="text-3xl font-serif font-bold text-white leading-none">SALMA</span>
              <span className="text-[10px] uppercase tracking-[0.3em] text-salma-gold font-sans font-bold">Expertise AG Technologies</span>
            </Link>
            <p className="text-sm text-gray-400 leading-relaxed max-w-xs">
              {dictionary.footer.tagline}
            </p>
            <div className="p-4 border-l-2 border-salma-gold bg-white/5">
              <p className="text-xs italic text-salma-gold-light font-medium">
                &quot;{dictionary.footer.slogan}&quot;
              </p>
            </div>
          </div>

          {/* Colonne 2 : Liens Rapides */}
          <div>
            <h4 className="text-salma-gold font-bold uppercase tracking-widest text-xs mb-8">
              {dictionary.footer.links.title}
            </h4>
            <ul className="space-y-4">
              <li><Link href="/" className="text-sm text-gray-300 hover:text-white transition-colors">{dictionary.footer.links.home}</Link></li>
              <li><Link href="/bourses" className="text-sm text-gray-300 hover:text-white transition-colors">{dictionary.footer.links.bourses}</Link></li>
              <li><Link href="/a-propos" className="text-sm text-gray-300 hover:text-white transition-colors">{dictionary.footer.links.about}</Link></li>
              <li><Link href="/contact" className="text-sm text-gray-300 hover:text-white transition-colors">{dictionary.footer.links.contact}</Link></li>
              <li><Link href="/confidentialite" className="text-sm text-gray-300 hover:text-white transition-colors">{dictionary.cookies.link}
  </Link></li>
            </ul>
          </div>

          {/* Colonne 3 : Coordonnées */}
          <div>
            <h4 className="text-salma-gold font-bold uppercase tracking-widest text-xs mb-8">
              {dictionary.footer.contact.title}
            </h4>
            <ul className="space-y-6 text-sm text-gray-300">
              <li className="flex gap-4">
                <span className="text-salma-gold">📍</span>
                <span>{dictionary.footer.contact.address}</span>
              </li>
              <li className="flex gap-4">
                <span className="text-salma-gold">📞</span>
                <span>{dictionary.footer.contact.phones}</span>
              </li>
              <li className="flex gap-4">
                <span className="text-salma-gold">✉️</span>
                <span className="break-all">{dictionary.footer.contact.email}</span>
              </li>
            </ul>
          </div>

          {/* Colonne 4 : Newsletter / Badge AGT */}
          <div>
            <h4 className="text-salma-gold font-bold uppercase tracking-widest text-xs mb-8">
              AG Technologies
            </h4>
            <div className="bg-white/5 p-6 rounded-2xl border border-white/10">
              <p className="text-xs text-gray-400 mb-4 italic">
                {dictionary.hero.badge}
              </p>
              <div className="flex gap-3">
                 {/* Ici on pourrait mettre des icônes de réseaux sociaux */}
                 <div className="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-salma-gold hover:text-salma-primary transition-all cursor-pointer">f</div>
                 <div className="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-salma-gold hover:text-salma-primary transition-all cursor-pointer">in</div>
              </div>
            </div>
          </div>

        </div>

        {/* Barre de copyright */}
        <div className="pt-10 border-t border-white/10 flex flex-col md:flex-row justify-between items-center gap-6">
          <p className="text-[10px] text-gray-500 uppercase tracking-widest">
            {dictionary.footer.rights}
          </p>
          <div className="flex gap-8 text-[10px] text-gray-500 uppercase tracking-widest">
            <Link href="/mentions-legales" className="hover:text-salma-gold transition-colors">Mentions Légales</Link>
            <Link href="/confidentialite" className="hover:text-salma-gold transition-colors">Confidentialité</Link>
          </div>
        </div>
      </div>
    </footer>
  );
}

// END OF FILE: src/components/Footer.tsx


// FILE: src/components/LanguageSwitcher.tsx
-----------------------------------------------
"use client";

import { useLanguage } from "@/hooks/useLanguage";

export default function LanguageSwitcher() {
  const { locale, setLocale } = useLanguage();

  return (
    <button
      onClick={() => setLocale(locale === "fr" ? "en" : "fr")}
      className="flex items-center gap-2 px-3 py-2 rounded-lg bg-salma-surface border border-salma-border hover:border-salma-gold transition-all group"
    >
      <span className="text-xs font-bold font-sans tracking-widest text-salma-text">
        {locale === "fr" ? "EN" : "FR"}
      </span>
      <svg className="w-4 h-4 text-salma-gold group-hover:rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
    </button>
  );
}

// END OF FILE: src/components/LanguageSwitcher.tsx


// FILE: src/components/Navbar.tsx
-----------------------------------------------
"use client";

import Link from "next/link";
import { useState } from "react";
import { useLanguage } from "@/hooks/useLanguage";
import LanguageSwitcher from "./LanguageSwitcher";
import SalmaButton from "./ui/SalmaButton";

export default function Navbar() {
  const [isOpen, setIsOpen] = useState(false);
  const { dictionary } = useLanguage();

  const links = [
    { name: dictionary.nav.home, href: "/" },
    { name: dictionary.nav.bourses, href: "/bourses" },
    { name: dictionary.nav.services, href: "/services" },
    { name: dictionary.nav.about, href: "/a-propos" },
  ];

  return (
    <nav className="sticky top-0 z-50 w-full bg-white/90 dark:bg-salma-bg/90 backdrop-blur-md border-b border-salma-border">
      <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
        
        {/* LOGO */}
        <Link href="/" className="flex flex-col group">
          <span className="text-2xl font-serif font-bold text-salma-primary dark:text-white leading-none group-hover:text-salma-accent transition-colors">
            SALMA
          </span>
          <span className="text-[10px] uppercase tracking-[0.3em] text-salma-gold font-sans font-bold">
            Bourses de Voyage
          </span>
        </Link>

        {/* LINKS DESKTOP */}
        <div className="hidden lg:flex items-center gap-8">
          {links.map((link) => (
            <Link 
              key={link.href} 
              href={link.href}
              className="text-xs font-bold uppercase tracking-widest text-salma-primary dark:text-gray-300 hover:text-salma-accent transition-colors"
            >
              {link.name}
            </Link>
          ))}
          
          <div className="h-6 w-px bg-salma-border mx-2" />

          {/* ACTIONS */}
          <div className="flex items-center gap-4">
            <LanguageSwitcher />
            
            {/* CONTACT EN BOUTON POUR LA CONVERSION */}
            <Link href="/contact">
              <SalmaButton variant="primary" size="sm">
                {dictionary.nav.contact}
              </SalmaButton>
            </Link>

            {/* LIEN ADMIN DISCRET */}
            <Link 
              href="/admin/dashboard" 
              className="p-2 text-salma-text-muted hover:text-salma-primary transition-colors"
              title={dictionary.nav.admin}
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </Link>
          </div>
        </div>

        {/* MOBILE TOGGLE */}
        <button className="lg:hidden p-2 text-salma-primary" onClick={() => setIsOpen(!isOpen)}>
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={isOpen ? "M6 18L18 6" : "M4 6h16M4 12h16M4 18h16"} />
          </svg>
        </button>
      </div>

      {/* MOBILE MENU */}
      {isOpen && (
        <div className="lg:hidden absolute w-full bg-white dark:bg-salma-surface border-b border-salma-border p-6 flex flex-col gap-6 animate-fade-in shadow-xl">
          {links.map((link) => (
            <Link key={link.href} href={link.href} onClick={() => setIsOpen(false)} className="text-sm font-bold uppercase tracking-widest">
              {link.name}
            </Link>
          ))}
          <Link href="/contact" onClick={() => setIsOpen(false)} className="text-sm font-bold text-salma-accent uppercase tracking-widest">
             {dictionary.nav.contact}
          </Link>
          <div className="flex justify-between items-center pt-6 border-t border-salma-border">
            <div className="flex gap-4">
              <LanguageSwitcher />
            </div>
            <Link href="/admin/dashboard" onClick={() => setIsOpen(false)} className="text-xs font-bold text-salma-primary">
              {dictionary.nav.admin}
            </Link>
          </div>
        </div>
      )}
    </nav>
  );
}

// END OF FILE: src/components/Navbar.tsx


// FILE: src/components/ThemeSwitcher.tsx
-----------------------------------------------
"use client";

import { useTheme } from "next-themes";
import { useEffect, useState } from "react";

export default function ThemeSwitcher() {
  const {setTheme, resolvedTheme } = useTheme();
  const [mounted, setMounted] = useState(false);

  useEffect(() => setMounted(true), []);

  if (!mounted) return <div className="w-9 h-9" />; 

  const isDark = resolvedTheme === "dark";

  return (
    <button
      onClick={() => setTheme(isDark ? "light" : "dark")}
      className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-salma-primary-light transition-all border border-transparent hover:border-salma-border"
      aria-label="Toggle Theme"
    >
      {isDark ? (
        // Icône Soleil pour le mode Sombre
        <svg className="w-5 h-5 text-salma-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
      ) : (
        // Icône Lune pour le mode Clair
        <svg className="w-5 h-5 text-salma-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      )}
    </button>
  );
}

// END OF FILE: src/components/ThemeSwitcher.tsx


// FILE: src/config/i18n.ts
-----------------------------------------------
// src/config/i18n.ts
// ============================================================
//  SOURCE DE VÉRITÉ POUR L'INTERNATIONALISATION
//  Pour ajouter une nouvelle langue :
//    1. Ajouter son code dans le tableau `locales` ci-dessous
//    2. Créer le fichier src/dictionaries/{code}.ts
//    3. L'importer dans src/dictionaries/index.ts
//  C'est tout — aucun autre fichier à modifier.
// ============================================================

export const locales = ["en", "fr"] as const;

export type Locale = (typeof locales)[number];

/** Langue affichée par défaut si la détection système échoue */
export const defaultLocale: Locale = "en";

/** Noms affichables dans le sélecteur de langue */
export const localeLabels: Record<Locale, string> = {
  en: "English",
  fr: "Français",
};

/**
 * Détecte la langue préférée du navigateur.
 * Retourne une Locale supportée, ou defaultLocale en fallback.
 * Doit être appelée côté client uniquement.
 */
export function detectLocale(): Locale {
  if (typeof window === "undefined") return defaultLocale;

  // Cherche dans localStorage (préférence sauvegardée)
  try {
    const saved = localStorage.getItem("salma-locale") as Locale | null;
    if (saved && locales.includes(saved)) return saved;
  } catch {
    // localStorage indisponible
  }

  // Détecte la langue du navigateur
  const browserLang = navigator.language?.split("-")[0] as Locale;
  if (locales.includes(browserLang)) return browserLang;

  return defaultLocale;
}

// END OF FILE: src/config/i18n.ts


// FILE: src/contexts/LanguageContext.tsx
-----------------------------------------------
// src/contexts/LanguageContext.tsx
"use client";

import { createContext, useState, useEffect, ReactNode } from "react";
import { type Locale, detectLocale } from "@/config/i18n";
import { getDictionary, type DictionaryType } from "@/dictionaries";

interface LanguageContextType {
  locale: Locale;
  dictionary: DictionaryType;
  setLocale: (locale: Locale) => void;
}

export const LanguageContext = createContext<LanguageContextType | undefined>(
  undefined
);

export function LanguageProvider({ children }: { children: ReactNode }) {
  // On initialise avec des valeurs par défaut pour le SSR (Serveur)
  const [locale, setLocaleState] = useState<Locale>("fr"); 
  const [dictionary, setDictionary] = useState<DictionaryType>(getDictionary("fr"));
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    const detected = detectLocale();
    setLocaleState(detected);
    setDictionary(getDictionary(detected));
    setMounted(true); 
  }, []);

  const setLocale = (newLocale: Locale) => {
    setLocaleState(newLocale);
    setDictionary(getDictionary(newLocale));
    try {
      localStorage.setItem("salma-locale", newLocale);
    } catch {}
  };

  // IMPORTANT : Le Provider doit TOUJOURS être présent dans l'arbre
  // On utilise la visibilité CSS pour éviter le flash de texte anglais/français
  return (
    <LanguageContext.Provider value={{ locale, dictionary, setLocale }}>
      <div style={{ visibility: mounted ? "visible" : "hidden" }}>
        {children}
      </div>
    </LanguageContext.Provider>
  );
}

// END OF FILE: src/contexts/LanguageContext.tsx


// FILE: src/contexts/ThemeContext.tsx
-----------------------------------------------
// src/contexts/ThemeContext.tsx
"use client";

import { ThemeProvider as NextThemesProvider } from "next-themes";
import type { ThemeProviderProps } from "next-themes";

// ============================================================
//  THEME PROVIDER
//  Wrapper autour de next-themes.
//  Branché dans src/app/layout.tsx autour de tout l'arbre.
//
//  Usage dans un composant :
//  import { useTheme } from "@/hooks/useTheme";
//  const { theme, toggleTheme } = useTheme();
// ============================================================
export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return (
    <NextThemesProvider
      attribute="class"       // Ajoute/retire la classe .dark sur <html>
      defaultTheme="system"   // Suit le thème système par défaut
      enableSystem            // Active la détection système
      disableTransitionOnChange={false}
      {...props}
    >
      {children}
    </NextThemesProvider>
  );
}

// END OF FILE: src/contexts/ThemeContext.tsx


// FILE: src/dictionaries/data/cms.data-dictionary.ts
-----------------------------------------------
// src/dictionaries/data/cms.data-dictionary.ts
import { cmsPublicRepository, cmsAdminRepository } from "@/repositories/cms.repository";
import type { 
  SitePagePublic, 
  SitePageAdmin, 
  UpdateContentBlockPayload, 
  PitchVideo 
} from "@/types/api/cms.types";

export const cmsDictionary = {
  /** 
   * Récupère le contenu public d'une page par son slug 
   * Utilisé par la vitrine (ex: /a-propos)
   */
  getPage: (slug: string): Promise<SitePagePublic> =>
    cmsPublicRepository.getPageBySlug(slug), // Correction du nom ici

  /** 
   * Config globale sous forme de map clé/valeur 
   */
  getConfigMap: async (): Promise<Record<string, string>> => {
    const configs = await cmsPublicRepository.getConfig();
    return configs.reduce((acc, c) => {
      acc[c.cle_config] = c.valeur_fr;
      return acc;
    }, {} as Record<string, string>);
  },

  /** 
   * Vidéo de pitch active 
   */
  getActivePitchVideo: async (): Promise<PitchVideo | null> => {
    const videos = await cmsPublicRepository.getVideos();
    return videos.find((v) => v.est_active) ?? null;
  },

  // --- Espace Admin ---
  admin: {
    getPages: () => cmsAdminRepository.getPages(),
    getPage: (id: string): Promise<SitePageAdmin> => 
      cmsAdminRepository.getPageById(id),
    updateBloc: (pageId: string, blocId: string, payload: UpdateContentBlockPayload) => 
      cmsAdminRepository.patchBlock(pageId, blocId, payload),
  },
};

// END OF FILE: src/dictionaries/data/cms.data-dictionary.ts


// FILE: src/dictionaries/data/contact.data-dictionary.ts
-----------------------------------------------
// src/dictionaries/data/contact.data-dictionary.ts
// ==============================================================================
//  Dictionnaire de données — Demandes de Contact
//
//  RÈGLE ARCHITECTURE :
//  Server Components → data-dictionary → repository → api-client → Django
//
//  Les composants ne connaissent QUE ce fichier.
// ==============================================================================

import {
  contactPublicRepository,
  contactAdminRepository,
} from "@/repositories/contact.repository";
import type {
  ContactRequest,
  CreateContactPayload,
  UpdateContactPayload,
  PaginatedContactResponse,
  ContactFilters,
} from "@/types/api/contact.types";

// ==============================================================================
//  VITRINE — Soumission de contact / rendez-vous
// ==============================================================================

export const contactDictionary = {
  /**
   * Soumettre une demande de contact depuis la vitrine.
   * Utilisé par : /contact (ContactForm)
   */
  submit: (payload: CreateContactPayload): Promise<ContactRequest> => {
    return contactPublicRepository.submit(payload);
  },

  /**
   * Soumettre une demande de rendez-vous.
   * Utilise le même endpoint que le contact, avec un message préfixé.
   * Utilisé par : formulaire de prise de RDV
   */
  submitAppointment: (payload: CreateContactPayload): Promise<ContactRequest> => {
    return contactPublicRepository.submit({
      ...payload,
      message: `[RENDEZ-VOUS] ${payload.message}`,
    });
  },

  // ==============================================================================
  //  ADMIN — Dashboard
  // ==============================================================================

  admin: {
    /**
     * Liste des demandes de contact.
     * Utilisé par : /admin/contacts (tableau)
     */
    getList: (filters?: ContactFilters): Promise<PaginatedContactResponse> => {
      return contactAdminRepository.getList(filters);
    },

    /**
     * Détail d'une demande avec bourses associées.
     * Utilisé par : /admin/contacts/[id]
     */
    getById: (id: string): Promise<ContactRequest> => {
      return contactAdminRepository.getById(id);
    },

    /**
     * Marquer comme lu.
     */
    markAsRead: (id: string): Promise<ContactRequest> => {
      return contactAdminRepository.patch(id, { est_lu: true });
    },

    /**
     * Ajouter une note admin.
     */
    addNote: (id: string, notes: string): Promise<ContactRequest> => {
      return contactAdminRepository.patch(id, { notes_admin: notes });
    },

    /**
     * Modifier partiellement (lu + notes).
     */
    patch: (id: string, payload: UpdateContactPayload): Promise<ContactRequest> => {
      return contactAdminRepository.patch(id, payload);
    },

    /**
     * Supprimer une demande.
     */
    delete: (id: string): Promise<void> => {
      return contactAdminRepository.delete(id);
    },

    /**
     * Compter les contacts non lus (pour badge notification).
     */
    getUnreadCount: async (): Promise<number> => {
      const response = await contactAdminRepository.getList({
        est_lu: false,
        page_size: 1,
      });
      return response.count;
    },
  },
};

// END OF FILE: src/dictionaries/data/contact.data-dictionary.ts


// FILE: src/dictionaries/data/index.ts
-----------------------------------------------
// src/dictionaries/data/index.ts
// ==============================================================================
//  Barrel export — Dictionnaires de données SALMA
//
//  RÈGLE : Les Server Components et Client Components importent UNIQUEMENT d'ici.
//  Jamais directement depuis les repositories.
//
//  Usage :
//    import { scholarshipDictionary } from "@/dictionaries/data"
//    const featured = await scholarshipDictionary.getFeatured()
// ==============================================================================

export { scholarshipDictionary } from "./scholarship.data-dictionary";
export { cmsDictionary } from "./cms.data-dictionary";
export { contactDictionary } from "./contact.data-dictionary";
export { newsletterDictionary } from "./newsletter.data-dictionary";
export { kpiDictionary } from "./kpi.data-dictionary";

// Les modules sans dictionnaire dédié sont accessibles via les repositories
// Usage : import { mediaRepository } from "@/repositories"

// END OF FILE: src/dictionaries/data/index.ts


// FILE: src/dictionaries/data/kpi.data-dictionary.ts
-----------------------------------------------
// src/dictionaries/data/kpi.data-dictionary.ts
// ==============================================================================
//  Dictionnaire de données — KPI & Analytics
//  Point d'entrée unique pour toutes les stats du dashboard
// ==============================================================================

import { eventsRepository } from "@/repositories/events.repository";
import { kpiRepository} from "@/repositories/kpi.repository";
import type {
  KpiRealtime,
  KpiSnapshot,
  ConversionRate,
  VisitorEvent,
  VisitorEventPayload,
  EventFilters,
  KpiSnapshotFilters,
} from "@/types/api/kpi.types";
import type { PaginatedResponse } from "@/types/api/scholarship.types";

export const kpiDictionary = {
  // --- Tracking public (côté client, silencieux) ----------------------------

  track: (payload: VisitorEventPayload): Promise<void> =>
    eventsRepository.track(payload),

  trackPageView: (page: string): Promise<void> =>
    eventsRepository.trackPageView(page),

  trackScholarshipView: (bourseId: string): Promise<void> =>
    eventsRepository.trackScholarshipView(bourseId),

  trackContact: (bourseId?: string): Promise<void> =>
    eventsRepository.trackContactSubmit(bourseId),

  trackWhatsapp: (bourseId?: string): Promise<void> =>
    eventsRepository.trackWhatsappClick(bourseId),

  trackNewsletter: (): Promise<void> =>
    eventsRepository.trackNewsletterSignup(),

  // --- Dashboard admin -------------------------------------------------------

  admin: {
    /**
     * Stats en temps réel — widget principal du dashboard.
     * Appelé avec polling côté client (ex: toutes les 30s).
     */
    getRealtime: (): Promise<KpiRealtime> =>
      kpiRepository.adminGetRealtime(),

    /**
     * Snapshots historiques pour les graphiques.
     */
    getSnapshots: (filters?: KpiSnapshotFilters): Promise<KpiSnapshot[]> =>
      kpiRepository.adminGetSnapshots(filters),

    /**
     * Taux de conversion global + par bourse.
     */
    getConversion: (): Promise<ConversionRate> =>
      kpiRepository.adminGetConversion(),

    /**
     * Événements bruts filtrables (debug, analyse fine).
     */
    getEvents: (filters?: EventFilters): Promise<PaginatedResponse<VisitorEvent>> =>
      kpiRepository.adminGetEvents(filters),

    /**
     * Données pour le widget "Top bourses" du dashboard.
     * Retourne les 5 bourses avec le plus de vues.
     */
    getTopScholarships: async (limit = 5) => {
      const conversion = await kpiRepository.adminGetConversion();
      return conversion.par_bourse
        .sort((a, b) => b.nb_vues - a.nb_vues)
        .slice(0, limit);
    },
  },
};

// END OF FILE: src/dictionaries/data/kpi.data-dictionary.ts


// FILE: src/dictionaries/data/newsletter.data-dictionary.ts
-----------------------------------------------
// src/dictionaries/data/newsletter.data-dictionary.ts
// ==============================================================================
//  Dictionnaire de données — Newsletter & Annonces
//
//  RÈGLE ARCHITECTURE :
//  Server Components → data-dictionary → repository → api-client → Django
//
//  Les composants ne connaissent QUE ce fichier.
// ==============================================================================

import { newsletterRepository } from "@/repositories/newsletter.repository";
import type {
  NewsletterInscriptionPayload,
  NewsletterDesinscriptionPayload,
  NewsletterSubscriber,
  Announcement,
  CreateAnnouncementPayload,
  UpdateAnnouncementPayload,
  SendAnnouncementResponse,
  PaginatedSubscriberResponse,
  PaginatedAnnouncementResponse,
  SubscriberFilters,
  AnnouncementFilters,
} from "@/types/api/newsletter.types";

// ==============================================================================
//  VITRINE — Inscription / Désinscription
// ==============================================================================

export const newsletterDictionary = {
  /**
   * S'inscrire à la newsletter depuis la vitrine.
   * Utilisé par : footer, popup exit-intent
   */
  subscribe: (payload: NewsletterInscriptionPayload): Promise<{ detail: string }> => {
    return newsletterRepository.subscribe(payload);
  },

  /**
   * Se désinscrire.
   * Utilisé par : lien de désinscription
   */
  unsubscribe: (payload: NewsletterDesinscriptionPayload): Promise<{ detail: string }> => {
    return newsletterRepository.unsubscribe(payload);
  },

  // ==============================================================================
  //  ADMIN — Dashboard
  // ==============================================================================

  admin: {
    // --- Abonnés ---

    /**
     * Liste des abonnés.
     * Utilisé par : /admin/newsletter/abonnes
     */
    getSubscribers: (filters?: SubscriberFilters): Promise<PaginatedSubscriberResponse> => {
      return newsletterRepository.adminGetSubscribers(filters);
    },

    /**
     * Détail d'un abonné.
     */
    getSubscriberById: (id: string): Promise<NewsletterSubscriber> => {
      return newsletterRepository.adminGetSubscriberById(id);
    },

    /**
     * Supprimer un abonné.
     */
    deleteSubscriber: (id: string): Promise<void> => {
      return newsletterRepository.adminDeleteSubscriber(id);
    },

    // --- Annonces ---

    /**
     * Liste des annonces.
     * Utilisé par : /admin/newsletter/annonces
     */
    getAnnouncements: (filters?: AnnouncementFilters): Promise<PaginatedAnnouncementResponse> => {
      return newsletterRepository.adminGetAnnouncements(filters);
    },

    /**
     * Détail d'une annonce.
     */
    getAnnouncementById: (id: string): Promise<Announcement> => {
      return newsletterRepository.adminGetAnnouncementById(id);
    },

    /**
     * Créer une annonce (brouillon).
     */
    createAnnouncement: (payload: CreateAnnouncementPayload): Promise<Announcement> => {
      return newsletterRepository.adminCreateAnnouncement(payload);
    },

    /**
     * Modifier complètement une annonce.
     */
    updateAnnouncement: (id: string, payload: CreateAnnouncementPayload): Promise<Announcement> => {
      return newsletterRepository.adminUpdateAnnouncement(id, payload);
    },

    /**
     * Modifier partiellement.
     */
    patchAnnouncement: (id: string, payload: UpdateAnnouncementPayload): Promise<Announcement> => {
      return newsletterRepository.adminPatchAnnouncement(id, payload);
    },

    /**
     * Supprimer une annonce.
     */
    deleteAnnouncement: (id: string): Promise<void> => {
      return newsletterRepository.adminDeleteAnnouncement(id);
    },

    /**
     * Envoyer une annonce à tous les abonnés actifs (simulé).
     */
    sendAnnouncement: (id: string): Promise<SendAnnouncementResponse> => {
      return newsletterRepository.adminSendAnnouncement(id);
    },
  },
};

// END OF FILE: src/dictionaries/data/newsletter.data-dictionary.ts


// FILE: src/dictionaries/data/scholarship.data-dictionary.ts
-----------------------------------------------
// src/dictionaries/data/scholarship.data-dictionary.ts
import {
  scholarshipPublicRepository,
  scholarshipAdminRepository,
} from "@/repositories/scholarship.repository";
import type {
  ScholarshipPublicListItem,
  ScholarshipAdmin,
  ScholarshipListResponse,
  ScholarshipAdminListResponse,
  ScholarshipFilters,
  CreateScholarshipPayload,
  UpdateScholarshipPayload,
  FieldVisibilityMap,
} from "@/types/api/scholarship.types";
import { toFieldVisibilityMap } from "@/types/api/scholarship.types";

export const scholarshipDictionary = {
  /** Liste paginée pour le catalogue */
  getCatalog: (filters?: ScholarshipFilters): Promise<ScholarshipListResponse> => {
    return scholarshipPublicRepository.getList(filters);
  },

  /** Bourses vedettes pour la Home */
  getFeatured: (): Promise<ScholarshipPublicListItem[]> => {
    return scholarshipPublicRepository.getFeatured();
  },

  /** Détail d'une bourse avec map de visibilité */
  getDetail: async (id: string) => {
    const scholarship = await scholarshipPublicRepository.getById(id);
    const visibilityMap = toFieldVisibilityMap(scholarship.visibilites);
    return { scholarship, visibilityMap };
  },

  // --- Espace Admin ---
  admin: {
    getList: (filters?: ScholarshipFilters): Promise<ScholarshipAdminListResponse> => {
      return scholarshipAdminRepository.getList(filters);
    },
    getById: (id: string): Promise<ScholarshipAdmin> => {
      return scholarshipAdminRepository.getById(id);
    },
    create: (payload: CreateScholarshipPayload): Promise<ScholarshipAdmin> => {
      return scholarshipAdminRepository.create(payload);
    },
    patch: (id: string, payload: UpdateScholarshipPayload): Promise<ScholarshipAdmin> => {
      return scholarshipAdminRepository.patch(id, payload);
    },
    delete: (id: string): Promise<void> => {
      return scholarshipAdminRepository.delete(id);
    },
    saveVisibility: (bourseId: string, visibilityMap: FieldVisibilityMap): Promise<void> => {
      const payload = Object.entries(visibilityMap).map(([nom_du_champ, est_visible]) => ({
        nom_du_champ,
        est_visible,
      }));
      return scholarshipAdminRepository.bulkUpdateVisibility(bourseId, payload);
    },
  },
};

// END OF FILE: src/dictionaries/data/scholarship.data-dictionary.ts


// FILE: src/dictionaries/en.ts
-----------------------------------------------
// src/dictionaries/en.ts
export const en = {
  metadata: {
    title: "SALMA Travel Agency — Your China Visa in 3 Weeks",
    description: "SALMA is a professional agency specializing in China visa processing. Study, Tourist, Work Visas and Scholarships.",
  },

  nav: {
    home: "Home",
    services: "Services",
    bourses: "Scholarships",
    visa: "Visa",
    about: "About",
    contact: "Contact",
    getStarted: "Get Started",
    admin: "Admin",
  },

  scholarships: {
    sectionTitle: "Available Scholarships",
    deadline: "Deadline",
    language: "Language required",
    viewDetails: "View Details",
    levels: {
      LICENCE: "Bachelor",
      MASTER: "Master",
      DOCTORAT: "PhD / Doctorate",
      POST_DOC: "Post-Doc",
    },
    coverage: {
      TOTALE: "Full Scholarship",
      PARTIELLE: "Partial",
      SCOLARITÉ: "Tuition Fees",
      ALLOCATION: "Monthly Stipend",
    },
  },

  scholarshipDetail: {
    backToList: "Back to list",
    organization: "Funding Organization",
    eligibility: "Eligibility Criteria",
    benefits: "What the scholarship covers",
    studyFields: "Fields of study",
    applyTitle: "Interested in this scholarship?",
    applyDesc: "Contact our advisors to start your application process.",
    btnApply: "Apply via WhatsApp",
    btnForm: "Fill the form",
  },

  hero: {
    badge: "AG Technologies Expertise",
    title: "Achieve Your Dream of Studying in China & Germany",
    description: "Full support, visa processing in 3 weeks, and a satisfaction guarantee. Join top-tier global universities today.",
    ctaPrimary: "Find my scholarship",
    ctaSecondary: "Our visa services",
    trustIndicator: {
      count: "+500 students",
      text: "already supported this year",
    },
    imageAlt: "Study in China with SALMA",
    visaBadge: {
      number: "03",
      label: "Weeks for your Visa",
    },
  },

  trust: {
    expertise: {
      title: "AGT Expertise",
      desc: "End-to-end support by travel professionals.",
    },
    speed: {
      title: "Visa in 3 Weeks",
      desc: "Optimized procedures for a fast departure.",
    },
    guarantee: {
      title: "Satisfaction Guaranteed",
      desc: "Your success is our top priority.",
    },
  },

  stats: {
    visas: { value: "500+", label: "Visas Obtained" },
    partners: { value: "25+", label: "Partner Universities" },
    experience: { value: "05+", label: "Years of Experience" },
    satisfaction: { value: "100%", label: "Success Rate" },
  },

  featuredScholarships: {
    title: "Featured Scholarships",
    subtitle: "Outstanding Opportunities",
    viewAll: "View all scholarships",
  },

  successStories: {
    title: "They succeeded with SALMA",
    subtitle: "Success Stories",
    stories: [
      {
        name: "Marcelle T.",
        destination: "Peking University, China",
        quote: "Thanks to AGT's support, I got my full scholarship in less than two months. A professional and attentive team!",
        program: "Master in AI",
      },
      {
        name: "Cédric M.",
        destination: "TU Berlin, Germany",
        quote: "The visa process seemed complex, but SALMA handled everything. Highly recommend for those aiming for Germany.",
        program: "BSc in Mechanics",
      },
      {
        name: "Awa B.",
        destination: "Fudan University, China",
        quote: "Satisfaction guaranteed is not just a slogan, it's a reality. My Chinese dream came true thanks to them.",
        program: "Master in Business",
      },
    ],
  },

  catalog: {
    title: "All Scholarships",
    subtitle: "China & Germany",
    description: "Find the scholarship that matches your study project in China or Germany.",
    searchPlaceholder: "Search for a scholarship...",
    filterAll: "All",
    filterCountry: "Country",
    filterLevel: "Study Level",
    noResults: "No scholarships match your search.",
    found: "scholarships found",
  },

  servicesPage: {
    title: "Our Mobility Services",
    subtitle: "Comprehensive expertise for your journey",
    description: "Whether you are traveling to study, work, or visit, AG Technologies guarantees a simplified and secured process.",
    items: {
      study: { title: "Study Visa", desc: "Guaranteed admission to the top-tier universities in China and Germany." },
      tourist: { title: "Tourist Visa", desc: "Explore the world with a fast 3-week processing time." },
      work: { title: "Work Visa", desc: "Professional opportunities and complete administrative and legal support." },
      insurance: { title: "Travel Insurance", desc: "International health protection compliant with all consular requirements." }
    }
  },

  aboutPage: {
    title: "About SALMA",
    subtitle: "AG Technologies' Expertise",
    missionTitle: "Our Mission",
    missionDesc: "To facilitate access to international education and mobility for all Cameroonian talents. We serve as a strategic bridge between Africa, China, and Germany.",
    visionTitle: "Why Trust Us?",
    visionDesc: "Located in Yaoundé, Kadji Building, we operate with total transparency. Our 'Satisfied or Refunded' slogan is not just a promise; it is our core work ethic.",
    partners: "Our University Partnerships",
  },

  contact: {
    title: "Let's talk about your project",
    subtitle: "Contact us",
    form: {
      name: "Full Name",
      email: "Email Address",
      phone: "Phone (WhatsApp)",
      subject: "Desired Scholarship",
      message: "Your message",
      send: "Send my request",
      success: "Request sent successfully!",
    },
    info: {
      address: "Montée Anne rouge, Kadji Building, Yaoundé",
      email: "secretariatagtechnologies@gmail.com",
      whatsappMsg: "Hello SALMA, I would like information about scholarships for...",
    },
  },

  faq: {
    title: "Frequently Asked Questions",
    subtitle: "Everything about our services",
    items: [
      { q: "What are the visa processing times?", a: "Average of 03 weeks for China." },
      { q: "Is the refund guarantee real?", a: "Yes, it is a contractual commitment from AG Technologies." },
      { q: "Which countries do you cover?", a: "We specialize in China and Germany." },
    ],
  },

  common: {
    loading: "Loading...",
    error: "An error occurred",
    retry: "Retry",
    learnMore: "Learn More",
    close: "Close",
    back: "Back",
    next: "Next",
    previous: "Previous",
    seeAll: "See All",
    processingTime: "Processing Time",
    weeks: "weeks",
    guarantee: "Satisfaction Guaranteed",
  },

  footer: {
    tagline: "Your trusted partner for international mobility to China and Germany.",
    slogan: "Satisfied or Refunded — Excellence serving your future.",
    links: {
      title: "Navigation",
      home: "Home",
      bourses: "Scholarships",
      services: "Services",
      about: "About",
      contact: "Contact",
    },
    contact: {
      title: "Contact Us",
      address: "Montée Anne rouge, Kadji Building, Yaoundé",
      phones: "+237 6 99 45 09 84 / 6 51 74 03 28",
      email: "secretariatagtechnologies@gmail.com",
    },
    rights: "© 2026 SALMA by AG Technologies. All rights reserved.",
  },

  admin: {
    sidebar: {
      dashboard: "Dashboard",
      scholarships: "Scholarships Management",
      applications: "Applications",
      settings: "Settings",
      logout: "Logout",
    },
    scholarships: {
      title: "Scholarships",
      addBtn: "+ Add Scholarship",
      searchPlaceholder: "Search scholarship...",
      table: {
        title: "Scholarship Title",
        country: "Country",
        level: "Level",
        deadline: "Deadline",
        status: "Status",
        actions: "Actions",
        edit: "Edit",
        delete: "Delete",
        deleteConfirm: "Are you sure you want to delete this scholarship?",
      },
      status: {
        open: "Open",
        closed: "Closed",
        pending: "Pending",
      },
      country: {
        chine: "China",
        allemagne: "Germany",
        both: "China & Germany",
      },
      form: {
        addTitle: "Add New Scholarship",
        editTitle: "Edit Scholarship",
        title: "Scholarship Title",
        organization: "Funding Organization",
        country: "Destination Country",
        description: "Description",
        studyLevel: "Required Study Level",
        fieldOfStudy: "Field of Study",
        ageLimit: "Age Limit",
        languageReq: "Language Score (e.g. HSK 4, IELTS)",
        status: "Offer Status",
        deadline: "Deadline",
        coverageType: "Coverage Type",
        officialLink: "Official Link",
        cancel: "Cancel",
        save: "Save",
      }
    }
  },
  cookies: {
    text: "We use cookies to improve your experience and analyze our traffic. Check our",
    link: "privacy policy",
    accept: "Accept",
    decline: "Decline"
  }
} as const;

// END OF FILE: src/dictionaries/en.ts


// FILE: src/dictionaries/fr.ts
-----------------------------------------------
// src/dictionaries/fr.ts
export const fr = {
  metadata: {
    title: "SALMA Travel Agency — Votre visa Chine en 3 semaines",
    description: "SALMA est une agence professionnelle spécialisée dans l'obtention de visas pour la Chine. Visa Étude, Touriste, Travail et Bourse d'Étude.",
  },

  nav: {
    home: "Accueil",
    services: "Services",
    bourses: "Bourses",
    visa: "Visa",
    about: "À propos",
    contact: "Contact",
    getStarted: "Commencer",
    admin: "Admin",
  },

  scholarships: {
    sectionTitle: "Bourses Disponibles",
    deadline: "Date limite",
    language: "Langue requise",
    viewDetails: "Consulter l'offre",
    levels: { 
      LICENCE: "Licence",
      MASTER: "Master", 
      DOCTORAT: "Doctorat",
      POST_DOC: "Post-Doctorat"
    },
    coverage: { 
      TOTALE: "Bourse Complète", 
      PARTIELLE: "Partielle",
      SCOLARITÉ: "Frais de Scolarité",
      ALLOCATION: "Allocation Mensuelle"
    }
  },

  scholarshipDetail: {
    backToList: "Retour à la liste",
    organization: "Organisme financier",
    eligibility: "Critères d'éligibilité",
    benefits: "Ce que couvre la bourse",
    studyFields: "Domaines d'études",
    applyTitle: "Cette bourse vous intéresse ?",
    applyDesc: "Contactez nos conseillers pour monter votre dossier de candidature.",
    btnApply: "Postuler via WhatsApp",
    btnForm: "Remplir le formulaire"
  },

  hero: {
    badge: "Expertise AG Technologies",
    title: "Réalisez votre rêve d'études en Chine & Allemagne",
    description: "Accompagnement complet, obtention de visa en 3 semaines et garantie satisfait ou remboursé. Rejoignez les meilleures universités mondiales.",
    ctaPrimary: "Trouver ma bourse",
    ctaSecondary: "Nos services de visa",
    trustIndicator: {
      count: "+500 étudiants",
      text: "déjà accompagnés cette année"
    },
    imageAlt: "Étudier en Chine avec SALMA",
    visaBadge: {
      number: "03",
      label: "Semaines pour votre Visa"
    }
  },

  trust: {
    expertise: {
      title: "Expertise AGT",
      desc: "Un accompagnement de A à Z par des professionnels."
    },
    speed: {
      title: "Visa en 3 semaines",
      desc: "Des procédures optimisées pour un départ rapide."
    },
    guarantee: {
      title: "Satisfait ou Remboursé",
      desc: "Votre réussite est notre priorité absolue."
    }
  },

  stats: {
    visas: { value: "500+", label: "Visas Obtenus" },
    partners: { value: "25+", label: "Universités Partenaires" },
    experience: { value: "05+", label: "Années d'Expérience" },
    satisfaction: { value: "100%", label: "Taux de Réussite" }
  },

  featuredScholarships: {
    title: "Bourses à la une",
    subtitle: "Opportunités Exceptionnelles",
    viewAll: "Voir toutes les bourses",
  },

  successStories: {
    title: "Ils ont réussi avec SALMA",
    subtitle: "Histoires de Succès",
    stories: [
      {
        name: "Marcelle T.",
        destination: "Université de Pékin, Chine",
        quote: "Grâce à l'accompagnement d'AGT, j'ai obtenu ma bourse complète en moins de deux mois. Une équipe professionnelle et à l'écoute !",
        program: "Master en IA"
      },
      {
        name: "Cédric M.",
        destination: "TU Berlin, Allemagne",
        quote: "Le processus de visa semblait complexe, mais SALMA a tout géré. Je recommande vivement pour ceux qui visent l'Allemagne.",
        program: "Licence en Mécanique"
      },
      {
        name: "Awa B.",
        destination: "Université de Fudan, Chine",
        quote: "Satisfaite ou remboursée n'est pas qu'un slogan, c'est une réalité. Mon rêve chinois est devenu possible grâce à eux.",
        program: "Master en Commerce"
      }
    ]
  },

  catalog: {
    title: "Toutes nos bourses",
     subtitle: "Chine & Allemagne",
    description: "Trouvez la bourse qui correspond à votre projet d'études en Chine ou en Allemagne.",
    searchPlaceholder: "Rechercher une bourse...",
    filterAll: "Tous",
    filterCountry: "Pays",
    filterLevel: "Niveau d'études",
    noResults: "Aucune bourse ne correspond à votre recherche.",
    found: "bourses trouvées"
  },

  servicesPage: {
    title: "Nos Services de Mobilité",
    subtitle: "Une expertise complète pour votre voyage",
    description: "Que vous partiez pour étudier, travailler ou visiter, AG Technologies vous garantit une procédure simplifiée et sécurisée.",
    items: {
      study: { title: "Visa Étude", desc: "Admission garantie dans les meilleures universités de Chine et d'Allemagne." },
      tourist: { title: "Visa Touriste", desc: "Partez à la découverte du monde avec une procédure rapide en 3 semaines." },
      work: { title: "Visa Travail", desc: "Opportunités professionnelles et accompagnement administratif complet." },
      insurance: { title: "Assurance Voyage", desc: "Protection santé internationale conforme aux exigences consulaires." }
    }
  },

  aboutPage: {
    title: "À propos de SALMA",
    subtitle: "L'expertise d'AG Technologies",
    missionTitle: "Notre Mission",
    missionDesc: "Faciliter l'accès à l'éducation internationale et à la mobilité pour tous les talents camerounais. Nous servons de pont entre l'Afrique, la Chine et l'Allemagne.",
    visionTitle: "Pourquoi nous faire confiance ?",
    visionDesc: "Installés à Yaoundé, Immeuble Kadji, nous opérons avec une transparence totale. Notre slogan 'Satisfait ou Remboursé' n'est pas qu'une promesse, c'est notre éthique de travail.",
    partners: "Nos Partenariats Universitaires",
  },

  contact: {
    title: "Parlons de votre projet",
    subtitle: "Contactez-nous",
    form: {
      name: "Nom complet",
      email: "Adresse Email",
      phone: "Téléphone (WhatsApp)",
      subject: "Bourse souhaitée",
      message: "Votre message",
      send: "Envoyer ma demande",
      success: "Demande envoyée avec succès !"
    },
    info: {
      address: "Montée Anne rouge, Immeuble Kadji, Yaoundé",
      email: "secretariatagtechnologies@gmail.com",
      whatsappMsg: "Bonjour SALMA, je souhaiterais avoir des informations sur les bourses pour..."
    }
  },

  faq: {
    title: "Questions fréquentes",
    subtitle: "Tout savoir sur nos services",
    items: [
      { q: "Quels sont les délais pour le visa ?", a: "En moyenne 03 semaines pour la Chine." },
      { q: "La garantie remboursement est-elle réelle ?", a: "Oui, c'est un engagement contractuel d'AG Technologies." },
      { q: "Quels pays couvrez-vous ?", a: "Nous sommes spécialisés sur la Chine et l'Allemagne." }
    ]
  },

  common: {
    loading: "Chargement...",
    error: "Une erreur est survenue",
    retry: "Réessayer",
    learnMore: "En savoir plus",
    close: "Fermer",
    back: "Retour",
    next: "Suivant",
    previous: "Précédent",
    seeAll: "Voir tout",
    processingTime: "Délai de traitement",
    weeks: "semaines",
    guarantee: "Satisfait ou remboursé",
  },

  footer: {
    tagline: "Votre partenaire de confiance pour la mobilité internationale vers la Chine et l'Allemagne.",
    slogan: "Satisfait ou Remboursé — L'excellence au service de votre avenir.",
    links: {
      title: "Navigation",
      home: "Accueil",
      bourses: "Bourses",
      services: "Services",
      about: "À propos",
      contact: "Contact"
    },
    contact: {
      title: "Contactez-nous",
      address: "Montée Anne rouge, Immeuble Kadji, Yaoundé",
      phones: "+237 6 99 45 09 84 / 6 51 74 03 28",
      email: "secretariatagtechnologies@gmail.com"
    },
    rights: "© 2026 SALMA by AG Technologies. Tous droits réservés."
  },

  admin: {
    sidebar: {
      dashboard: "Tableau de bord",
      scholarships: "Gestion des Bourses",
      applications: "Candidatures",
      settings: "Paramètres",
      logout: "Déconnexion",
    },
    scholarships: {
      title: "Bourses d'études",
      addBtn: "+ Ajouter une bourse",
      searchPlaceholder: "Rechercher une bourse...",
      table: {
        title: "Titre de la bourse",
        country: "Pays",
        level: "Niveau",
        deadline: "Date limite",
        status: "Statut",
        actions: "Actions",
        edit: "Éditer",
        delete: "Supprimer",
        deleteConfirm: "Voulez-vous vraiment supprimer cette bourse ?",
      },
      status: {
        open: "Ouvert",
        closed: "Fermé",
        pending: "En attente",
      },
      country: {
        chine: "Chine",
        allemagne: "Allemagne",
        both: "Chine & Allemagne",
      },
      form: {
        addTitle: "Ajouter une nouvelle bourse",
        editTitle: "Modifier la bourse",
        title: "Titre de la bourse",
        organization: "Organisme financeur",
        country: "Pays de destination",
        description: "Description",
        studyLevel: "Niveau d'études requis",
        fieldOfStudy: "Domaine d'études",
        ageLimit: "Âge limite",
        languageReq: "Score de langue (ex: HSK 4, IELTS)",
        status: "Statut de l'offre",
        deadline: "Date limite",
        coverageType: "Type de couverture",
        officialLink: "Lien officiel",
        cancel: "Annuler",
        save: "Enregistrer",
      }
    }
  },
  cookies: {
    text: "Nous utilisons des cookies pour améliorer votre expérience et analyser notre trafic. Consultez notre",
    link: "politique de confidentialité",
    accept: "Accepter",
    decline: "Refuser"
  }
} as const;

// END OF FILE: src/dictionaries/fr.ts


// FILE: src/dictionaries/index.ts
-----------------------------------------------
import { fr } from "./fr";
import { en } from "./en";
import type { Locale } from "@/config/i18n";

// Utilitaire pour transformer les types "littéraux" (as const) en type "string"
// Cela permet d'avoir des textes différents entre FR et EN tout en gardant la même structure
type DeepString<T> = {
  [K in keyof T]: T[K] extends object ? DeepString<T[K]> : string;
};

// On définit le type global basé sur la structure de FR
export type DictionaryType = DeepString<typeof fr>;

// Registre des dictionnaires
// On utilise "as DictionaryType" pour assouplir la vérification des valeurs textuelles
const dictionaries: Record<Locale, DictionaryType> = {
  fr: fr as DictionaryType,
  en: en as DictionaryType,
};

export function getDictionary(locale: Locale): DictionaryType {
  return dictionaries[locale];
}

// END OF FILE: src/dictionaries/index.ts


// FILE: src/hooks/useAuth.ts
-----------------------------------------------
// src/hooks/useAuth.ts
// ==============================================================================
//  Hook useAuth — État d'authentification JWT côté client
//  Usage dans tout Client Component du dashboard admin
//
//  const { user, isLoading, isAuthenticated, login, logout } = useAuth();
// ==============================================================================
"use client";

import { useState, useEffect, useCallback } from "react";
import { useRouter } from "next/navigation";
import { authRepository } from "@/repositories/auth.repository";
import { tokenStorage } from "@/lib/api-client";
import type { AdminUser, LoginPayload } from "@/types/api/auth.types";

interface AuthState {
  user: AdminUser | null;
  isLoading: boolean;
  isAuthenticated: boolean;
  error: string | null;
}

export function useAuth() {
  const router = useRouter();
  const [state, setState] = useState<AuthState>({
    user: null,
    isLoading: true,
    isAuthenticated: false,
    error: null,
  });

  // ---------------------------------------------------------------------------
  //  Au montage : vérifier si un token existe et récupérer le profil
  // ---------------------------------------------------------------------------
  useEffect(() => {
    const init = async () => {
      const hasToken = authRepository.isAuthenticated();

      if (!hasToken) {
        setState({ user: null, isLoading: false, isAuthenticated: false, error: null });
        return;
      }

      try {
        const user = await authRepository.getMe();
        setState({ user, isLoading: false, isAuthenticated: true, error: null });
      } catch {
        // Token invalide ou expiré → tenter un refresh
        try {
          await authRepository.refreshToken();
          const user = await authRepository.getMe();
          setState({ user, isLoading: false, isAuthenticated: true, error: null });
        } catch {
          // Refresh échoué → déconnexion propre
          tokenStorage.clear();
          setState({ user: null, isLoading: false, isAuthenticated: false, error: null });
        }
      }
    };

    init();
  }, []);

  // ---------------------------------------------------------------------------
  //  Login
  // ---------------------------------------------------------------------------
  const login = useCallback(
    async (payload: LoginPayload, redirectTo = "/admin/dashboard") => {
      setState((prev) => ({ ...prev, isLoading: true, error: null }));

      try {
        const response = await authRepository.login(payload);
        setState({
          user: response.user,
          isLoading: false,
          isAuthenticated: true,
          error: null,
        });
        router.push(redirectTo);
      } catch (err) {
        const message =
          err instanceof Error ? err.message : "Identifiants incorrects.";
        setState((prev) => ({ ...prev, isLoading: false, error: message }));
        throw err; // Re-throw pour que le formulaire puisse réagir
      }
    },
    [router]
  );

  // ---------------------------------------------------------------------------
  //  Logout
  // ---------------------------------------------------------------------------
  const logout = useCallback(async () => {
    setState((prev) => ({ ...prev, isLoading: true }));
    await authRepository.logout();
    setState({ user: null, isLoading: false, isAuthenticated: false, error: null });
    router.push("/admin/login");
  }, [router]);

  // ---------------------------------------------------------------------------
  //  Clear error
  // ---------------------------------------------------------------------------
  const clearError = useCallback(() => {
    setState((prev) => ({ ...prev, error: null }));
  }, []);

  return {
    user: state.user,
    isLoading: state.isLoading,
    isAuthenticated: state.isAuthenticated,
    error: state.error,
    login,
    logout,
    clearError,
  };
}

// END OF FILE: src/hooks/useAuth.ts


// FILE: src/hooks/useLanguage.ts
-----------------------------------------------
// src/hooks/useLanguage.ts
"use client";

import { useContext } from "react";
import { LanguageContext } from "@/contexts/LanguageContext";

// ============================================================
//  HOOK useLanguage
//  Usage dans n'importe quel composant :
//
//  const { locale, dictionary, setLocale } = useLanguage();
//  <h1>{dictionary.hero.title}</h1>
//  <button onClick={() => setLocale("fr")}>FR</button>
// ============================================================
export function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error("useLanguage doit être utilisé dans un <LanguageProvider>");
  }
  return context;
}

// END OF FILE: src/hooks/useLanguage.ts


// FILE: src/hooks/useTheme.ts
-----------------------------------------------
// src/hooks/useTheme.ts
"use client";

import { useTheme as useNextTheme } from "next-themes";

// ============================================================
//  HOOK useTheme
//  Wrapper autour de next-themes pour une API plus simple.
//
//  Usage dans n'importe quel composant :
//
//  const { theme, isDark, toggleTheme, setTheme } = useTheme();
//
//  <button onClick={toggleTheme}>
//    {isDark ? "Mode clair" : "Mode sombre"}
//  </button>
// ============================================================
export function useTheme() {
  const { theme, setTheme, resolvedTheme } = useNextTheme();

  const isDark = resolvedTheme === "dark";

  const toggleTheme = () => {
    setTheme(isDark ? "light" : "dark");
  };

  return {
    theme,           // "light" | "dark" | "system"
    resolvedTheme,   // "light" | "dark" (jamais "system")
    isDark,          // boolean — pratique pour les conditions
    toggleTheme,     // bascule light ↔ dark
    setTheme,        // contrôle direct si besoin
  };
}

// END OF FILE: src/hooks/useTheme.ts


// FILE: src/lib/api-client.ts
-----------------------------------------------
// src/lib/api-client.ts
// ==============================================================================
//  Client HTTP central du projet SALMA
//  - Toutes les requêtes passent par ici
//  - Gestion automatique du token JWT (Authorization header)
//  - Gestion des erreurs unifiée
//  - Support des query params, revalidation ISR et multipart/form-data
// ==============================================================================

export const API_URL = process.env.NEXT_PUBLIC_API_URL || "http://127.0.0.1:8000/api";
export const BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL || "http://127.0.0.1:8000";

// ==============================================================================
//  Types
// ==============================================================================

export interface ApiError {
  status: number;
  message: string;
  detail?: Record<string, unknown>;
}

export class ApiException extends Error {
  status: number;
  detail?: Record<string, unknown>;

  constructor(error: ApiError) {
    super(error.message);
    this.name = "ApiException";
    this.status = error.status;
    this.detail = error.detail;
  }
}

interface FetchOptions extends RequestInit {
  /** Query params ajoutés à l'URL : { page: "2", country: "cn" } */
  params?: Record<string, string | number | boolean | undefined>;
  /** Secondes de revalidation ISR Next.js (Server Components uniquement) */
  revalidate?: number | false;
  /** Si true, ne pas ajouter Content-Type (pour FormData/multipart) */
  isMultipart?: boolean;
}

// ==============================================================================
//  Helpers JWT
//  Côté client uniquement — les Server Components utilisent les cookies httpOnly
// ==============================================================================

const TOKEN_KEY = "salma_access_token";
const REFRESH_KEY = "salma_refresh_token";

export const tokenStorage = {
  getAccess: (): string | null => {
    if (typeof window === "undefined") return null;
    return localStorage.getItem(TOKEN_KEY);
  },
  getRefresh: (): string | null => {
    if (typeof window === "undefined") return null;
    return localStorage.getItem(REFRESH_KEY);
  },
  set: (access: string, refresh: string): void => {
    if (typeof window === "undefined") return;
    localStorage.setItem(TOKEN_KEY, access);
    localStorage.setItem(REFRESH_KEY, refresh);
  },
  clear: (): void => {
    if (typeof window === "undefined") return;
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(REFRESH_KEY);
  },
};

// ==============================================================================
//  Helper — construire l'URL complète d'un média Django
//  Usage : getMediaUrl("/media/bourses/image.jpg") → "http://....:8000/media/..."
// ==============================================================================
export function getMediaUrl(path: string | null | undefined): string | null {
  if (!path) return null;
  if (path.startsWith("http")) return path; // déjà absolu
  return `${BACKEND_URL}${path.startsWith("/") ? path : `/${path}`}`;
}

// ==============================================================================
//  Fonction de fetch centrale
// ==============================================================================

async function apiFetch<T>(endpoint: string, options: FetchOptions = {}): Promise<T> {
  const { params, revalidate, isMultipart, ...customConfig } = options;

  // --- Construction de l'URL ---
  const url = new URL(`${API_URL}${endpoint.startsWith("/") ? endpoint : `/${endpoint}`}`);
  if (params) {
    Object.entries(params).forEach(([key, value]) => {
      if (value !== undefined && value !== null && value !== "") {
        url.searchParams.append(key, String(value));
      }
    });
  }

  // --- Headers ---
  const headers: Record<string, string> = {};

  // Content-Type automatique (sauf pour FormData)
  if (!isMultipart) {
    headers["Content-Type"] = "application/json";
  }

  // Injection du token JWT si disponible (côté client)
  const token = tokenStorage.getAccess();
  if (token) {
    headers["Authorization"] = `Bearer ${token}`;
  }

  // Merge avec les headers personnalisés
  if (customConfig.headers) {
    Object.assign(headers, customConfig.headers);
  }

  // --- Config fetch ---
  const config: RequestInit = {
    ...customConfig,
    headers,
    // Support ISR Next.js pour les Server Components
    next: revalidate !== undefined ? { revalidate } : customConfig.next,
  };

  // --- Exécution ---
  try {
    const response = await fetch(url.toString(), config);

    // Réponse vide (DELETE, etc.)
    if (response.status === 204) return {} as T;

    // Tentative de parsing JSON
    const data = await response.json().catch(() => ({}));

    // Erreur HTTP
    if (!response.ok) {
      throw new ApiException({
        status: response.status,
        message: extractErrorMessage(data, response.status),
        detail: data,
      });
    }

    return data as T;
  } catch (error) {
    // Re-throw si c'est déjà notre type d'erreur
    if (error instanceof ApiException) throw error;

    // Erreur réseau (backend inaccessible, CORS, etc.)
    throw new ApiException({
      status: 0,
      message: "Impossible de contacter le serveur. Vérifie ta connexion ou l'adresse API.",
      detail: { originalError: String(error) },
    });
  }
}

// ==============================================================================
//  Helper — Extraction du message d'erreur Django DRF
// ==============================================================================

function extractErrorMessage(data: Record<string, unknown>, status: number): string {
  if (typeof data?.detail === "string") return data.detail;
  if (typeof data?.message === "string") return data.message;
  if (status === 401) return "Non authentifié. Veuillez vous connecter.";
  if (status === 403) return "Accès refusé. Vous n'avez pas les permissions nécessaires.";
  if (status === 404) return "Ressource introuvable.";
  if (status === 422 || status === 400) return "Données invalides. Vérifiez le formulaire.";
  if (status >= 500) return "Erreur serveur. Contactez l'administrateur.";
  return `Erreur inattendue (${status})`;
}

// ==============================================================================
//  API publique du client — utilisée par tous les repositories
// ==============================================================================

export const api = {
  get: <T>(url: string, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "GET" }),

  post: <T>(url: string, body: unknown, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "POST", body: JSON.stringify(body) }),

  put: <T>(url: string, body: unknown, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "PUT", body: JSON.stringify(body) }),

  patch: <T>(url: string, body: unknown, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "PATCH", body: JSON.stringify(body) }),

  delete: <T>(url: string, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "DELETE" }),

  /** Pour les uploads fichiers (FormData — pas de Content-Type automatique) */
  upload: <T>(url: string, formData: FormData, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "POST", body: formData, isMultipart: true }),

  /** Upload avec méthode PATCH (ex: mise à jour partielle avec fichier) */
  uploadPatch: <T>(url: string, formData: FormData, options?: FetchOptions) =>
    apiFetch<T>(url, { ...options, method: "PATCH", body: formData, isMultipart: true }),
};

// END OF FILE: src/lib/api-client.ts


// FILE: src/repositories/auth.repository.ts
-----------------------------------------------
// src/repositories/auth.repository.ts
// ==============================================================================
//  Repository — Authentification JWT
//  Couche d'accès aux 9 endpoints /api/auth/*
//  Ne connaît que api-client.ts et les types auth
// ==============================================================================

import { api, tokenStorage } from "@/lib/api-client";
import type {
  LoginPayload,
  LoginResponse,
  LogoutPayload,
  RegisterPayload,
  AdminUser,
  ChangePasswordPayload,
  ResetPasswordRequestPayload,
  ResetPasswordConfirmPayload,
  UpdateProfilePayload,
  TokenRefreshPayload,
  TokenRefreshResponse,
} from "@/types/api/auth.types";

const BASE = "/auth";

export const authRepository = {
  /**
   * POST /api/auth/login
   * Connexion → retourne les tokens + profil
   * Stocke automatiquement les tokens
   */
  login: async (payload: LoginPayload): Promise<LoginResponse> => {
    const response = await api.post<LoginResponse>(`${BASE}/login`, payload);
    tokenStorage.set(response.access, response.refresh);
    return response;
  },

  /**
   * POST /api/auth/logout
   * Déconnexion → blacklist le refresh token + efface le storage
   */
  logout: async (): Promise<void> => {
    const refresh = tokenStorage.getRefresh();
    if (refresh) {
      const payload: LogoutPayload = { refresh };
      await api.post<void>(`${BASE}/logout`, payload).catch(() => {
        // Même si le logout échoue côté serveur, on efface localement
      });
    }
    tokenStorage.clear();
  },

  /**
   * POST /api/auth/register
   * Créer un compte admin (super admin uniquement)
   */
  register: async (payload: RegisterPayload): Promise<AdminUser> => {
    return api.post<AdminUser>(`${BASE}/register`, payload);
  },

  /**
   * GET /api/auth/me
   * Récupérer le profil de l'admin connecté
   */
  getMe: async (): Promise<AdminUser> => {
    return api.get<AdminUser>(`${BASE}/me`);
  },

  /**
   * PATCH /api/auth/me
   * Modifier partiellement le profil
   */
  updateProfile: async (payload: UpdateProfilePayload): Promise<AdminUser> => {
    return api.patch<AdminUser>(`${BASE}/me`, payload);
  },

  /**
   * PUT /api/auth/change-password
   * Modifier le mot de passe
   */
  changePassword: async (payload: ChangePasswordPayload): Promise<void> => {
    return api.put<void>(`${BASE}/change-password`, payload);
  },

  /**
   * POST /api/auth/reset-password
   * Demander réinitialisation par email (simulé)
   */
  requestPasswordReset: async (payload: ResetPasswordRequestPayload): Promise<void> => {
    return api.post<void>(`${BASE}/reset-password`, payload);
  },

  /**
   * POST /api/auth/reset-password/confirm
   * Confirmer le nouveau mot de passe avec le token reçu par email
   */
  confirmPasswordReset: async (payload: ResetPasswordConfirmPayload): Promise<void> => {
    return api.post<void>(`${BASE}/reset-password/confirm`, payload);
  },

  /**
   * POST /api/auth/token/refresh
   * Rafraîchir le token d'accès avec le refresh token
   * Stocke automatiquement le nouveau token
   */
  refreshToken: async (): Promise<TokenRefreshResponse | null> => {
    const refresh = tokenStorage.getRefresh();
    if (!refresh) return null;

    const payload: TokenRefreshPayload = { refresh };
    const response = await api.post<TokenRefreshResponse>(`${BASE}/token/refresh`, payload);

    // Mettre à jour le storage avec le nouveau access token
    const newRefresh = response.refresh ?? refresh;
    tokenStorage.set(response.access, newRefresh);

    return response;
  },

  /**
   * Vérifie si un token est stocké côté client (ne valide pas avec le serveur)
   */
  isAuthenticated: (): boolean => {
    return !!tokenStorage.getAccess();
  },
};

// END OF FILE: src/repositories/auth.repository.ts


// FILE: src/repositories/chatbot.repository.ts
-----------------------------------------------
// src/repositories/chatbot.repository.ts
import { api as apiClient } from "@/lib/api-client";
import type {
  FaqEntry,
  ChatbotMessagePayload,   // Au lieu de ChatbotQueryPayload
  ChatbotMessageResponse,  // Au lieu de ChatbotResponse
  CreateFaqEntryPayload,   // Au lieu de CreateFaqPayload
  UpdateFaqEntryPayload,   // Au lieu de UpdateFaqPayload
} from "@/types/api/chatbot.types";

export const chatbotRepository = {
  /** POST /api/chatbot/message — interroger le chatbot (public) */
  query: (payload: ChatbotMessagePayload): Promise<ChatbotMessageResponse> =>
    apiClient.post("/chatbot/message", payload),

  /** GET /api/admin/chatbot/questions */
  adminGetFaqs: (): Promise<FaqEntry[]> =>
    apiClient.get<FaqEntry[]>("/admin/chatbot/questions"),

  /** GET /api/admin/chatbot/questions/{id} */
  adminGetFaq: (id: string): Promise<FaqEntry> =>
    apiClient.get(`/admin/chatbot/questions/${id}`),

  /** POST /api/admin/chatbot/questions */
  adminCreateFaq: (payload: CreateFaqEntryPayload): Promise<FaqEntry> =>
    apiClient.post("/admin/chatbot/questions", payload),

  /** PATCH /api/admin/chatbot/questions/{id} */
  adminUpdateFaq: (id: string, payload: UpdateFaqEntryPayload): Promise<FaqEntry> =>
    apiClient.patch(`/admin/chatbot/questions/${id}`, payload),

  /** DELETE /api/admin/chatbot/questions/{id} */
  adminDeleteFaq: (id: string): Promise<void> =>
    apiClient.delete(`/admin/chatbot/questions/${id}`),
};

// END OF FILE: src/repositories/chatbot.repository.ts


// FILE: src/repositories/cms.repository.ts
-----------------------------------------------
// src/repositories/cms.repository.ts
// ==============================================================================
//  Repository — CMS (Pages, Blocs, Config, Vidéos)
//  20 endpoints : 4 publics + 16 admin
// ==============================================================================

import { api } from "@/lib/api-client";
import type {
  SitePagePublic,
  SitePageAdmin,
  CreateSitePagePayload,
  UpdateSitePagePayload,
  ContentBlock,
  CreateContentBlockPayload,
  UpdateContentBlockPayload,
  SiteConfig,
  CreateSiteConfigPayload,
  UpdateSiteConfigPayload,
  PitchVideo,
  CreatePitchVideoPayload,
  UpdatePitchVideoPayload,
} from "@/types/api/cms.types";

// ==============================================================================
//  Endpoints PUBLICS (vitrine)
// ==============================================================================

export const cmsPublicRepository = {
  /**
   * GET /api/pages
   * Liste des pages publiées
   */
  getPages: (): Promise<SitePagePublic[]> => {
    return api.get<SitePagePublic[]>("/pages", { revalidate: 120 });
  },

  /**
   * GET /api/pages/{slug}
   * Contenu complet d'une page (blocs visibles uniquement)
   */
  getPageBySlug: (slug: string): Promise<SitePagePublic> => {
    return api.get<SitePagePublic>(`/pages/${slug}`, { revalidate: 60 });
  },

  /**
   * GET /api/config
   * Configurations globales du site
   */
  getConfig: (): Promise<SiteConfig[]> => {
    return api.get<SiteConfig[]>("/config", { revalidate: 120 });
  },

  /**
   * GET /api/videos
   * Vidéos de pitch actives
   */
  getVideos: (): Promise<PitchVideo[]> => {
    return api.get<PitchVideo[]>("/videos", { revalidate: 120 });
  },
};

// ==============================================================================
//  Endpoints ADMIN (dashboard)
// ==============================================================================

export const cmsAdminRepository = {

  // --- Pages -----------------------------------------------------------------

  /**
   * GET /api/admin/pages
   * Liste de toutes les pages (publiées ou non)
   */
  getPages: (): Promise<SitePageAdmin[]> => {
    return api.get<SitePageAdmin[]>("/admin/pages");
  },

  /**
   * GET /api/admin/pages/{id}
   * Détail avec tous les blocs
   */
  getPageById: (id: string): Promise<SitePageAdmin> => {
    return api.get<SitePageAdmin>(`/admin/pages/${id}`);
  },

  /**
   * POST /api/admin/pages
   * Créer une page
   */
  createPage: (payload: CreateSitePagePayload): Promise<SitePageAdmin> => {
    return api.post<SitePageAdmin>("/admin/pages", payload);
  },

  /**
   * PUT /api/admin/pages/{id}
   * Modifier complètement une page
   */
  updatePage: (id: string, payload: CreateSitePagePayload): Promise<SitePageAdmin> => {
    return api.put<SitePageAdmin>(`/admin/pages/${id}`, payload);
  },

  /**
   * PATCH /api/admin/pages/{id}
   * Modifier partiellement
   */
  patchPage: (id: string, payload: UpdateSitePagePayload): Promise<SitePageAdmin> => {
    return api.patch<SitePageAdmin>(`/admin/pages/${id}`, payload);
  },

  /**
   * DELETE /api/admin/pages/{id}
   */
  deletePage: (id: string): Promise<void> => {
    return api.delete<void>(`/admin/pages/${id}`);
  },

  // --- Blocs de contenu (nested sous pages) ----------------------------------

  /**
   * POST /api/admin/pages/{pageId}/blocs
   * Ajouter un bloc à une page
   */
  createBlock: (pageId: string, payload: CreateContentBlockPayload): Promise<ContentBlock> => {
    return api.post<ContentBlock>(`/admin/pages/${pageId}/blocs`, payload);
  },

  /**
   * PUT /api/admin/pages/{pageId}/blocs/{blocId}
   * Modifier complètement un bloc
   */
  updateBlock: (pageId: string, blocId: string, payload: CreateContentBlockPayload): Promise<ContentBlock> => {
    return api.put<ContentBlock>(`/admin/pages/${pageId}/blocs/${blocId}`, payload);
  },

  /**
   * PATCH /api/admin/pages/{pageId}/blocs/{blocId}
   * Modifier partiellement un bloc
   */
  patchBlock: (pageId: string, blocId: string, payload: UpdateContentBlockPayload): Promise<ContentBlock> => {
    return api.patch<ContentBlock>(`/admin/pages/${pageId}/blocs/${blocId}`, payload);
  },

  /**
   * DELETE /api/admin/pages/{pageId}/blocs/{blocId}
   */
  deleteBlock: (pageId: string, blocId: string): Promise<void> => {
    return api.delete<void>(`/admin/pages/${pageId}/blocs/${blocId}`);
  },

  // --- Config globale --------------------------------------------------------

  /**
   * GET /api/admin/config
   * Liste de toutes les configs
   */
  getConfigs: (): Promise<SiteConfig[]> => {
    return api.get<SiteConfig[]>("/admin/config");
  },

  /**
   * POST /api/admin/config
   * Créer une config
   */
  createConfig: (payload: CreateSiteConfigPayload): Promise<SiteConfig> => {
    return api.post<SiteConfig>("/admin/config", payload);
  },

  /**
   * PUT /api/admin/config/{cle}
   * Modifier complètement
   */
  updateConfig: (cle: string, payload: CreateSiteConfigPayload): Promise<SiteConfig> => {
    return api.put<SiteConfig>(`/admin/config/${cle}`, payload);
  },

  /**
   * PATCH /api/admin/config/{cle}
   * Modifier partiellement
   */
  patchConfig: (cle: string, payload: UpdateSiteConfigPayload): Promise<SiteConfig> => {
    return api.patch<SiteConfig>(`/admin/config/${cle}`, payload);
  },

  /**
   * DELETE /api/admin/config/{cle}
   */
  deleteConfig: (cle: string): Promise<void> => {
    return api.delete<void>(`/admin/config/${cle}`);
  },

  // --- Vidéos de pitch -------------------------------------------------------

  /**
   * GET /api/admin/videos
   * Liste des vidéos
   */
  getVideos: (): Promise<PitchVideo[]> => {
    return api.get<PitchVideo[]>("/admin/videos");
  },

  /**
   * GET /api/admin/videos/{id}
   * Détail d'une vidéo
   */
  getVideoById: (id: string): Promise<PitchVideo> => {
    return api.get<PitchVideo>(`/admin/videos/${id}`);
  },

  /**
   * POST /api/admin/videos
   * Ajouter une vidéo
   */
  createVideo: (payload: CreatePitchVideoPayload): Promise<PitchVideo> => {
    return api.post<PitchVideo>("/admin/videos", payload);
  },

  /**
   * PUT /api/admin/videos/{id}
   * Modifier complètement
   */
  updateVideo: (id: string, payload: CreatePitchVideoPayload): Promise<PitchVideo> => {
    return api.put<PitchVideo>(`/admin/videos/${id}`, payload);
  },

  /**
   * PATCH /api/admin/videos/{id}
   * Modifier partiellement
   */
  patchVideo: (id: string, payload: UpdatePitchVideoPayload): Promise<PitchVideo> => {
    return api.patch<PitchVideo>(`/admin/videos/${id}`, payload);
  },

  /**
   * DELETE /api/admin/videos/{id}
   */
  deleteVideo: (id: string): Promise<void> => {
    return api.delete<void>(`/admin/videos/${id}`);
  },
};

// END OF FILE: src/repositories/cms.repository.ts


// FILE: src/repositories/contact.repository.ts
-----------------------------------------------
// src/repositories/contact.repository.ts
// ==============================================================================
//  Repository — Demandes de Contact
//  5 endpoints : 1 public + 4 admin
// ==============================================================================

import { api } from "@/lib/api-client";
import type {
  ContactRequest,
  CreateContactPayload,
  UpdateContactPayload,
  PaginatedContactResponse,
  ContactFilters,
} from "@/types/api/contact.types";

const PUBLIC = "/contact";
const ADMIN = "/admin/contacts";

// ==============================================================================
//  Endpoint PUBLIC (vitrine)
// ==============================================================================

export const contactPublicRepository = {
  /**
   * POST /api/contact
   * Soumettre une demande de contact (+ bourses optionnelles + newsletter)
   */
  submit: (payload: CreateContactPayload): Promise<ContactRequest> => {
    return api.post<ContactRequest>(PUBLIC, payload);
  },
};

// ==============================================================================
//  Endpoints ADMIN (dashboard)
// ==============================================================================

export const contactAdminRepository = {
  /**
   * GET /api/admin/contacts
   * Liste des demandes (filtres : lu/non lu)
   */
  getList: (filters?: ContactFilters): Promise<PaginatedContactResponse> => {
    const params: Record<string, string> = {};
    if (filters?.est_lu !== undefined) params.est_lu = String(filters.est_lu);
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.page_size) params.page_size = String(filters.page_size);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<PaginatedContactResponse>(ADMIN, { params });
  },

  /**
   * GET /api/admin/contacts/{id}
   * Détail avec bourses associées
   */
  getById: (id: string): Promise<ContactRequest> => {
    return api.get<ContactRequest>(`${ADMIN}/${id}`);
  },

  /**
   * PATCH /api/admin/contacts/{id}
   * Marquer lu, ajouter notes
   */
  patch: (id: string, payload: UpdateContactPayload): Promise<ContactRequest> => {
    return api.patch<ContactRequest>(`${ADMIN}/${id}`, payload);
  },

  /**
   * DELETE /api/admin/contacts/{id}
   * Supprimer une demande
   */
  delete: (id: string): Promise<void> => {
    return api.delete<void>(`${ADMIN}/${id}`);
  },
};

// END OF FILE: src/repositories/contact.repository.ts


// FILE: src/repositories/events.repository.ts
-----------------------------------------------

// src/repositories/events.repository.ts
// ==============================================================================
//  Tracking silencieux des événements visiteurs (côté client uniquement)
// ==============================================================================
import { api as apiClient } from "@/lib/api-client";
import type { VisitorEventPayload } from "@/types/api/kpi.types";

const TRACKING_ENABLED = process.env.NEXT_PUBLIC_ENABLE_TRACKING === "true";

export const eventsRepository = {
  /**
   * POST /api/evenements — enregistrer un événement visiteur
   * Silencieux : ne throw jamais (échec ignoré pour ne pas impacter l'UX)
   */
  track: async (payload: VisitorEventPayload): Promise<void> => {
    if (!TRACKING_ENABLED) return;
    try {
      await apiClient.post("/evenements", payload);
    } catch {
      // Tracking silencieux — on n'impacte jamais l'UX en cas d'erreur
    }
  },

  /** Raccourcis pour les événements les plus fréquents */
  trackPageView: (page: string) =>
    eventsRepository.track({ type: "PAGE_VIEW", page }),

  trackScholarshipView: (bourseId: string, page?: string) =>
    eventsRepository.track({ type: "BOURSE_VUE", bourse_id: bourseId, page }),

  trackContactSubmit: (bourseId?: string) =>
    eventsRepository.track({ type: "CONTACT_SOUMIS", bourse_id: bourseId }),

  trackNewsletterSignup: () =>
    eventsRepository.track({ type: "NEWSLETTER_INSCRIPTION" }),

  trackWhatsappClick: (bourseId?: string) =>
    eventsRepository.track({ type: "WHATSAPP_CLIC", bourse_id: bourseId }),

  trackChatbotOpen: () =>
    eventsRepository.track({ type: "CHATBOT_OUVERT" }),

  trackAppointmentSubmit: () =>
    eventsRepository.track({ type: "RENDEZ_VOUS_SOUMIS" }),
};

// END OF FILE: src/repositories/events.repository.ts


// FILE: src/repositories/index.ts
-----------------------------------------------
// src/repositories/index.ts
// ==============================================================================
//  Barrel export — tous les repositories SALMA
//  Usage : import { scholarshipAdminRepository, authRepository } from "@/repositories"
// ==============================================================================

// --- Auth --------------------------------------------------------------------
export { authRepository } from "./auth.repository";

// --- Bourses -----------------------------------------------------------------
export { scholarshipPublicRepository, scholarshipAdminRepository } from "./scholarship.repository";

// --- Médias ------------------------------------------------------------------
export { mediaRepository } from "./media.repository";

// --- CMS (Pages, Blocs, Config, Vidéos) -------------------------------------
export { cmsPublicRepository, cmsAdminRepository } from "./cms.repository";

// --- Contact -----------------------------------------------------------------
export { contactPublicRepository, contactAdminRepository } from "./contact.repository";

// --- Newsletter & Annonces ---------------------------------------------------
export { newsletterRepository } from "./newsletter.repository";

// --- Témoignages -------------------------------------------------------------
export { testimonialPublicRepository, testimonialAdminRepository } from "./testimonial.repository";

// --- Chatbot -----------------------------------------------------------------
export { chatbotRepository } from "./chatbot.repository";

// --- Services ----------------------------------------------------------------
export { serviceRepository } from "./service.repository";

// --- KPI & Analytics ---------------------------------------------------------
export { kpiRepository } from "./kpi.repository";

// --- Tracking visiteurs ------------------------------------------------------
export { eventsRepository } from "./events.repository";

// END OF FILE: src/repositories/index.ts


// FILE: src/repositories/kpi.repository.ts
-----------------------------------------------

// src/repositories/kpi.repository.ts
// ==============================================================================
import { api as apiClient } from "@/lib/api-client";
import type {
  KpiSnapshot,
  KpiRealtime,
  ConversionRate,
  VisitorEvent,
  EventFilters,
  KpiSnapshotFilters,
} from "@/types/api/kpi.types";
import type { PaginatedResponse } from "@/types";

export const kpiRepository = {
  /** GET /api/admin/kpi/snapshots */
  adminGetSnapshots: (filters?: KpiSnapshotFilters): Promise<KpiSnapshot[]> => {
    const params: Record<string, string> = {};
    if (filters?.date_debut) params.date_debut = filters.date_debut;
    if (filters?.date_fin) params.date_fin = filters.date_fin;
    if (filters?.periode) params.periode = filters.periode;
    return apiClient.get("/admin/kpi/snapshots", { params });
  },

  /** GET /api/admin/kpi/snapshots/{date} */
  adminGetSnapshotByDate: (date: string): Promise<KpiSnapshot> =>
    apiClient.get(`/admin/kpi/snapshots/${date}`),

  /** GET /api/admin/kpi/temps-reel */
  adminGetRealtime: (): Promise<KpiRealtime> =>
    apiClient.get("/admin/kpi/temps-reel"),

  /** GET /api/admin/kpi/conversion */
  adminGetConversion: (): Promise<ConversionRate> =>
    apiClient.get("/admin/kpi/conversion"),

  /** GET /api/admin/kpi/evenements */
  adminGetEvents: (filters?: EventFilters): Promise<PaginatedResponse<VisitorEvent>> => {
    const params: Record<string, string> = {};
    if (filters?.type) params.type = filters.type;
    if (filters?.page) params.page = filters.page;
    if (filters?.bourse_id) params.bourse_id = filters.bourse_id;
    if (filters?.date_debut) params.date_debut = filters.date_debut;
    if (filters?.date_fin) params.date_fin = filters.date_fin;
    return apiClient.get("/admin/kpi/evenements", { params });
  },
};



// END OF FILE: src/repositories/kpi.repository.ts


// FILE: src/repositories/media.repository.ts
-----------------------------------------------
// src/repositories/media.repository.ts
// ==============================================================================
//  Repository — Médias (Bibliothèque de fichiers)
//  5 endpoints admin uniquement
// ==============================================================================

import { api } from "@/lib/api-client";
import type {
  MediaAsset,
  UploadMediaPayload,
  UpdateMediaPayload,
  PaginatedMediaResponse,
  MediaFilters,
} from "@/types/api/media.types";

const ADMIN = "/admin/medias";

export const mediaRepository = {
  /**
   * GET /api/admin/medias
   * Bibliothèque de fichiers
   */
  getList: (filters?: MediaFilters): Promise<PaginatedMediaResponse> => {
    const params: Record<string, string> = {};
    if (filters?.type_mime) params.type_mime = filters.type_mime;
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.page_size) params.page_size = String(filters.page_size);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<PaginatedMediaResponse>(ADMIN, { params });
  },

  /**
   * GET /api/admin/medias/{id}
   * Détail d'un fichier
   */
  getById: (id: string): Promise<MediaAsset> => {
    return api.get<MediaAsset>(`${ADMIN}/${id}`);
  },

  /**
   * POST /api/admin/medias
   * Uploader un fichier (multipart/form-data)
   */
  upload: (payload: UploadMediaPayload): Promise<MediaAsset> => {
    const formData = new FormData();
    formData.append("fichier", payload.fichier);
    if (payload.nom_fichier) formData.append("nom_fichier", payload.nom_fichier);
    if (payload.texte_alt_fr) formData.append("texte_alt_fr", payload.texte_alt_fr);
    if (payload.texte_alt_en) formData.append("texte_alt_en", payload.texte_alt_en);

    return api.upload<MediaAsset>(ADMIN, formData);
  },

  /**
   * PATCH /api/admin/medias/{id}
   * Modifier les métadonnées (nom, texte alt)
   */
  update: (id: string, payload: UpdateMediaPayload): Promise<MediaAsset> => {
    return api.patch<MediaAsset>(`${ADMIN}/${id}`, payload);
  },

  /**
   * DELETE /api/admin/medias/{id}
   * Supprimer un fichier
   */
  delete: (id: string): Promise<void> => {
    return api.delete<void>(`${ADMIN}/${id}`);
  },
};

// END OF FILE: src/repositories/media.repository.ts


// FILE: src/repositories/newsletter.repository.ts
-----------------------------------------------
// src/repositories/newsletter.repository.ts
// ==============================================================================
//  Repository — Newsletter & Annonces
//  12 endpoints : 2 publics + 10 admin
// ==============================================================================

import { api } from "@/lib/api-client";
import type {
  NewsletterSubscriber,
  NewsletterInscriptionPayload,
  NewsletterDesinscriptionPayload,
  Announcement,
  CreateAnnouncementPayload,
  UpdateAnnouncementPayload,
  SendAnnouncementResponse,
  PaginatedSubscriberResponse,
  PaginatedAnnouncementResponse,
  SubscriberFilters,
  AnnouncementFilters,
} from "@/types/api/newsletter.types";

// ==============================================================================
//  Endpoints PUBLICS (vitrine)
// ==============================================================================

export const newsletterRepository = {
  /**
   * POST /api/newsletter/inscription
   * S'inscrire à la newsletter
   */
  subscribe: (payload: NewsletterInscriptionPayload): Promise<{ detail: string }> => {
    return api.post<{ detail: string }>("/newsletter/inscription", payload);
  },

  /**
   * POST /api/newsletter/desinscription
   * Se désinscrire
   */
  unsubscribe: (payload: NewsletterDesinscriptionPayload): Promise<{ detail: string }> => {
    return api.post<{ detail: string }>("/newsletter/desinscription", payload);
  },

  // ==============================================================================
  //  Admin — Abonnés
  // ==============================================================================

  /**
   * GET /api/admin/newsletter/abonnes
   * Liste des abonnés (filtres : actif, pays, niveau)
   */
  adminGetSubscribers: (filters?: SubscriberFilters): Promise<PaginatedSubscriberResponse> => {
    const params: Record<string, string> = {};
    if (filters?.est_actif !== undefined) params.est_actif = String(filters.est_actif);
    if (filters?.pays) params.pays = filters.pays;
    if (filters?.niveau_etudes) params.niveau_etudes = filters.niveau_etudes;
    if (filters?.destination_souhaitee) params.destination_souhaitee = filters.destination_souhaitee;
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.page_size) params.page_size = String(filters.page_size);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<PaginatedSubscriberResponse>("/admin/newsletter/abonnes", { params });
  },

  /**
   * GET /api/admin/newsletter/abonnes/{id}
   * Détail d'un abonné
   */
  adminGetSubscriberById: (id: string): Promise<NewsletterSubscriber> => {
    return api.get<NewsletterSubscriber>(`/admin/newsletter/abonnes/${id}`);
  },

  /**
   * DELETE /api/admin/newsletter/abonnes/{id}
   * Supprimer un abonné
   */
  adminDeleteSubscriber: (id: string): Promise<void> => {
    return api.delete<void>(`/admin/newsletter/abonnes/${id}`);
  },

  // ==============================================================================
  //  Admin — Annonces
  // ==============================================================================

  /**
   * GET /api/admin/annonces
   * Liste des annonces
   */
  adminGetAnnouncements: (filters?: AnnouncementFilters): Promise<PaginatedAnnouncementResponse> => {
    const params: Record<string, string> = {};
    if (filters?.statut) params.statut = filters.statut;
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.page_size) params.page_size = String(filters.page_size);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<PaginatedAnnouncementResponse>("/admin/annonces", { params });
  },

  /**
   * GET /api/admin/annonces/{id}
   * Détail avec bourses liées
   */
  adminGetAnnouncementById: (id: string): Promise<Announcement> => {
    return api.get<Announcement>(`/admin/annonces/${id}`);
  },

  /**
   * POST /api/admin/annonces
   * Créer une annonce (brouillon)
   */
  adminCreateAnnouncement: (payload: CreateAnnouncementPayload): Promise<Announcement> => {
    return api.post<Announcement>("/admin/annonces", payload);
  },

  /**
   * PUT /api/admin/annonces/{id}
   * Modifier complètement
   */
  adminUpdateAnnouncement: (id: string, payload: CreateAnnouncementPayload): Promise<Announcement> => {
    return api.put<Announcement>(`/admin/annonces/${id}`, payload);
  },

  /**
   * PATCH /api/admin/annonces/{id}
   * Modifier partiellement
   */
  adminPatchAnnouncement: (id: string, payload: UpdateAnnouncementPayload): Promise<Announcement> => {
    return api.patch<Announcement>(`/admin/annonces/${id}`, payload);
  },

  /**
   * DELETE /api/admin/annonces/{id}
   * Supprimer
   */
  adminDeleteAnnouncement: (id: string): Promise<void> => {
    return api.delete<void>(`/admin/annonces/${id}`);
  },

  /**
   * POST /api/admin/annonces/{id}/envoyer
   * Envoyer à tous les abonnés actifs (simulé)
   */
  adminSendAnnouncement: (id: string): Promise<SendAnnouncementResponse> => {
    return api.post<SendAnnouncementResponse>(`/admin/annonces/${id}/envoyer`, {});
  },
};

// END OF FILE: src/repositories/newsletter.repository.ts


// FILE: src/repositories/scholarship.repository.ts
-----------------------------------------------
// src/repositories/scholarship.repository.ts
// ==============================================================================
//  Repository — Bourses
//  25 endpoints : 3 publics + 22 admin
// ==============================================================================

import { api } from "@/lib/api-client";
import type {
  ScholarshipPublicListItem,
  ScholarshipPublicDetail,
  ScholarshipAdmin,
  ScholarshipListResponse,
  ScholarshipAdminListResponse,
  ScholarshipFilters,
  CreateScholarshipPayload,
  UpdateScholarshipPayload,
  UpdateFieldVisibilityPayload,
  AddScholarshipImagePayload,
  ScholarshipField,
  ScholarshipBenefit,
  ScholarshipEligibility,
  ScholarshipImage
} from "@/types/api/scholarship.types";

const PUBLIC = "/bourses";
const ADMIN = "/admin/bourses";

// ==============================================================================
//  Endpoints PUBLICS (vitrine)
// ==============================================================================

export const scholarshipPublicRepository = {
  /**
   * GET /api/bourses
   * Liste paginée des bourses publiées (infos minimales pour le catalogue)
   */
  getList: (filters?: ScholarshipFilters): Promise<ScholarshipListResponse> => {
    const params: Record<string, string> = {};
    if (filters?.pays_destination) params.pays_destination = filters.pays_destination;
    if (filters?.niveau) params.niveau = filters.niveau;
    if (filters?.type_couverture) params.type_couverture = filters.type_couverture;
    if (filters?.est_mise_en_avant !== undefined) params.est_mise_en_avant = String(filters.est_mise_en_avant);
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.page_size) params.page_size = String(filters.page_size);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<ScholarshipListResponse>(PUBLIC, {
      params,
      revalidate: 60, // ISR : revalide toutes les 60 secondes
    });
  },

  /**
   * GET /api/bourses/{id}
   * Détail public avec field_visibility appliqué
   */
  getById: (id: string): Promise<ScholarshipPublicDetail> => {
    return api.get<ScholarshipPublicDetail>(`${PUBLIC}/${id}`, {
      revalidate: 60,
    });
  },

  /**
   * GET /api/bourses/vedette
   * Bourses mises en avant (pour la home page)
   */
  getFeatured: (): Promise<ScholarshipPublicListItem[]> => {
    return api.get<ScholarshipPublicListItem[]>(`${PUBLIC}/mise-en-avant`, {
      revalidate: 60,
    });
  },
};

// ==============================================================================
//  Endpoints ADMIN (dashboard)
// ==============================================================================

export const scholarshipAdminRepository = {
  /**
   * GET /api/admin/bourses
   * Liste complète (tous statuts, tous champs)
   */
  getList: (filters?: ScholarshipFilters): Promise<ScholarshipAdminListResponse> => {
    const params: Record<string, string> = {};
    if (filters?.pays_destination) params.pays_destination = filters.pays_destination;
    if (filters?.niveau) params.niveau = filters.niveau;
    if (filters?.statut) params.statut = filters.statut;
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<ScholarshipAdminListResponse>(ADMIN, { params });
  },

  /**
   * GET /api/admin/bourses/{id}
   * Détail complet pour édition
   */
  getById: (id: string): Promise<ScholarshipAdmin> => {
    return api.get<ScholarshipAdmin>(`${ADMIN}/${id}`);
  },

  /**
   * POST /api/admin/bourses
   * Créer une nouvelle bourse
   */
  create: (payload: CreateScholarshipPayload): Promise<ScholarshipAdmin> => {
    return api.post<ScholarshipAdmin>(ADMIN, payload);
  },

  /**
   * PUT /api/admin/bourses/{id}
   * Modifier complètement une bourse
   */
  update: (id: string, payload: CreateScholarshipPayload): Promise<ScholarshipAdmin> => {
    return api.put<ScholarshipAdmin>(`${ADMIN}/${id}`, payload);
  },

  /**
   * PATCH /api/admin/bourses/{id}
   * Modifier partiellement (ex: juste le statut)
   */
  patch: (id: string, payload: UpdateScholarshipPayload): Promise<ScholarshipAdmin> => {
    return api.patch<ScholarshipAdmin>(`${ADMIN}/${id}`, payload);
  },

  /**
   * DELETE /api/admin/bourses/{id}
   */
  delete: (id: string): Promise<void> => {
    return api.delete<void>(`${ADMIN}/${id}`);
  },

  /**
   * POST /api/admin/bourses/{id}/dupliquer
   * Dupliquer une bourse (crée un brouillon)
   */
  duplicate: (id: string): Promise<ScholarshipAdmin> => {
    return api.post<ScholarshipAdmin>(`${ADMIN}/${id}/dupliquer`, {});
  },

  // --- Visibilité des champs ------------------------------------------------

  /**
   * GET /api/admin/bourses/{id}/visibilites
   * Récupérer la visibilité de tous les champs
   */
  getVisibility: (id: string) => {
    return api.get<{ nom_du_champ: string; est_visible: boolean }[]>(
      `${ADMIN}/${id}/visibilites`
    );
  },

  /**
   * PATCH /api/admin/bourses/{id}/visibilites/{champId}
   * Modifier la visibilité d'un champ
   */
  updateFieldVisibility: (
    bourseId: string,
    champId: string,
    payload: UpdateFieldVisibilityPayload
  ) => {
    return api.patch(`${ADMIN}/${bourseId}/visibilites/${champId}`, payload);
  },

  /**
   * POST /api/admin/bourses/{id}/visibilites/bulk
   * Mettre à jour plusieurs visibilités d'un coup
   */
 bulkUpdateVisibility: (
  bourseId: string,
  visibilities: UpdateFieldVisibilityPayload[]
): Promise<void> => { // Ajoute le type de retour ici
  return api.post<void>(`${ADMIN}/${bourseId}/visibilites/bulk`, { visibilities: visibilities });
},

  // --- Images ---------------------------------------------------------------

  /**
   * GET /api/admin/bourses/{id}/images
   */
  getImages: (id: string) => {
    return api.get(`${ADMIN}/${id}/images`);
  },

  /**
   * POST /api/admin/bourses/{id}/images
   * Ajouter une image à une bourse
   */
 // FIX : Typage ScholarshipImage au lieu de any
  addImage: (bourseId: string, payload: AddScholarshipImagePayload): Promise<ScholarshipImage> => {
    return api.post<ScholarshipImage>(`${ADMIN}/${bourseId}/images`, payload);
  },

  /**
   * DELETE /api/admin/bourses/{id}/images/{imgId}
   */
  removeImage: (bourseId: string, imgId: string): Promise<void> => {
    return api.delete(`${ADMIN}/${bourseId}/images/${imgId}`);
  },

  /**
   * PUT /api/admin/bourses/{id}/images/{imgId}/principale
   * Définir comme image principale
   */
  setMainImage: (bourseId: string, imgId: string) => {
    return api.put(`${ADMIN}/${bourseId}/images/${imgId}/principale`, {});
  },

  // --- Domaines, avantages, critères ----------------------------------------

  /** Domaines d'études */
  getFields: (): Promise<ScholarshipField[]> =>
    api.get<ScholarshipField[]>("/admin/domaines"),
  createField: (payload: Omit<ScholarshipField, "id">): Promise<ScholarshipField> =>
    api.post<ScholarshipField>("/admin/domaines", payload),
  deleteField: (id: string): Promise<void> =>
    api.delete(`/admin/domaines/${id}`),

  /** Avantages */
  getBenefits: (): Promise<ScholarshipBenefit[]> =>
    api.get<ScholarshipBenefit[]>("/admin/avantages"),
  createBenefit: (payload: Omit<ScholarshipBenefit, "id">): Promise<ScholarshipBenefit> =>
    api.post<ScholarshipBenefit>("/admin/avantages", payload),
  deleteBenefit: (id: string): Promise<void> =>
    api.delete(`/admin/avantages/${id}`),

  /** Critères d'éligibilité */
  getEligibilities: (): Promise<ScholarshipEligibility[]> =>
    api.get<ScholarshipEligibility[]>("/admin/criteres"),
  createEligibility: (payload: Omit<ScholarshipEligibility, "id">): Promise<ScholarshipEligibility> =>
    api.post<ScholarshipEligibility>("/admin/criteres", payload),
  deleteEligibility: (id: string): Promise<void> =>
    api.delete(`/admin/criteres/${id}`),
};

// END OF FILE: src/repositories/scholarship.repository.ts


// FILE: src/repositories/service.repository.ts
-----------------------------------------------
// src/repositories/service.repository.ts
// ==============================================================================
import { api as apiClient } from "@/lib/api-client";
import type { 
  ServicePublic, 
  ServiceAdmin, 
  CreateServicePayload, 
  UpdateServicePayload 
} from "@/types/api/service.types";

export const serviceRepository = {
  /** GET /api/services — liste publique des services actifs */
  getPublicList: (): Promise<ServicePublic[]> =>
    apiClient.get<ServicePublic[]>("/services", { revalidate: 300 }),

  /** GET /api/services/{slug} */
  getPublicBySlug: (slug: string): Promise<ServicePublic> =>
    apiClient.get<ServicePublic>(`/services/${slug}`, { revalidate: 300 }),

  /** GET /api/admin/services */
  adminGetList: (): Promise<ServiceAdmin[]> =>
    apiClient.get<ServiceAdmin[]>("/admin/services"),

  /** GET /api/admin/services/{id} */
  adminGetById: (id: string): Promise<ServiceAdmin> =>
    apiClient.get<ServiceAdmin>(`/admin/services/${id}`),

  /** POST /api/admin/services */
  adminCreate: (payload: CreateServicePayload): Promise<ServiceAdmin> =>
    apiClient.post<ServiceAdmin>("/admin/services", payload),

  /** PUT /api/admin/services/{id} */
  adminUpdate: (id: string, payload: CreateServicePayload): Promise<ServiceAdmin> =>
    apiClient.put<ServiceAdmin>(`/admin/services/${id}`, payload),

  /** PATCH /api/admin/services/{id} */
  adminPatch: (id: string, payload: UpdateServicePayload): Promise<ServiceAdmin> =>
    apiClient.patch<ServiceAdmin>(`/admin/services/${id}`, payload),

  /** DELETE /api/admin/services/{id} */
  adminDelete: (id: string): Promise<void> =>
    apiClient.delete(`/admin/services/${id}`),
};

// END OF FILE: src/repositories/service.repository.ts


// FILE: src/repositories/testimonial.repository.ts
-----------------------------------------------
// src/repositories/testimonial.repository.ts
// ==============================================================================
//  Repository — Témoignages
//  8 endpoints : 2 publics + 6 admin
// ==============================================================================

import { api } from "@/lib/api-client";
import type {
  TestimonialPublic,
  TestimonialAdmin,
  SubmitTestimonialPayload,
  CreateTestimonialPayload,
  UpdateTestimonialPayload,
  PaginatedTestimonialResponse,
  TestimonialFilters,
} from "@/types/api/testimonial.types";

const PUBLIC = "/temoignages";
const ADMIN = "/admin/temoignages";

// ==============================================================================
//  Endpoints PUBLICS (vitrine)
// ==============================================================================

export const testimonialPublicRepository = {
  /**
   * GET /api/temoignages
   * Liste des témoignages approuvés et affichés
   */
  getList: (): Promise<TestimonialPublic[]> => {
    return api.get<TestimonialPublic[]>(PUBLIC, { revalidate: 300 });
  },

  /**
   * POST /api/temoignages
   * Soumettre un témoignage (formulaire site ou lien email)
   */
  submit: (payload: SubmitTestimonialPayload): Promise<{ detail: string }> => {
    return api.post<{ detail: string }>(PUBLIC, payload);
  },
};

// ==============================================================================
//  Endpoints ADMIN (dashboard)
// ==============================================================================

export const testimonialAdminRepository = {
  /**
   * GET /api/admin/temoignages
   * Liste complète (approuvés + en attente)
   */
  getList: (filters?: TestimonialFilters): Promise<PaginatedTestimonialResponse> => {
    const params: Record<string, string> = {};
    if (filters?.est_approuve !== undefined) params.est_approuve = String(filters.est_approuve);
    if (filters?.est_affiche_sur_site !== undefined) params.est_affiche_sur_site = String(filters.est_affiche_sur_site);
    if (filters?.source) params.source = filters.source;
    if (filters?.search) params.search = filters.search;
    if (filters?.page) params.page = String(filters.page);
    if (filters?.page_size) params.page_size = String(filters.page_size);
    if (filters?.ordering) params.ordering = filters.ordering;

    return api.get<PaginatedTestimonialResponse>(ADMIN, { params });
  },

  /**
   * GET /api/admin/temoignages/{id}
   * Détail d'un témoignage
   */
  getById: (id: string): Promise<TestimonialAdmin> => {
    return api.get<TestimonialAdmin>(`${ADMIN}/${id}`);
  },

  /**
   * POST /api/admin/temoignages
   * Créer manuellement (depuis WhatsApp/mail)
   */
  create: (payload: CreateTestimonialPayload): Promise<TestimonialAdmin> => {
    return api.post<TestimonialAdmin>(ADMIN, payload);
  },

  /**
   * PUT /api/admin/temoignages/{id}
   * Modifier complètement
   */
  update: (id: string, payload: CreateTestimonialPayload): Promise<TestimonialAdmin> => {
    return api.put<TestimonialAdmin>(`${ADMIN}/${id}`, payload);
  },

  /**
   * PATCH /api/admin/temoignages/{id}
   * Modifier partiellement (ex: approuver)
   */
  patch: (id: string, payload: UpdateTestimonialPayload): Promise<TestimonialAdmin> => {
    return api.patch<TestimonialAdmin>(`${ADMIN}/${id}`, payload);
  },

  /**
   * DELETE /api/admin/temoignages/{id}
   */
  delete: (id: string): Promise<void> => {
    return api.delete<void>(`${ADMIN}/${id}`);
  },
};

// END OF FILE: src/repositories/testimonial.repository.ts


// FILE: src/sections/visitor/ContactForm.tsx
-----------------------------------------------
// src/sections/visitor/ContactForm.tsx
// ==============================================================================
//  Formulaire de Contact — envoi réel vers POST /api/contact
//  Validation côté client, tracking CONTACT_SOUMIS, état success
// ==============================================================================
"use client";

import { useState } from "react";
import { useLanguage } from "@/hooks/useLanguage";
import { contactDictionary } from "@/dictionaries/data/contact.data-dictionary";
import { eventsRepository } from "@/repositories/events.repository";
import SalmaButton from "@/components/ui/SalmaButton";
import type { CreateContactPayload } from "@/types/api/contact.types";

// --- Validation simple (pas besoin de Zod en dépendance externe) -------------

interface FormErrors {
  nom_complet?: string;
  email?: string;
  message?: string;
}

function validateForm(
  data: CreateContactPayload,
  locale: "fr" | "en"
): FormErrors {
  const errors: FormErrors = {};
  const t = locale === "fr"
    ? { required: "Ce champ est requis", emailInvalid: "Email invalide", messageTooShort: "Message trop court (min. 10 caractères)" }
    : { required: "This field is required", emailInvalid: "Invalid email", messageTooShort: "Message too short (min. 10 characters)" };

  if (!data.nom_complet.trim()) errors.nom_complet = t.required;
  if (!data.email.trim()) {
    errors.email = t.required;
  } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
    errors.email = t.emailInvalid;
  }
  if (!data.message.trim()) {
    errors.message = t.required;
  } else if (data.message.trim().length < 10) {
    errors.message = t.messageTooShort;
  }

  return errors;
}

// --- Composant ---------------------------------------------------------------

type FormStatus = "idle" | "submitting" | "success" | "error";

export default function ContactForm() {
  const { dictionary, locale } = useLanguage();

  const [formData, setFormData] = useState<CreateContactPayload>({
    nom_complet: "",
    email: "",
    telephone: "",
    whatsapp: "",
    message: "",
    accepte_newsletter: false,
  });
  const [errors, setErrors] = useState<FormErrors>({});
  const [status, setStatus] = useState<FormStatus>("idle");
  const [errorMessage, setErrorMessage] = useState("");

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    const { name, value, type } = e.target;
    const checked = type === "checkbox" ? (e.target as HTMLInputElement).checked : undefined;
    setFormData((prev) => ({
      ...prev,
      [name]: type === "checkbox" ? checked : value,
    }));
    // Effacer l'erreur de ce champ
    if (errors[name as keyof FormErrors]) {
      setErrors((prev) => ({ ...prev, [name]: undefined }));
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // Validation
    const validationErrors = validateForm(formData, locale);
    if (Object.keys(validationErrors).length > 0) {
      setErrors(validationErrors);
      return;
    }

    setStatus("submitting");
    setErrors({});
    setErrorMessage("");

    try {
      await contactDictionary.submit(formData);

      // Tracking silencieux
      eventsRepository.trackContactSubmit();

      setStatus("success");
      // Reset form
      setFormData({
        nom_complet: "",
        email: "",
        telephone: "",
        whatsapp: "",
        message: "",
        accepte_newsletter: false,
      });
    } catch (err: unknown) {
      setStatus("error");
      const msg = err instanceof Error ? err.message : "";
      setErrorMessage(
        msg || (locale === "fr"
          ? "Une erreur est survenue. Veuillez réessayer."
          : "An error occurred. Please try again.")
      );
    }
  };

  // Labels i18n
  const t = {
    title: dictionary.contact.title,
    subtitle: dictionary.contact.subtitle,
    name: dictionary.contact.form.name,
    email: dictionary.contact.form.email,
    phone: dictionary.contact.form.phone,
    message: dictionary.contact.form.message,
    send: dictionary.contact.form.send,
    success: dictionary.contact.form.success,
    address: dictionary.contact.info.address,
    emailInfo: dictionary.contact.info.email,
    newsletter: locale === "fr"
      ? "Je souhaite recevoir les offres de bourses par email"
      : "I want to receive scholarship offers by email",
    whatsapp: locale === "fr" ? "Numéro WhatsApp" : "WhatsApp number",
    errorGeneric: locale === "fr"
      ? "Une erreur est survenue"
      : "An error occurred",
    sendAnother: locale === "fr"
      ? "Envoyer une autre demande"
      : "Send another request",
    successTitle: locale === "fr"
      ? "Demande envoyée !"
      : "Request sent!",
    successDesc: locale === "fr"
      ? "Notre équipe vous contactera dans les 24h. Vérifiez aussi votre WhatsApp !"
      : "Our team will contact you within 24h. Also check your WhatsApp!",
  };

  // Input style helper
  const inputClass = (field?: string) =>
    `w-full p-4 rounded-xl bg-salma-bg border outline-none transition-all text-sm text-salma-text placeholder:text-salma-text-muted/60 ${
      field && errors[field as keyof FormErrors]
        ? "border-red-400 focus:border-red-500"
        : "border-salma-border focus:border-salma-gold"
    }`;

  return (
    <section id="contact" className="py-24 bg-white dark:bg-salma-bg">
      <div className="container mx-auto px-6">
        <div className="max-w-5xl mx-auto bg-salma-surface border border-salma-border rounded-[2rem] overflow-hidden shadow-salma-lg grid grid-cols-1 md:grid-cols-2">

          {/* ── Infos de contact ─────────────────────────────────── */}
          <div className="p-10 md:p-12 bg-salma-primary text-white flex flex-col justify-between">
            <div>
              <h2 className="text-3xl font-serif font-bold mb-4">{t.title}</h2>
              <p className="text-salma-gold-light text-sm mb-10">{t.subtitle}</p>

              <div className="space-y-5">
                <div className="flex gap-4 items-start">
                  <span className="text-salma-gold text-lg mt-0.5">📍</span>
                  <p className="text-sm leading-relaxed">{t.address}</p>
                </div>
                <div className="flex gap-4 items-start">
                  <span className="text-salma-gold text-lg mt-0.5">✉️</span>
                  <p className="text-sm">{t.emailInfo}</p>
                </div>
                <div className="flex gap-4 items-start">
                  <span className="text-salma-gold text-lg mt-0.5">📞</span>
                  <p className="text-sm">+237 6 99 45 09 84 / 6 51 74 03 28</p>
                </div>
              </div>
            </div>

            <div className="mt-10 pt-6 border-t border-white/10">
              <p className="text-[10px] uppercase tracking-widest opacity-50">
                AG Technologies Group
              </p>
            </div>
          </div>

          {/* ── Formulaire ───────────────────────────────────────── */}
          <div className="p-10 md:p-12">

            {/* État succès */}
            {status === "success" ? (
              <div className="flex flex-col items-center justify-center h-full text-center gap-4 py-8">
                <div className="w-16 h-16 rounded-full bg-emerald-100 flex items-center justify-center">
                  <svg className="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                  </svg>
                </div>
                <h3 className="text-xl font-serif font-bold text-salma-primary">
                  {t.successTitle}
                </h3>
                <p className="text-sm text-salma-text-muted max-w-xs">
                  {t.successDesc}
                </p>
                <button
                  onClick={() => setStatus("idle")}
                  className="mt-4 text-sm font-semibold text-salma-gold hover:text-salma-gold-dark transition-colors underline underline-offset-4"
                >
                  {t.sendAnother}
                </button>
              </div>
            ) : (
              <form onSubmit={handleSubmit} className="space-y-4" noValidate>
                {/* Nom */}
                <div>
                  <input
                    type="text"
                    name="nom_complet"
                    value={formData.nom_complet}
                    onChange={handleChange}
                    placeholder={t.name}
                    className={inputClass("nom_complet")}
                  />
                  {errors.nom_complet && (
                    <p className="mt-1 text-xs text-red-500">{errors.nom_complet}</p>
                  )}
                </div>

                {/* Email */}
                <div>
                  <input
                    type="email"
                    name="email"
                    value={formData.email}
                    onChange={handleChange}
                    placeholder={t.email}
                    className={inputClass("email")}
                  />
                  {errors.email && (
                    <p className="mt-1 text-xs text-red-500">{errors.email}</p>
                  )}
                </div>

                {/* Téléphone + WhatsApp côte à côte */}
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <input
                    type="tel"
                    name="telephone"
                    value={formData.telephone}
                    onChange={handleChange}
                    placeholder={t.phone}
                    className={inputClass()}
                  />
                  <input
                    type="tel"
                    name="whatsapp"
                    value={formData.whatsapp}
                    onChange={handleChange}
                    placeholder={t.whatsapp}
                    className={inputClass()}
                  />
                </div>

                {/* Message */}
                <div>
                  <textarea
                    name="message"
                    value={formData.message}
                    onChange={handleChange}
                    placeholder={t.message}
                    rows={4}
                    className={inputClass("message")}
                  />
                  {errors.message && (
                    <p className="mt-1 text-xs text-red-500">{errors.message}</p>
                  )}
                </div>

                {/* Checkbox newsletter */}
                <label className="flex items-start gap-3 cursor-pointer group">
                  <input
                    type="checkbox"
                    name="accepte_newsletter"
                    checked={formData.accepte_newsletter}
                    onChange={handleChange}
                    className="mt-0.5 w-4 h-4 rounded border-salma-border text-salma-gold focus:ring-salma-gold accent-salma-gold"
                  />
                  <span className="text-xs text-salma-text-muted group-hover:text-salma-text transition-colors leading-relaxed">
                    {t.newsletter}
                  </span>
                </label>

                {/* Erreur serveur */}
                {status === "error" && (
                  <div className="p-3 rounded-lg bg-red-50 border border-red-200 text-sm text-red-600">
                    {errorMessage || t.errorGeneric}
                  </div>
                )}

                {/* Bouton submit */}
                <SalmaButton
                  type="submit"
                  variant="primary"
                  className="w-full py-4 shadow-xl"
                  disabled={status === "submitting"}
                >
                  {status === "submitting" ? (
                    <span className="flex items-center gap-2">
                      <svg className="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
                      </svg>
                      {locale === "fr" ? "Envoi en cours..." : "Sending..."}
                    </span>
                  ) : (
                    t.send
                  )}
                </SalmaButton>
              </form>
            )}
          </div>

        </div>
      </div>
    </section>
  );
}


// END OF FILE: src/sections/visitor/ContactForm.tsx


// FILE: src/sections/visitor/FeaturedScholarships.tsx
-----------------------------------------------
// src/sections/visitor/FeaturedScholarships.tsx
// ==============================================================================
//  Section Bourses Vedette — reçoit les données réelles en props (Server Component)
//  Fallback propre si aucune bourse disponible
// ==============================================================================
"use client";

import Link from "next/link";
import Image from "next/image";
import { useLanguage } from "@/hooks/useLanguage";
import SectionTitle from "@/components/ui/SectionTitle";
import SalmaButton from "@/components/ui/SalmaButton";
import { getMediaUrl } from "@/lib/api-client";
import type { ScholarshipPublicListItem } from "@/types/api/scholarship.types";

interface Props {
  scholarships: ScholarshipPublicListItem[];
}

// Labels d'affichage pour les énumérations Django
const LEVEL_LABELS: Record<string, string> = {
  licence: "Licence",
  master: "Master",
  doctorat: "Doctorat",
  postdoc: "Post-Doc",
  formation: "Formation",
  autre: "Autre",
};

const COVERAGE_LABELS: Record<string, { fr: string; color: string }> = {
  complete:   { fr: "Bourse complète",  color: "bg-emerald-50 text-emerald-700 border-emerald-200" },
  partielle:  { fr: "Partielle",        color: "bg-blue-50 text-blue-700 border-blue-200" },
  logement:   { fr: "Logement inclus",  color: "bg-purple-50 text-purple-700 border-purple-200" },
  transport:  { fr: "Transport",        color: "bg-orange-50 text-orange-700 border-orange-200" },
  autre:      { fr: "Aide financière",  color: "bg-gray-50 text-gray-700 border-gray-200" },
};

const COUNTRY_FLAGS: Record<string, string> = {
  chine:     "🇨🇳",
  allemagne: "🇩🇪",
  france:    "🇫🇷",
  canada:    "🇨🇦",
  autre:     "🌍",
};

function ScholarshipCard({ scholarship, locale }: { scholarship: ScholarshipPublicListItem; locale: "fr" | "en" }) {
  const title = locale === "fr" ? scholarship.titre_fr : scholarship.titre_en;
  const org   = locale === "fr" ? scholarship.organisme_fr : scholarship.organisme_en;
  const imageUrl = getMediaUrl(scholarship.image_principale?.url_fichier);
  const coverage = COVERAGE_LABELS[scholarship.type_couverture] ?? COVERAGE_LABELS.autre;
  const flag = COUNTRY_FLAGS[scholarship.pays_destination] ?? "🌍";

  const deadlineDate = scholarship.date_limite
    ? new Date(scholarship.date_limite).toLocaleDateString("fr-FR", { day: "2-digit", month: "short", year: "numeric" })
    : null;

  const isUrgent = scholarship.date_limite
    ? new Date(scholarship.date_limite).getTime() - Date.now() < 30 * 24 * 60 * 60 * 1000
    : false;

  return (
    <Link
      href={`/bourses/${scholarship.id}`}
      className="group flex flex-col bg-white border border-salma-border rounded-2xl overflow-hidden shadow-sm hover:shadow-salma-lg transition-all duration-300 hover:-translate-y-1"
    >
      {/* Image */}
      <div className="relative h-44 bg-salma-surface overflow-hidden">
        {imageUrl ? (
          <Image
            src={imageUrl}
            alt={title}
            fill
            className="object-cover group-hover:scale-105 transition-transform duration-500"
          />
        ) : (
          <div className="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-salma-primary/10 to-salma-gold/10">
            <span className="text-5xl">{flag}</span>
          </div>
        )}
        {/* Badge urgent */}
        {isUrgent && (
          <div className="absolute top-3 left-3">
            <span className="px-2.5 py-1 bg-red-500 text-white text-[10px] font-bold uppercase tracking-widest rounded-full shadow">
              Urgent
            </span>
          </div>
        )}
        {/* Badge vedette */}
        {scholarship.est_mise_en_avant && (
          <div className="absolute top-3 right-3">
            <span className="px-2.5 py-1 bg-salma-gold text-white text-[10px] font-bold uppercase tracking-widest rounded-full shadow">
              ⭐ Vedette
            </span>
          </div>
        )}
      </div>

      {/* Contenu */}
      <div className="flex flex-col flex-1 p-5 gap-3">
        {/* Pays + Niveau */}
        <div className="flex items-center gap-2">
          <span className="text-xs font-semibold text-salma-text-muted flex items-center gap-1">
            {flag} {scholarship.pays_destination.charAt(0).toUpperCase() + scholarship.pays_destination.slice(1)}
          </span>
          <span className="text-salma-border">·</span>
          <span className="text-xs font-semibold text-salma-text-muted">
            {LEVEL_LABELS[scholarship.niveau] ?? scholarship.niveau}
          </span>
        </div>

        {/* Titre */}
        <h3 className="text-sm font-bold text-salma-primary leading-snug group-hover:text-salma-gold transition-colors line-clamp-2">
          {title}
        </h3>

        {/* Organisme */}
        <p className="text-xs text-salma-text-muted truncate">{org}</p>

        {/* Domaines */}
        {scholarship.domaines.length > 0 && (
          <div className="flex flex-wrap gap-1.5">
            {scholarship.domaines.slice(0, 3).map((d) => (
              <span key={d.id} className="px-2 py-0.5 bg-salma-bg border border-salma-border rounded-full text-[10px] font-medium text-salma-text-muted">
                {locale === "fr" ? d.nom_fr : d.nom_en}
              </span>
            ))}
          </div>
        )}

        {/* Footer de la carte */}
        <div className="mt-auto pt-3 border-t border-salma-border flex items-center justify-between">
          {/* Badge couverture */}
          <span className={`px-2.5 py-1 text-[10px] font-semibold rounded-full border ${coverage.color}`}>
            {coverage.fr}
          </span>
          {/* Date limite */}
          {deadlineDate && (
            <span className={`text-[10px] font-medium ${isUrgent ? "text-red-500 font-bold" : "text-salma-text-muted"}`}>
              {isUrgent ? "⚠ " : ""}Limite : {deadlineDate}
            </span>
          )}
        </div>
      </div>
    </Link>
  );
}

// Carte squelette pendant le chargement
function SkeletonCard() {
  return (
    <div className="flex flex-col bg-white border border-salma-border rounded-2xl overflow-hidden animate-pulse">
      <div className="h-44 bg-salma-surface" />
      <div className="p-5 space-y-3">
        <div className="h-3 bg-salma-surface rounded w-1/3" />
        <div className="h-4 bg-salma-surface rounded w-4/5" />
        <div className="h-3 bg-salma-surface rounded w-2/3" />
        <div className="h-8 bg-salma-surface rounded-full w-1/2 mt-auto" />
      </div>
    </div>
  );
}

export default function FeaturedScholarships({ scholarships }: Props) {
  const { dictionary, locale } = useLanguage();

  return (
    <section className="py-24 bg-white dark:bg-salma-bg">
      <div className="container mx-auto px-6">

        <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12">
          <SectionTitle
            title={dictionary.featuredScholarships.title}
            subtitle={dictionary.featuredScholarships.subtitle}
            align="left"
          />
          <Link href="/bourses">
            <SalmaButton variant="outline" className="hidden md:flex">
              {dictionary.featuredScholarships.viewAll}
            </SalmaButton>
          </Link>
        </div>

        {/* État vide */}
        {scholarships.length === 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <SkeletonCard />
            <SkeletonCard />
            <SkeletonCard />
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {scholarships.slice(0, 3).map((s) => (
              <ScholarshipCard key={s.id} scholarship={s} locale={locale} />
            ))}
          </div>
        )}

        <div className="mt-12 flex justify-center md:hidden">
          <Link href="/bourses" className="w-full">
            <SalmaButton variant="outline" className="w-full">
              {dictionary.featuredScholarships.viewAll}
            </SalmaButton>
          </Link>
        </div>
      </div>
    </section>
  );
}


// END OF FILE: src/sections/visitor/FeaturedScholarships.tsx


// FILE: src/sections/visitor/Hero.tsx
-----------------------------------------------
"use client";

import Image from "next/image";
import { useLanguage } from "@/hooks/useLanguage";
import SalmaButton from "@/components/ui/SalmaButton";

export default function Hero() {
  const { dictionary } = useLanguage();

  return (
    <section className="relative min-h-[85vh] flex items-center overflow-hidden bg-white dark:bg-salma-bg">
      <div className="absolute top-0 right-0 -translate-y-1/2 translate-x-1/4 w-[600px] h-[600px] bg-salma-accent/5 rounded-full blur-3xl" />

      <div className="container mx-auto px-6 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center relative z-10">
        
        <div className="flex flex-col items-start space-y-6 animate-fade-in">
          <span className="px-4 py-1.5 rounded-full bg-salma-accent/10 text-salma-accent text-xs font-black uppercase tracking-widest border border-salma-accent/20">
            {dictionary.hero.badge}
          </span>
          
          <h1 className="text-4xl md:text-6xl font-serif font-bold leading-tight text-salma-primary dark:text-white">
            {dictionary.hero.title}
          </h1>
          
          <p className="text-lg md:text-xl text-salma-text-muted max-w-lg leading-relaxed">
            {dictionary.hero.description}
          </p>

          <div className="flex flex-col sm:flex-row gap-4 w-full sm:w-auto pt-4">
            <SalmaButton variant="primary" size="lg">
              {dictionary.hero.ctaPrimary}
            </SalmaButton>
            <SalmaButton variant="outline" size="lg">
              {dictionary.hero.ctaSecondary}
            </SalmaButton>
          </div>

          {/* Indicateur de confiance corrigé */}
          <div className="pt-8 flex items-center gap-4 border-t border-salma-border w-full">
            <div className="flex -space-x-3">
              {[1, 2, 3].map((i) => (
                <div key={i} className="w-10 h-10 rounded-full border-2 border-white bg-gray-200 overflow-hidden">
                   <Image src={`https://i.pravatar.cc/100?img=${i+10}`} width={40} height={40} alt="User" />
                </div>
              ))}
            </div>
            <p className="text-xs text-salma-text-muted font-medium">
              <span className="text-salma-gold font-bold">{dictionary.hero.trustIndicator.count}</span> {dictionary.hero.trustIndicator.text}
            </p>
          </div>
        </div>

        <div className="relative hidden lg:block h-[600px] w-full animate-fade-in" style={{ animationDelay: '0.2s' }}>
          <div className="absolute inset-0 rounded-3xl overflow-hidden shadow-salma-lg border-8 border-white dark:border-salma-surface transform rotate-2">
            <Image 
              src="/image.jpg" 
              alt={dictionary.hero.imageAlt} 
              fill 
              className="object-cover"
              priority
               sizes="(max-width: 768px) 100vw, 50vw" 
            />
          </div>
          
          {/* Badge délai corrigé */}
          <div className="absolute -bottom-6 -left-6 bg-salma-gold p-6 rounded-2xl shadow-xl text-salma-primary max-w-[180px] -rotate-3">
            <span className="block text-4xl font-bold">{dictionary.hero.visaBadge.number}</span>
            <span className="text-xs font-black uppercase tracking-tight leading-none">
              {dictionary.hero.visaBadge.label}
            </span>
          </div>
        </div>
      </div>
    </section>
  );
}

// END OF FILE: src/sections/visitor/Hero.tsx


// FILE: src/sections/visitor/StatsCounter.tsx
-----------------------------------------------
// src/sections/visitor/StatsCounter.tsx
"use client";

import { useLanguage } from "@/hooks/useLanguage";
import type { KpiRealtime } from "@/types/api/kpi.types";

interface Props {
  kpi?: KpiRealtime | null;
}

export default function StatsCounter({ kpi }: Props) {
  const { dictionary } = useLanguage();

  // On simplifie : on ne garde que value et label
  const stats = [
    {
      id: "visas",
      value: dictionary.stats.visas.value,
      label: dictionary.stats.visas.label,
    },
    {
      id: "partners",
      value: dictionary.stats.partners.value,
      label: dictionary.stats.partners.label,
    },
    {
      id: "experience",
      value: dictionary.stats.experience.value,
      label: dictionary.stats.experience.label,
    },
    {
      id: "satisfaction",
      value: kpi
        ? `${Math.round(kpi.taux_conversion_global * 100)}%`
        : dictionary.stats.satisfaction.value,
      label: dictionary.stats.satisfaction.label,
    },
  ];

  return (
    <section className="py-20 bg-salma-accent/5 dark:bg-salma-surface/20">
      <div className="container mx-auto px-6">
        <div className="grid grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
          {stats.map((stat) => (
            <div key={stat.id} className="flex flex-col items-center text-center group">
              <span className="text-4xl md:text-5xl font-serif font-bold text-salma-primary dark:text-salma-gold mb-2 transition-transform group-hover:scale-110 duration-300">
                {stat.value}
              </span>
              <div className="w-8 h-1 bg-salma-gold rounded-full mb-4 opacity-50" />
              <span className="text-xs md:text-sm font-sans font-bold uppercase tracking-widest text-salma-text-muted">
                {stat.label}
              </span>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

// END OF FILE: src/sections/visitor/StatsCounter.tsx


// FILE: src/sections/visitor/SuccessStories.tsx
-----------------------------------------------
// src/sections/visitor/SuccessStories.tsx
// ==============================================================================
//  Section Témoignages — données réelles depuis l'API (approuvés uniquement)
//  Utilise TestimonialPublic (types corrects) + fallback si aucune donnée
// ==============================================================================
"use client";

import { useLanguage } from "@/hooks/useLanguage";
import Image from "next/image";
import SectionTitle from "@/components/ui/SectionTitle";
import { getMediaUrl } from "@/lib/api-client";
import type { TestimonialPublic } from "@/types/api/testimonial.types";

interface Props {
  testimonials: TestimonialPublic[];
}

function StarRating({ note }: { note: number }) {
  return (
    <div className="flex gap-0.5">
      {Array.from({ length: 5 }).map((_, i) => (
        <svg
          key={i}
          className={`w-3.5 h-3.5 ${i < note ? "text-salma-gold" : "text-salma-border"}`}
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
      ))}
    </div>
  );
}

// Données de fallback si aucun témoignage approuvé en BD
const FALLBACK_TESTIMONIALS: TestimonialPublic[] = [
  {
    id: "fallback-1",
    nom_auteur: "Aminata K.",
    pays_auteur: "Cameroun",
    citation_fr:
      "Grâce à SALMA, j'ai obtenu ma bourse CSC en moins de 2 mois. L'équipe m'a accompagnée à chaque étape du dossier.",
    citation_en:
      "Thanks to SALMA, I got my CSC scholarship in less than 2 months. The team supported me at every step.",
    note: 5,
    photo: null,
    date_creation: "2025-09-15",
  },
  {
    id: "fallback-2",
    nom_auteur: "Jean-Baptiste M.",
    pays_auteur: "Cameroun",
    citation_fr:
      "Professionnel et efficace. Mon visa allemand a été obtenu en 3 semaines comme promis.",
    citation_en:
      "Professional and efficient. My German visa was obtained in 3 weeks as promised.",
    note: 5,
    photo: null,
    date_creation: "2025-10-20",
  },
  {
    id: "fallback-3",
    nom_auteur: "Fatou D.",
    pays_auteur: "Cameroun",
    citation_fr:
      "L'équipe a répondu à toutes mes questions rapidement. Je recommande vivement !",
    citation_en:
      "The team answered all my questions quickly. I highly recommend them!",
    note: 5,
    photo: null,
    date_creation: "2025-11-10",
  },
];

export default function SuccessStories({ testimonials }: Props) {
  const { dictionary, locale } = useLanguage();

  // Utiliser les données réelles ou le fallback
  const displayed =
    testimonials.length > 0 ? testimonials.slice(0, 3) : FALLBACK_TESTIMONIALS;

  return (
    <section className="py-24 bg-salma-surface/30 dark:bg-salma-surface/10">
      <div className="container mx-auto px-6">
        <div className="text-center mb-14">
          <SectionTitle
            title={
              dictionary.successStories?.title ??
              (locale === "fr"
                ? "Ils ont réussi grâce à SALMA"
                : "They succeeded with SALMA")
            }
            subtitle={
              dictionary.successStories?.subtitle ??
              (locale === "fr"
                ? "Histoires de Succès"
                : "Success Stories")
            }
            align="center"
          />
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {displayed.map((t) => {
            const citation =
              locale === "fr" ? t.citation_fr : (t.citation_en || t.citation_fr);
            const photoUrl = t.photo
              ? getMediaUrl(t.photo.url_fichier)
              : null;

            return (
              <div
                key={t.id}
                className="flex flex-col bg-white dark:bg-salma-surface border border-salma-border rounded-2xl p-6 gap-4 shadow-sm hover:shadow-salma-lg transition-all duration-300"
              >
                {/* Étoiles */}
                <StarRating note={t.note} />

                {/* Citation */}
                <blockquote className="text-sm text-salma-text leading-relaxed flex-1 italic">
                  &ldquo;{citation}&rdquo;
                </blockquote>

                {/* Auteur */}
                <div className="flex items-center gap-3 pt-3 border-t border-salma-border">
                  {photoUrl ? (
                    <Image
                      src={photoUrl}
                      alt={t.nom_auteur}
                      width={40}
                      height={40}
                      className="w-10 h-10 rounded-full object-cover"
                    />
                  ) : (
                    <div className="w-10 h-10 rounded-full bg-salma-primary/10 flex items-center justify-center flex-shrink-0">
                      <span className="text-sm font-bold text-salma-primary">
                        {t.nom_auteur.charAt(0).toUpperCase()}
                      </span>
                    </div>
                  )}
                  <div>
                    <p className="text-xs font-bold text-salma-text">
                      {t.nom_auteur}
                    </p>
                    {t.pays_auteur && (
                      <p className="text-[10px] text-salma-text-muted">
                        {t.pays_auteur}
                      </p>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </section>
  );
}


// END OF FILE: src/sections/visitor/SuccessStories.tsx


// FILE: src/sections/visitor/TrustBar.tsx
-----------------------------------------------
"use client";

import { useLanguage } from "@/hooks/useLanguage";

export default function TrustBar() {
  const { dictionary } = useLanguage();

  const trustItems = [
    {
      id: "expertise",
      title: dictionary.trust.expertise.title,
      desc: dictionary.trust.expertise.desc,
      icon: (
        <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
        </svg>
      ),
    },
    {
      id: "speed",
      title: dictionary.trust.speed.title,
      desc: dictionary.trust.speed.desc,
      icon: (
        <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      ),
    },
    {
      id: "guarantee",
      title: dictionary.trust.guarantee.title,
      desc: dictionary.trust.guarantee.desc,
      icon: (
        <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
      ),
    },
  ];

  return (
    <section className="relative z-20 -mt-10 px-6">
      <div className="max-w-6xl mx-auto bg-white dark:bg-salma-surface border border-salma-border shadow-salma-lg rounded-3xl overflow-hidden">
        <div className="grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-salma-border">
          {trustItems.map((item) => (
            <div 
              key={item.id} 
              className="p-8 flex items-start gap-6 hover:bg-salma-accent/5 transition-colors group"
            >
              <div className="text-salma-gold group-hover:scale-110 transition-transform duration-300">
                {item.icon}
              </div>
              <div>
                <h3 className="text-sm font-bold uppercase tracking-widest text-salma-primary dark:text-white mb-1">
                  {item.title}
                </h3>
                <p className="text-xs text-salma-text-muted leading-relaxed">
                  {item.desc}
                </p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

// END OF FILE: src/sections/visitor/TrustBar.tsx


// FILE: src/types/api/auth.types.ts
-----------------------------------------------
// src/types/api/auth.types.ts
// ==============================================================================
//  Types TypeScript — Module Authentification
//  Calque sur AdminUser Django + endpoints JWT
// ==============================================================================

export type AdminRole = "super_admin" | "admin" | "editor";

export interface AdminUser {
  id: string;
  email: string;
  nom_complet: string;
  role: AdminRole;
  is_active: boolean;
  derniere_connexion: string | null;
  date_creation: string;
}

// --- Réponse login -----------------------------------------------------------

export interface LoginResponse {
  access: string;
  refresh: string;
  user: AdminUser;
}

// --- Payloads ----------------------------------------------------------------

export interface LoginPayload {
  email: string;
  password: string;
}

export interface LogoutPayload {
  refresh: string;
}

export interface RegisterPayload {
  email: string;
  nom_complet: string;
  role: AdminRole;
  password: string;
}

export interface ChangePasswordPayload {
  old_password: string;
  new_password: string;
}

export interface ResetPasswordRequestPayload {
  email: string;
}

export interface ResetPasswordConfirmPayload {
  token: string;
  new_password: string;
}

export interface UpdateProfilePayload {
  nom_complet?: string;
  email?: string;
}

// --- Token refresh -----------------------------------------------------------

export interface TokenRefreshPayload {
  refresh: string;
}

export interface TokenRefreshResponse {
  access: string;
  refresh?: string; // ROTATE_REFRESH_TOKENS = True → nouveau refresh renvoyé
}

// END OF FILE: src/types/api/auth.types.ts


// FILE: src/types/api/chatbot.types.ts
-----------------------------------------------
// src/types/api/chatbot.types.ts
// ==============================================================================
//  Types TypeScript — Module Chatbot IA
//  Calque sur FaqEntry Django + ChatbotMessageSerializer + views
// ==============================================================================

// --- FaqEntry (admin CRUD) ---------------------------------------------------

export interface FaqEntry {
  id: string;
  question_fr: string;
  question_en: string;
  reponse_fr: string;
  reponse_en: string;
  categorie: string;
  ordre_affichage: number;
  est_actif: boolean;
}

export interface CreateFaqEntryPayload {
  question_fr: string;
  question_en: string;
  reponse_fr: string;
  reponse_en: string;
  categorie?: string;
  ordre_affichage?: number;
  est_actif?: boolean;
}

export type UpdateFaqEntryPayload = Partial<CreateFaqEntryPayload>;

// --- Chatbot message (public) ------------------------------------------------

/** POST /api/chatbot/message — payload */
export interface ChatbotMessagePayload {
  message: string;
  langue?: "fr" | "en";
}

/** Suggestion de FAQ liée */
export interface ChatbotSuggestion {
  question: string;
  id: string;
}

/** Réponse du chatbot */
export interface ChatbotMessageResponse {
  reponse: string;
  source: "faq" | "fallback";
  faq_id: string | null;
  suggestions: ChatbotSuggestion[];
}

// --- Réponse paginée admin ---------------------------------------------------

export interface PaginatedFaqResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: FaqEntry[];
}

// --- Filtres admin -----------------------------------------------------------

export interface FaqFilters {
  categorie?: string;
  est_actif?: boolean;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// END OF FILE: src/types/api/chatbot.types.ts


// FILE: src/types/api/cms.types.ts
-----------------------------------------------
// src/types/api/cms.types.ts
// ==============================================================================
//  Types TypeScript — Module CMS (Contenu du Site)
//  Calque sur SitePage, ContentBlock, SiteConfig, PitchVideo Django + serializers
// ==============================================================================

import type { MediaAssetMinimal } from "./media.types";

// --- Énumérations ------------------------------------------------------------

export type TypeBloc =
  | "HERO"
  | "TEXTE"
  | "IMAGE"
  | "CTA"
  | "STATS"
  | "BARRE_CONFIANCE"
  | "VIDEO"
  | "TEMOIGNAGES";

// --- ContentBlock ------------------------------------------------------------

export interface ContentBlock {
  id: string;
  cle_bloc: string;
  type_bloc: TypeBloc;
  contenu_fr: string;
  contenu_en: string;
  image: MediaAssetMinimal | null;
  lien_cta: string;
  est_visible: boolean;
  ordre_affichage: number;
  date_modification: string;
}

export interface CreateContentBlockPayload {
  cle_bloc: string;
  type_bloc: TypeBloc;
  contenu_fr?: string;
  contenu_en?: string;
  image_id?: string | null;
  lien_cta?: string;
  est_visible?: boolean;
  ordre_affichage?: number;
}

export type UpdateContentBlockPayload = Partial<CreateContentBlockPayload>;

// --- SitePage ----------------------------------------------------------------

/** Public : page + blocs visibles uniquement */
export interface SitePagePublic {
  id: string;
  slug: string;
  titre_fr: string;
  titre_en: string;
  blocs: ContentBlock[];
}

/** Admin : page + tous les blocs */
export interface SitePageAdmin {
  id: string;
  slug: string;
  titre_fr: string;
  titre_en: string;
  est_publiee: boolean;
  ordre_affichage: number;
  date_modification: string;
  blocs: ContentBlock[];
}

export interface CreateSitePagePayload {
  slug: string;
  titre_fr: string;
  titre_en: string;
  est_publiee?: boolean;
  ordre_affichage?: number;
}

export type UpdateSitePagePayload = Partial<CreateSitePagePayload>;

// --- SiteConfig --------------------------------------------------------------

export interface SiteConfig {
  id: string;
  cle_config: string;
  valeur_fr: string;
  valeur_en: string;
  date_modification: string;
}

export interface CreateSiteConfigPayload {
  cle_config: string;
  valeur_fr?: string;
  valeur_en?: string;
}

export type UpdateSiteConfigPayload = Partial<CreateSiteConfigPayload>;

// --- PitchVideo --------------------------------------------------------------

export interface PitchVideo {
  id: string;
  titre_fr: string;
  titre_en: string;
  url_video: string;
  thumbnail: MediaAssetMinimal | null;
  est_active: boolean;
  page_affichage: string;
  date_modification: string;
}

export interface CreatePitchVideoPayload {
  titre_fr: string;
  titre_en: string;
  url_video: string;
  thumbnail_id?: string | null;
  est_active?: boolean;
  page_affichage?: string;
}

export type UpdatePitchVideoPayload = Partial<CreatePitchVideoPayload>;

// END OF FILE: src/types/api/cms.types.ts


// FILE: src/types/api/contact.types.ts
-----------------------------------------------
// src/types/api/contact.types.ts
// ==============================================================================
//  Types TypeScript — Module Demandes de Contact
//  Calque sur ContactRequest Django + serializers DRF
// ==============================================================================

// --- Bourse associée (vue légère dans la réponse admin) ----------------------

export interface ContactBourseAssociee {
  id: string;
  titre_fr: string;
  titre_en: string;
}

// --- Modèle admin (lecture) --------------------------------------------------

export interface ContactRequest {
  id: string;
  nom_complet: string;
  email: string;
  telephone: string;
  whatsapp: string;
  message: string;
  accepte_newsletter: boolean;
  est_lu: boolean;
  notes_admin: string;
  date_creation: string;
  bourses_associees: ContactBourseAssociee[];
}

// --- Payload soumission publique (POST /api/contact) -------------------------

export interface CreateContactPayload {
  nom_complet: string;
  email: string;
  telephone?: string;
  whatsapp?: string;
  message: string;
  accepte_newsletter?: boolean;
  bourses_ids?: string[];
}

// --- Payload admin (PATCH — marquer lu, ajouter notes) -----------------------

export interface UpdateContactPayload {
  est_lu?: boolean;
  notes_admin?: string;
}

// --- Réponse paginée ---------------------------------------------------------

export interface PaginatedContactResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: ContactRequest[];
}

// --- Filtres admin -----------------------------------------------------------

export interface ContactFilters {
  est_lu?: boolean;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// END OF FILE: src/types/api/contact.types.ts


// FILE: src/types/api/kpi.types.ts
-----------------------------------------------
// src/types/api/kpi.types.ts
// ==============================================================================

export type EventType =
  | "PAGE_VIEW"
  | "BOURSE_VUE"
  | "BOURSE_CLIC_DETAIL"
  | "CONTACT_SOUMIS"
  | "NEWSLETTER_INSCRIPTION"
  | "CHATBOT_OUVERT"
  | "WHATSAPP_CLIC"
  | "RENDEZ_VOUS_SOUMIS";

// --- Tracking côté visiteur (public) -----------------------------------------

export interface VisitorEventPayload {
  type: EventType;
  page?: string;           // URL ou slug de page
  bourse_id?: string;      // si l'événement concerne une bourse
  metadata?: Record<string, string | number | boolean>;
}

// --- Snapshots KPI (admin) ---------------------------------------------------

export interface KpiSnapshot {
  id: string;
  date: string;            // "2026-02-27"
  total_visiteurs: number;
  total_vues_bourses: number;
  total_contacts: number;
  total_newsletter: number;
  taux_conversion: number; // 0.0 → 1.0 (ex: 0.035 = 3.5%)
  bourses_les_plus_vues: BourseKpi[];
}

export interface BourseKpi {
  bourse_id: string;
  titre: string;
  nb_vues: number;
  nb_contacts: number;
  taux_conversion: number;
}

// --- Stats temps réel --------------------------------------------------------

export interface KpiRealtime {
  visiteurs_aujourd_hui: number;
  vues_bourses_aujourd_hui: number;
  contacts_aujourd_hui: number;
  contacts_en_attente: number;
  abonnes_total: number;
  taux_conversion_global: number;
  evolution_7j: {
    visiteurs: number[];  // array de 7 valeurs (j-6 → aujourd'hui)
    contacts: number[];
  };
}

// --- Taux de conversion -------------------------------------------------------

export interface ConversionRate {
  global: number;
  par_bourse: BourseKpi[];
  par_page: { page: string; vues: number; conversions: number; taux: number }[];
}

// --- Événements bruts --------------------------------------------------------

export interface VisitorEvent {
  id: string;
  type: EventType;
  page: string;
  bourse_id: string | null;
  ip_hash: string;          // IP hashée (pas de données personnelles)
  user_agent: string;
  metadata: Record<string, unknown>;
  date_creation: string;
}

export interface EventFilters {
  type?: EventType;
  page?: string;
  bourse_id?: string;
  date_debut?: string;
  date_fin?: string;
  page_number?: number;
}

export interface KpiSnapshotFilters {
  date_debut?: string;
  date_fin?: string;
  periode?: "jour" | "semaine" | "mois";
}

// END OF FILE: src/types/api/kpi.types.ts


// FILE: src/types/api/media.types.ts
-----------------------------------------------
// src/types/api/media.types.ts
// ==============================================================================
//  Types TypeScript — Module Médias
//  Calque sur MediaAsset Django + serializers DRF
// ==============================================================================

// --- Modèle complet (admin) --------------------------------------------------

export interface MediaAsset {
  id: string;
  nom_fichier: string;
  fichier: string;              // URL relative ou absolue du fichier uploadé
  url_fichier: string;          // URL complète auto-générée
  texte_alt_fr: string;
  texte_alt_en: string;
  type_mime: string;
  taille_octets: number;
  date_upload: string;          // ISO datetime
}

// --- Modèle minimal (inclusion dans d'autres modèles) -----------------------
//     Correspond à MediaAssetMinimalSerializer

export interface MediaAssetMinimal {
  id: string;
  url_fichier: string;
  texte_alt_fr: string;
  texte_alt_en: string;
}

// --- Payloads ----------------------------------------------------------------

/** Upload d'un fichier — FormData (multipart) */
export interface UploadMediaPayload {
  fichier: File;
  nom_fichier?: string;
  texte_alt_fr?: string;
  texte_alt_en?: string;
}

/** Modification métadonnées (PATCH) */
export interface UpdateMediaPayload {
  nom_fichier?: string;
  texte_alt_fr?: string;
  texte_alt_en?: string;
}

// --- Réponse paginée ---------------------------------------------------------

export interface PaginatedMediaResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: MediaAsset[];
}

// --- Filtres -----------------------------------------------------------------

export interface MediaFilters {
  type_mime?: string;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// END OF FILE: src/types/api/media.types.ts


// FILE: src/types/api/newsletter.types.ts
-----------------------------------------------
// src/types/api/newsletter.types.ts
// ==============================================================================
//  Types TypeScript — Module Newsletter & Annonces
//  Calque sur NewsletterSubscriber, Announcement Django + serializers DRF
// ==============================================================================

import type { ScholarshipLevel, ScholarshipCountry } from "./scholarship.types";

// --- Énumérations ------------------------------------------------------------

export type StatutAnnonce = "BROUILLON" | "PROGRAMME" | "ENVOYE";

// --- NewsletterSubscriber ----------------------------------------------------

export interface NewsletterSubscriber {
  id: string;
  email: string;
  nom_complet: string;
  telephone: string;
  pays: string;
  niveau_etudes: ScholarshipLevel | "";
  destination_souhaitee: ScholarshipCountry | "";
  source: string;
  est_actif: boolean;
  date_inscription: string;
  date_desinscription: string | null;
}

// --- Payloads publics --------------------------------------------------------

/** POST /api/newsletter/inscription */
export interface NewsletterInscriptionPayload {
  email: string;
  nom_complet?: string;
  telephone?: string;
  pays?: string;
  source?: string;
  niveau_etudes?: ScholarshipLevel | "";
  destination_souhaitee?: ScholarshipCountry | "";
}

/** POST /api/newsletter/desinscription */
export interface NewsletterDesinscriptionPayload {
  email: string;
}

// --- Bourse liée (vue légère dans Announcement) ------------------------------

export interface AnnouncementBourseLinked {
  id: string;
  titre_fr: string;
}

// --- Announcement ------------------------------------------------------------

export interface Announcement {
  id: string;
  titre_fr: string;
  titre_en: string;
  contenu_fr: string;
  contenu_en: string;
  image: string | null;         // ID du média (FK)
  statut: StatutAnnonce;
  date_envoi: string | null;
  date_creation: string;
  bourses_liees: AnnouncementBourseLinked[];
}

export interface CreateAnnouncementPayload {
  titre_fr: string;
  titre_en: string;
  contenu_fr: string;
  contenu_en: string;
  image?: string | null;
  statut?: StatutAnnonce;
  date_envoi?: string | null;
  bourses_ids?: string[];
}

export type UpdateAnnouncementPayload = Partial<CreateAnnouncementPayload>;

// --- Réponse envoi annonce ---------------------------------------------------

export interface SendAnnouncementResponse {
  detail: string;
  abonnes_count: number;
  statut: StatutAnnonce;
}

// --- Réponses paginées -------------------------------------------------------

export interface PaginatedSubscriberResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: NewsletterSubscriber[];
}

export interface PaginatedAnnouncementResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: Announcement[];
}

// --- Filtres -----------------------------------------------------------------

export interface SubscriberFilters {
  est_actif?: boolean;
  pays?: string;
  niveau_etudes?: ScholarshipLevel | "";
  destination_souhaitee?: ScholarshipCountry | "";
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

export interface AnnouncementFilters {
  statut?: StatutAnnonce;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// END OF FILE: src/types/api/newsletter.types.ts


// FILE: src/types/api/scholarship.types.ts
-----------------------------------------------
// src/types/api/scholarship.types.ts
// ==============================================================================
//  Types TypeScript — Module Bourses
//  Calque exact sur les modèles Django / sérialiseurs DRF
// ==============================================================================

// Imports
import type { MediaAssetMinimal } from "./media.types";
// --- Énumérations (correspondent aux choices Django) -------------------------

export type ScholarshipStatus = "brouillon" | "publie" | "expire" | "archive";
export type ScholarshipLevel = "licence" | "master" | "doctorat" | "postdoc" | "formation" | "autre";
export type ScholarshipCoverage = "complete" | "partielle" | "logement" | "transport" | "autre";
export type ScholarshipCountry = "chine" | "allemagne" | "france" | "canada" | "autre";

// --- Sous-modèles ------------------------------------------------------------

export interface ScholarshipField {
  id: string;
  nom_fr: string;
  nom_en: string;
  icone: string;
}

export interface ScholarshipBenefit {
  id: string;
  libelle_fr: string;
  libelle_en: string;
  icone: string;
}

export interface ScholarshipEligibility {
  id: string;
  libelle_fr: string;
  libelle_en: string;
  icone: string;
}

/** Visibilité d'un champ — contrôle ce que le public voit */
export interface FieldVisibility {
  id: string;
  nom_du_champ: string;
  est_visible: boolean;
}

/** Dictionnaire pratique : { nom_du_champ: est_visible } */
export type FieldVisibilityMap = Record<string, boolean>;


export interface ScholarshipImage {
  id: string;
  media: MediaAssetMinimal;
  est_principale: boolean;
  ordre: number;
}

// --- Modèle principal — Liste publique (infos minimales) --------------------

export interface ScholarshipPublicListItem {
  id: string;
  titre_fr: string;
  titre_en: string;
  organisme_fr: string;
  organisme_en: string;
  pays_destination: ScholarshipCountry;
  niveau: ScholarshipLevel;
  statut: ScholarshipStatus;
  type_couverture: ScholarshipCoverage;
  date_limite: string | null;          // ISO date string ou null
  exigence_langue_fr: string;
  exigence_langue_en: string;
  details_montant_fr: string;          // jamais affiché côté public (field_visibility)
  details_montant_en: string;
  est_mise_en_avant: boolean;
  domaines: ScholarshipField[];
  image_principale: MediaAssetMinimal | null;
}

// --- Modèle principal — Détail public (avec visibilité appliquée) -----------

export interface ScholarshipPublicDetail {
  id: string;
  titre_fr: string;
  titre_en: string;
  organisme_fr: string;
  organisme_en: string;
  description_fr: string;
  description_en: string;
  pays_destination: ScholarshipCountry;
  niveau: ScholarshipLevel;
  statut: ScholarshipStatus;
  type_couverture: ScholarshipCoverage;
  date_limite: string | null;
  limite_age: number | null;
  exigence_langue_fr: string;
  exigence_langue_en: string;
  details_montant_fr: string;
  details_montant_en: string;
  lien_officiel: string;
  est_mise_en_avant: boolean;
  ordre_affichage: number;
  domaines: ScholarshipField[];
  avantages: ScholarshipBenefit[];
  criteres: ScholarshipEligibility[];
  images: ScholarshipImage[];
  visibilites: FieldVisibility[];       // → utiliser toFieldVisibilityMap()
  date_creation: string;
  date_modification: string;
}

// --- Modèle principal — Admin complet (CRUD) --------------------------------

// FIX : Utilisation d'un type alias au lieu d'une interface vide pour ESLint
export type ScholarshipAdmin = ScholarshipPublicDetail;

// --- Payloads de création/modification (admin) ------------------------------

export interface CreateScholarshipPayload {
  titre_fr: string;
  titre_en: string;
  organisme_fr: string;
  organisme_en: string;
  description_fr: string;
  description_en: string;
  pays_destination: ScholarshipCountry;
  niveau: ScholarshipLevel;
  statut: ScholarshipStatus;
  type_couverture: ScholarshipCoverage;
  date_limite?: string | null;
  limite_age?: number | null;
  exigence_langue_fr?: string;
  exigence_langue_en?: string;
  details_montant_fr?: string;
  details_montant_en?: string;
  lien_officiel?: string;
  est_mise_en_avant?: boolean;
  ordre_affichage?: number;
}

export type UpdateScholarshipPayload = Partial<CreateScholarshipPayload>;

export interface UpdateFieldVisibilityPayload {
  nom_du_champ: string;
  est_visible: boolean;
}

export interface AddScholarshipImagePayload {
  media_id: string;
  est_principale?: boolean;
  ordre?: number;
}

// --- Réponses paginées -------------------------------------------------------

export interface PaginatedResponse<T> {
  count: number;
  next: string | null;
  previous: string | null;
  results: T[];
}

export type ScholarshipListResponse = PaginatedResponse<ScholarshipPublicListItem>;
export type ScholarshipAdminListResponse = PaginatedResponse<ScholarshipAdmin>;

// --- Filtres (query params) --------------------------------------------------

export interface ScholarshipFilters {
  pays_destination?: ScholarshipCountry;
  niveau?: ScholarshipLevel;
  statut?: ScholarshipStatus;
  type_couverture?: ScholarshipCoverage;
  est_mise_en_avant?: boolean;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// --- Helper utilitaire -------------------------------------------------------

/**
 * Convertit le tableau FieldVisibility[] en dictionnaire pratique
 * Usage : const map = toFieldVisibilityMap(scholarship.visibilites)
 *         if (map['description_fr']) { ... }
 */
export function toFieldVisibilityMap(visibilites: FieldVisibility[]): FieldVisibilityMap {
  return visibilites.reduce<FieldVisibilityMap>((acc, v) => {
    acc[v.nom_du_champ] = v.est_visible;
    return acc;
  }, {});
}

/**
 * Liste de tous les champs d'une bourse soumis à la visibilité
 * Correspond aux champs que l'admin peut masquer/afficher
 */
export const SCHOLARSHIP_VISIBILITY_FIELDS = [
  "description_fr",
  "description_en",
  "date_limite",
  "limite_age",
  "exigence_langue_fr",
  "exigence_langue_en",
  "details_montant_fr",
  "details_montant_en",
  "lien_officiel",
  "avantages",
  "criteres",
  "images",
  "type_couverture",
] as const;

export type ScholarshipVisibilityField = (typeof SCHOLARSHIP_VISIBILITY_FIELDS)[number];

// END OF FILE: src/types/api/scholarship.types.ts


// FILE: src/types/api/service.types.ts
-----------------------------------------------
// src/types/api/service.types.ts
// ==============================================================================
//  Types TypeScript — Module Services
//  Calque sur Service, ServiceImage Django + serializers DRF
// ==============================================================================

import type { MediaAssetMinimal } from "./media.types";

// --- ServiceImage ------------------------------------------------------------

export interface ServiceImage {
  id: string;
  media: MediaAssetMinimal;
  est_principale: boolean;
  ordre: number;
}

// --- Service (public) --------------------------------------------------------

export interface ServicePublic {
  id: string;
  slug: string;
  nom_fr: string;
  nom_en: string;
  description_fr: string;
  description_en: string;
  icone: string;
  delai_traitement: string;
  images: ServiceImage[];
}

// --- Service (admin — champs supplémentaires) --------------------------------

export interface ServiceAdmin {
  id: string;
  slug: string;
  nom_fr: string;
  nom_en: string;
  description_fr: string;
  description_en: string;
  icone: string;
  delai_traitement: string;
  est_actif: boolean;
  ordre_affichage: number;
  images: ServiceImage[];
}

// --- Payloads CRUD -----------------------------------------------------------

export interface CreateServicePayload {
  slug: string;
  nom_fr: string;
  nom_en: string;
  description_fr: string;
  description_en: string;
  icone?: string;
  delai_traitement?: string;
  est_actif?: boolean;
  ordre_affichage?: number;
}

export type UpdateServicePayload = Partial<CreateServicePayload>;

/** POST /api/admin/services/{id}/images */
export interface AddServiceImagePayload {
  media_id: string;
  est_principale?: boolean;
}

// --- Réponses paginées -------------------------------------------------------

export interface PaginatedServiceResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: ServiceAdmin[];
}

// --- Filtres -----------------------------------------------------------------

export interface ServiceFilters {
  est_actif?: boolean;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// END OF FILE: src/types/api/service.types.ts


// FILE: src/types/api/testimonial.types.ts
-----------------------------------------------
// src/types/api/testimonial.types.ts
// ==============================================================================
//  Types TypeScript — Module Témoignages
//  Calque sur Testimonial Django + serializers DRF
// ==============================================================================

import type { MediaAssetMinimal } from "./media.types";

// --- Énumérations ------------------------------------------------------------

export type SourceTemoignage = "SITE" | "WHATSAPP" | "EMAIL";

// --- Public (témoignages approuvés + affichés) -------------------------------

export interface TestimonialPublic {
  id: string;
  nom_auteur: string;
  pays_auteur: string;
  citation_fr: string;
  citation_en: string;
  note: number;                 // 1–5
  photo: MediaAssetMinimal | null;
  date_creation: string;
}

// --- Admin (CRUD complet) ----------------------------------------------------

export interface TestimonialAdmin {
  id: string;
  nom_auteur: string;
  pays_auteur: string;
  citation_fr: string;
  citation_en: string;
  note: number;
  source: SourceTemoignage;
  photo: MediaAssetMinimal | null;
  fichier_joint: MediaAssetMinimal | null;
  est_approuve: boolean;
  est_affiche_sur_site: boolean;
  ordre_affichage: number;
  date_creation: string;
}

// --- Payload soumission publique (POST /api/temoignages) ---------------------

export interface SubmitTestimonialPayload {
  nom_auteur: string;
  pays_auteur?: string;
  citation_fr: string;
  citation_en?: string;
  note?: number;
}

// --- Payload admin (POST/PUT/PATCH) ------------------------------------------

export interface CreateTestimonialPayload {
  nom_auteur: string;
  pays_auteur?: string;
  citation_fr: string;
  citation_en?: string;
  note?: number;
  source?: SourceTemoignage;
  photo_id?: string | null;
  fichier_joint_id?: string | null;
  est_approuve?: boolean;
  est_affiche_sur_site?: boolean;
  ordre_affichage?: number;
}

export type UpdateTestimonialPayload = Partial<CreateTestimonialPayload>;

// --- Réponse paginée ---------------------------------------------------------

export interface PaginatedTestimonialResponse {
  count: number;
  next: string | null;
  previous: string | null;
  results: TestimonialAdmin[];
}

// --- Filtres admin -----------------------------------------------------------

export interface TestimonialFilters {
  est_approuve?: boolean;
  est_affiche_sur_site?: boolean;
  source?: SourceTemoignage;
  search?: string;
  page?: number;
  page_size?: number;
  ordering?: string;
}

// END OF FILE: src/types/api/testimonial.types.ts


// FILE: src/types/index.ts
-----------------------------------------------
// FILE: src/types/index.ts
// ==============================================================================

// --- Auth ---
export * from "@/types/api/auth.types"; // Retrait du mot-clé 'type' pour exporter les enums/consts si présents

// --- Bourses ---
export * from "@/types/api/scholarship.types"; // CRITIQUE : exporte toFieldVisibilityMap et SCHOLARSHIP_VISIBILITY_FIELDS

// --- Médias ---
export * from "@/types/api/media.types";

// --- CMS ---
export * from "@/types/api/cms.types";

// --- Contact ---
export * from "@/types/api/contact.types";

// --- Newsletter ---
export * from "@/types/api/newsletter.types";

// --- Témoignages ---
export * from "@/types/api/testimonial.types";

// --- Chatbot ---
export * from "@/types/api/chatbot.types";

// --- Services ---
export * from "@/types/api/service.types";

// --- KPI ---
export * from "@/types/api/kpi.types";

// END OF FILE: src/types/index.ts


// FILE: src/middleware.ts
-----------------------------------------------
// src/middleware.ts
// ==============================================================================
//  Middleware Next.js — Protection des routes /admin/*
//  Redirige vers /admin/login si aucun token valide
// ==============================================================================

import { NextRequest, NextResponse } from "next/server";

// Routes protégées par l'authentification JWT
const PROTECTED_PREFIXES = ["/admin"];

// Routes publiques même dans l'espace admin
const PUBLIC_ADMIN_ROUTES = ["/admin/login"];

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // Vérifier si la route est protégée
  const isProtected = PROTECTED_PREFIXES.some((prefix) =>
    pathname.startsWith(prefix)
  );

  if (!isProtected) return NextResponse.next();

  // Laisser passer les routes publiques admin (login)
  const isPublicAdminRoute = PUBLIC_ADMIN_ROUTES.some((route) =>
    pathname.startsWith(route)
  );

  if (isPublicAdminRoute) return NextResponse.next();

  // Vérifier la présence du token dans les cookies (httpOnly) ou le header
  // Note : localStorage n'est pas accessible côté middleware (server-side)
  // On utilise un cookie "salma_auth" posé lors du login
  const authCookie = request.cookies.get("salma_auth");
  const authHeader = request.headers.get("authorization");

  const hasToken = !!authCookie?.value || !!authHeader;

  if (!hasToken) {
    const loginUrl = new URL("/admin/login", request.url);
    // Conserver l'URL de destination pour redirection post-login
    loginUrl.searchParams.set("redirect", pathname);
    return NextResponse.redirect(loginUrl);
  }

  return NextResponse.next();
}

export const config = {
  // Matcher : protéger toutes les routes /admin/* sauf les fichiers statiques
  matcher: [
    "/admin/:path*",
    "/((?!_next/static|_next/image|favicon.ico|public).*)",
  ],
};

// END OF FILE: src/middleware.ts


// FILE: .gitignore
-----------------------------------------------
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts


// END OF FILE: .gitignore


// FILE: collab.md
-----------------------------------------------
# 🤝 Guide de Collaboration - Équipe SALMA

Bienvenue dans l'équipe ! Pour garantir un code de haute qualité (niveau ingénieur), nous suivons ces règles strictes.

## 1. 🌍 Internationalisation (i18n)
- **RÈGLE D'OR :** Interdiction d'écrire du texte en dur dans les fichiers `.tsx`.
- Toute chaîne de caractère doit être ajoutée dans `src/dictionaries/fr.ts` et traduite dans `en.ts`.
- Utilisation : `const { dictionary } = useLanguage();`.

## 2. 🎨 Développement UI (Tailwind v4)
- Avant de créer un nouveau composant, vérifiez s'il existe dans `src/components/ui/`.
- Respectez la charte graphique : 
  - Primaire : `#6B1E2E` (Bordeaux)
  - Accent : `#C9A84C` (Or)

## 3. 📝 Conventions de Nommage
- **Fichiers Composants :** PascalCase (ex: `ScholarshipCard.tsx`).
- **Dossiers Pages :** kebab-case (ex: `a-propos/`).
- **Variables/Fonctions :** Anglais uniquement (ex: `const getScholarshipList = ...`).
- **Commentaires :** Français (pour expliquer la logique métier).

## 4. 🌳 Gestion Git (Workflow)
- Ne jamais travailler directement sur `main`.
- **Branches :** 
  - `develop` : Intégration des fonctionnalités terminées.
  - `feat/nom-feature` : Votre branche de travail.
- **Commits :** Utilisez les prefixes :
  - `feat:` (nouvelle fonctionnalité)
  - `fix:` (correction de bug)
  - `docs:` (documentation)

## 🔄 Cycle de Validation
Chaque tâche doit suivre ce cycle :
1. **Conception** : Validation de l'approche avec le lead.
2. **Implémentation** : Code propre et modulaire.
3. **Test** : Vérification en mode sombre et en changement de langue.

// END OF FILE: collab.md


// FILE: eslint.config.mjs
-----------------------------------------------
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
];

export default eslintConfig;


// END OF FILE: eslint.config.mjs


// FILE: extract_context.ps1
-----------------------------------------------
<#
.SYNOPSIS
Extrait le code source d'un projet Next.js pour l'utiliser comme contexte IA.
#>

param (
    [string]$ProjectPath = "."
)

$OutputFilename = "project_context_w.txt"

# Résolution du chemin absolu
try {
    $ResolvedPath = (Resolve-Path $ProjectPath -ErrorAction Stop).Path
} catch {
    Write-Error "Erreur: Répertoire invalide ($ProjectPath)."
    exit 1
}

$OutputFile = Join-Path $ResolvedPath $OutputFilename

# Suppression de l'ancien fichier s'il existe
if (Test-Path $OutputFile) {
    Remove-Item $OutputFile -Force
}

# Dossiers à ignorer (optimisation : on n'y entre même pas)
$ExcludeDirs = @(
    ".git", ".vscode", ".idea", "node_modules", ".next", 
    "out", "build", "coverage", "public", "dist", ".vercel"
)

# Fichiers à ignorer (accepte les wildcards *)
$ExcludeFiles = @(
    "*.log", "package-lock.json", "yarn.lock", "pnpm-lock.yaml", "bun.lockb",
    ".env*", "*.ico", "*.png", "*.jpg", "*.jpeg", "*.svg", "*.webp", 
    "*.pdf", "*.map", "*.ttf", "*.woff", "*.woff2", "*.eot", "*.mp4",
    $OutputFilename
)

# Fonction pour vérifier si un fichier est binaire (contient des octets nuls)
function Test-IsBinary {
    param ([string]$FilePath)
    try {
        $bytes = [System.IO.File]::ReadAllBytes($FilePath)
        $checkLength = [math]::Min(1024, $bytes.Length)
        for ($i = 0; $i -lt $checkLength; $i++) {
            if ($bytes[$i] -eq 0) { return $true }
        }
        return $false
    } catch {
        return $true # En cas d'erreur de lecture, on ignore par sécurité
    }
}

$foundFiles = [System.Collections.Generic.List[string]]::new()

# Fonction récursive pour lister les fichiers valides
function Get-ValidFiles {
    param ([string]$CurrentDir)
    
    $items = Get-ChildItem -Path $CurrentDir -Force -ErrorAction SilentlyContinue
    
    foreach ($item in $items) {
        if ($item.PSIsContainer) {
            # Si c'est un dossier et qu'il n'est pas dans la liste d'exclusion
            if ($ExcludeDirs -notcontains $item.Name) {
                Get-ValidFiles -CurrentDir $item.FullName
            }
        } else {
            # Si c'est un fichier, on vérifie son extension/nom
            $skip = $false
            foreach ($pattern in $ExcludeFiles) {
                if ($item.Name -like $pattern) {
                    $skip = $true
                    break
                }
            }
            if (-not $skip) {
                $foundFiles.Add($item.FullName)
            }
        }
    }
}

Write-Host "Recherche des fichiers en cours..." -ForegroundColor Cyan
Get-ValidFiles -CurrentDir $ResolvedPath

# Écriture de l'en-tête
$dateStr = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
$header = @"
Next.js Project Context
Generated On: $dateStr
Root: $ResolvedPath
===============================================
"@

Set-Content -Path $OutputFile -Value $header -Encoding UTF8

Write-Host "Génération du fichier de contexte en cours..." -ForegroundColor Cyan

foreach ($file in $foundFiles) {
    # Calcul du chemin relatif
    $relativePath = $file.Substring($ResolvedPath.Length).TrimStart('\')
    $relativePath = $relativePath -replace '\\', '/' # Formatage type UNIX pour l'IA
    
    $fileHeader = "`n// FILE: $relativePath`n-----------------------------------------------"
    Add-Content -Path $OutputFile -Value $fileHeader -Encoding UTF8
    
    if (Test-IsBinary -FilePath $file) {
        Add-Content -Path $OutputFile -Value "[Fichier binaire ou asset omis]" -Encoding UTF8
    } else {
        try {
            # Lecture du contenu brut
            $content = Get-Content -Path $file -Raw -Encoding UTF8 -ErrorAction Stop
            if ($null -ne $content) {
                Add-Content -Path $OutputFile -Value $content -Encoding UTF8
            }
        } catch {
            Add-Content -Path $OutputFile -Value "[Erreur lors de la lecture du fichier]" -Encoding UTF8
        }
    }
    
    Add-Content -Path $OutputFile -Value "`n// END OF FILE: $relativePath`n" -Encoding UTF8
}

Write-Host "Succès ! Ton contexte Next.js est prêt dans : $OutputFile" -ForegroundColor Green

// END OF FILE: extract_context.ps1


// FILE: next-env.d.ts
-----------------------------------------------
/// <reference types="next" />
/// <reference types="next/image-types/global" />
/// <reference path="./.next/types/routes.d.ts" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.


// END OF FILE: next-env.d.ts


// FILE: next.config.ts
-----------------------------------------------
// next.config.ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
      {
        protocol: 'https',
        hostname: 'i.pravatar.cc',
      },
      {
        protocol: 'https',
        hostname: 'api-x75k2m8-v1.agtgroupholding.com',
      },
       { protocol: 'http',
         hostname: '127.0.0.1' },
    ],
  },
};

export default nextConfig;

// END OF FILE: next.config.ts


// FILE: package.json
-----------------------------------------------
{
  "name": "salma-frontend",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "next": "15.5.12",
    "next-themes": "^0.4.6",
    "react": "19.1.0",
    "react-dom": "19.1.0"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "15.5.12",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}


// END OF FILE: package.json


// FILE: postcss.config.mjs
-----------------------------------------------
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;


// END OF FILE: postcss.config.mjs


// FILE: prompt.md
-----------------------------------------------
# 🔄 PROMPT DE CONTINUITÉ — Projet SALMA
## AG Technologies · Yaoundé, Cameroun
### À donner à toute IA pour reprendre le projet avec le contexte complet

---

> **INSTRUCTION SYSTÈME** : Tu es un développeur fullstack senior qui travaille sur le projet SALMA. Avant de coder quoi que ce soit, tu dois TOUJOURS commencer par l'**audit complet** décrit ci-dessous, puis aider sur la tâche demandée. Ne saute jamais l'audit, même si je te demande directement une tâche.

---

## 📌 1. CONTEXTE DU PROJET

**SALMA** est un site web vitrine bilingue (FR/EN) pour **AG Technologies**, une agence camerounaise de promotion de bourses d'études et de mobilité vers la **Chine** et l'**Allemagne**. Le site comprend une **vitrine publique** (pour attirer et convertir des prospects) et un **dashboard admin** (pour gérer tout le contenu sans développeur).

### Stack technique
| Couche | Techno | Détails |
|--------|--------|---------|
| **Frontend** | Next.js 15 (App Router) | TypeScript strict, Tailwind CSS v4, i18n FR/EN |
| **Backend** | Django + DRF | JWT (SimpleJWT), SQLite (dev) / PostgreSQL (prod) |
| **API** | REST — 107 endpoints | 17 publics + 90 admin |
| **Hébergement** | Vercel (front) + Hostinger (back) | Backend V1 déployé |

### URL Backend déployé (V1)
```
https://api-x75k2m8-v1.agtgroupholding.com/api/docs/
```
> Swagger UI accessible — tous les endpoints sont testables ici.

### Identité visuelle
celle de ce fichier : {/* src/app/globals.css */
@import "tailwindcss";

@theme inline {
  --font-serif: var(--font-cormorant), Georgia, serif;
  --font-sans: var(--font-inter), system-ui, sans-serif;

  --color-salma-primary:       #1B365D; 
  --color-salma-primary-dark:  #11243D;
  --color-salma-primary-light: #2D5284;
  --color-salma-accent:        #00AEEF; 
  --color-salma-gold:          #C9A84C;
  --color-salma-gold-light:    #E8C97A;
  --color-salma-gold-dark:     #A68635;

  --color-bg:         var(--bg);
  --color-surface:    var(--surface);
  --color-border:     var(--border);
  --color-text:       var(--text);
  --color-text-muted: var(--text-muted);
  --color-heading:    var(--heading);

  --shadow-salma-sm:  0 2px 10px rgba(0, 174, 239, 0.05);
  --shadow-salma-md:  0 10px 30px rgba(27, 54, 93, 0.1);
  --shadow-salma-lg:  0 20px 50px rgba(27, 54, 93, 0.15);
}

:root {
  --bg:         #FFFFFF;
  --surface:    #F8FAFC;
  --border:     #E2E8F0;
  --text:       #0F172A;
  --text-muted: #64748B;
  --heading:    #1B365D; 
}

.dark {
  /* On utilise un bleu très sombre saturé pour garder l'identité Navy */
  --bg:         #0F172A; /* Bleu nuit profond */
  --surface:    #1E293B; /* Bleu ardoise pour les cartes */
  --border:     #334155; /* Bordures visibles mais discrètes */
  --text:       #94A3B8; /* Gris bleuté pour le texte */
  --text-muted: #64748B;
  --heading:    #F8FAFC; /* Titres en blanc cassé pour le contraste */
}

body {
  background-color: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  transition: background-color 0.4s ease, color 0.4s ease;
}

h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-serif);
  font-weight: 700;
  color: var(--heading); 
  transition: color 0.4s ease;
}

### Philosophie métier (CRITIQUE)
- Le site **ne dévoile pas tout** : publier le minimum pour intéresser, inciter à contacter l'agence (on vend l'accompagnement).
- **Pas de prix sur la vitrine** — l'admin peut les saisir en BD mais le `field_visibility` contrôle ce qui s'affiche.
- Chaque champ d'une bourse est soumis à un système de **visibilité par champ** (`field_visibility: Record<string, boolean>`) contrôlé par l'admin.
- L'objectif n°1 est la **conversion** : visiteur → prise de contact / rendez-vous → vente.

---

## 📌 2. ARCHITECTURE FRONTEND (Séparation des responsabilités)

```
Composant (UI)
    ↓ connaît uniquement
Dictionnaire de données (/dictionaries/data/)
    ↓ appelle
Repository (/repositories/)
    ↓ appelle
api-client.ts
    ↓ appelle
Backend Django (REST API)
```

**Règles d'or :**
- Les **Server Components** fetchent via les **dictionnaires de données** uniquement
- Les **Client Components** utilisent des **hooks** ou reçoivent les données en **props**
- **Zéro** appel fetch direct dans un composant UI
- Tout texte visible → dictionnaire **i18n** (fr/en)
- Tout champ de bourse → soumis au **`field_visibility`** de l'admin

---

## 📌 3. CONTRATS D'API (107 endpoints)

| Module | Public | Admin | Total |
|--------|:------:|:-----:|:-----:|
| Auth | 2 | 7 | 9 |
| Bourses | 3 | 22 | 25 |
| Contact | 1 | 4 | 5 |
| Newsletter & Annonces | 2 | 10 | 12 |
| Témoignages | 2 | 6 | 8 |
| Chatbot | 1 | 5 | 6 |
| CMS (Pages, Blocs, Config, Vidéos) | 3 | 17 | 20 |
| Services | 2 | 9 | 11 |
| Médias | 0 | 5 | 5 |
| KPI & Analytics | 1 | 5 | 6 |
| **TOTAL** | **17** | **90** | **107** |

> Le fichier `Salma_contrats_api.md` contient les détails complets (méthodes, endpoints, descriptions, auth requise).

---

## 📌 4. REMARQUES CLIENT (à toujours garder en tête)

1. **Mode sombre** pas encore fonctionnel → à compléter
2. **Responsive obligatoire** — priorité smartphones (contexte Cameroun)
3. **Images de qualité supérieure**
4. **Animations et hover effects** — l'UX doit donner envie
5. Retirer **"Travel Agency"** de la navbar
6. Changer la **photo hero** de la page d'accueil
7. Chaque champ du frontend **modifiable via le dashboard admin** (CMS complet)
8. **KPI en temps réel** + taux de conversion
9. **Cookies & politique de confidentialité** (RGPD-friendly)
10. **Newsletter** pour collecter des prospects qualifiés
11. **Chatbot Gemini** en attendant le chatbot WhatsApp Business
12. **Vidéo de pitch** intégrée
13. **Notifications agence** après rendez-vous (mail + WhatsApp + toast dashboard)

---

## 📌 5. TODO COMPLÈTE — AUDIT SYSTÉMATIQUE

> **INSTRUCTION** : À chaque nouvelle session, parcours TOUTE cette checklist et indique pour chaque item : ✅ (fait), 🔧 (en cours/partiel), ❌ (non commencé). Ne saute AUCUN item, même ceux cochés — une erreur de frappe est possible.

### PHASE 1 — SOCLE TECHNIQUE (Bloquant)

#### 1.1 Types TypeScript exhaustifs
| Fichier | Statut attendu | À vérifier |
|---------|:-:|---|
| `src/types/api/scholarship.types.ts` | ✅ | Modèle complet + `field_visibility` |
| `src/types/api/service.types.ts` | ❌ | À créer |
| `src/types/api/cms.types.ts` | ❌ | Pages, sections, champs CMS |
| `src/types/api/contact.types.ts` | ❌ | Demandes + rendez-vous |
| `src/types/api/newsletter.types.ts` | ❌ | Abonnés + annonces |
| `src/types/api/testimonial.types.ts` | ❌ | Témoignages |
| `src/types/api/chatbot.types.ts` | ❌ | Questions/réponses FAQ |
| `src/types/api/media.types.ts` | ❌ | Médias |
| `src/types/api/kpi.types.ts` | ✅ | Snapshots, temps-réel, conversion |
| `src/types/api/auth.types.ts` | ✅ | JWT tokens, user, profil admin |
| `src/types/index.ts` | ✅ | Barrel export |

#### 1.2 Repositories (couche d'accès données)
| Fichier | Statut attendu | Endpoints |
|---------|:-:|---|
| `scholarship.repository.ts` | ✅ | 25 endpoints |
| `service.repository.ts` | ✅ | 11 endpoints |
| `cms.repository.ts` | ✅ | 20 endpoints |
| `contact.repository.ts` | ❌ | 5 endpoints |
| `newsletter.repository.ts` | ✅ | 12 endpoints |
| `testimonial.repository.ts` | ❌ | 8 endpoints |
| `chatbot.repository.ts` | ✅ | 6 endpoints |
| `media.repository.ts` | ❌ | 5 endpoints |
| `kpi.repository.ts` | ✅ | 6 endpoints |
| `auth.repository.ts` | ✅ | 9 endpoints |
| `events.repository.ts` | ✅ | Tracking visiteurs |

#### 1.3 Dictionnaires de données
| Fichier | Statut attendu |
|---------|:-:|
| `scholarship.data-dictionary.ts` | ✅ |
| `cms.data-dictionary.ts` | ✅ |
| `contact.data-dictionary.ts` | ❌ |
| `newsletter.data-dictionary.ts` | ❌ |
| `kpi.data-dictionary.ts` | ❌ |

#### 1.4 Authentification JWT
| Élément | Statut attendu |
|---------|:-:|
| `src/lib/auth.ts` — helpers tokens (cookies httpOnly) | ✅ |
| `src/middleware.ts` — protection routes `/admin/*` | ✅ |
| Page `/admin/login` | ✅ |
| `src/hooks/useAuth.ts` | ✅ |
| Refresh token automatique (intercepteur api-client) | ✅ |
| Logout (purge cookies + redirect) | ✅ |

---

### PHASE 2 — VITRINE DYNAMIQUE (Liaison Backend)

#### 2.1 Home Page
| Élément | Statut attendu |
|---------|:-:|
| KPIBar en SSR (stats temps-réel) | ✅ |
| Bourses à la une (Server Component) | ✅ |
| ScholarshipCard avec `field_visibility` | ✅ |
| Bouton WhatsApp flottant contextuel | ✅ |
| Section vidéo de pitch | ✅ |
| Tracking `PAGE_VIEW` + `BOURSE_VUE` | ✅ |

#### 2.2 Catalogue `/bourses`
| Élément | Statut attendu |
|---------|:-:|
| Fetch liste avec filtres (pays, niveau, domaine, statut) | ✅ |
| Filtres dynamiques côté client (URL params) | ✅ |
| Pagination serveur | ✅ |
| "Scholarship Matcher" (3 clics) | ✅ |
| Skeleton loaders | ✅ |

#### 2.3 Page détail `/bourses/[slug]`
| Élément | Statut attendu |
|---------|:-:|
| Route dynamique SSG + ISR (revalidate 60s) | ✅ |
| Affichage conditionnel chaque champ (`field_visibility`) | ✅ |
| Jamais afficher le prix côté vitrine | ✅ |
| CTA fort + WhatsApp contextuel | ✅ |
| Métadonnées dynamiques (OG, SEO) | ✅ |

#### 2.4 Formulaire de contact
| Élément | Statut attendu |
|---------|:-:|
| Envoi réel vers `POST /api/contact` | ❌ |
| Validation côté client (Zod) | ❌ |
| Confirmation UI (état success) | ❌ |
| Tracking `CONTACT_SOUMIS` | ❌ |

#### 2.5 Prise de rendez-vous
| Élément | Statut attendu |
|---------|:-:|
| Formulaire dédié | ❌ |
| Envoi vers API contact (type `rendez-vous`) | ❌ |
| Notification agence | ❌ |

#### 2.6 Témoignages
| Élément | Statut attendu |
|---------|:-:|
| Section sur la Home (`GET /api/temoignages`) | ❌ |
| Seuls les `approuvés` s'affichent | ❌ |

---

### PHASE 3 — DASHBOARD ADMIN COMPLET

#### 3.1 Layout & Navigation
| Élément | Statut attendu |
|---------|:-:|
| Sidebar responsive (collapse mobile) | ❌ |
| Navigation toutes sections | ❌ |
| Badge notifications (contacts non lus) | ❌ |

#### 3.2 Gestion des bourses (CRUD)
| Élément | Statut attendu |
|---------|:-:|
| Tableau pagination + recherche + filtres | ❌ |
| Formulaire création/édition complet | ❌ |
| Toggle visibilité par champ | ❌ |
| Upload image principale | ❌ |
| Galerie images (add/remove/set principale) | ❌ |
| Duplication bourse | ❌ |
| Publication/Dépublication rapide | ❌ |

#### 3.3 Gestionnaire CMS
| Élément | Statut attendu |
|---------|:-:|
| Interface par page (Home, À propos, Contact…) | ❌ |
| Sections éditables inline | ❌ |
| Preview en temps réel | ❌ |
| Sauvegarde via `cms.repository.ts` | ❌ |

#### 3.4 Bibliothèque de médias
| Élément | Statut attendu |
|---------|:-:|
| Upload drag-and-drop | ❌ |
| Grille preview + métadonnées | ❌ |
| Copier URL, supprimer, renommer | ❌ |
| Filtres par type | ❌ |

#### 3.5 Gestion contacts & candidatures
| Élément | Statut attendu |
|---------|:-:|
| Liste des demandes (contact + RDV) | ❌ |
| Statuts : nouveau/en cours/traité | ❌ |
| Actions : marquer traité, noter, archiver | ❌ |
| Filtres type + période | ❌ |

#### 3.6 Newsletter & abonnés
| Élément | Statut attendu |
|---------|:-:|
| Liste abonnés | ❌ |
| Créer & envoyer annonce | ❌ |
| Segmentation actif/inactif | ❌ |

#### 3.7 Témoignages (admin)
| Élément | Statut attendu |
|---------|:-:|
| Liste avec statuts (attente/approuvé/rejeté) | ❌ |
| Approuver/rejeter en 1 clic | ❌ |
| Ordre d'affichage | ❌ |

#### 3.8 KPI & Analytics (admin)
| Élément | Statut attendu |
|---------|:-:|
| Vue d'ensemble (visiteurs, vues, contacts, conversion) | ❌ |
| Graphiques temporels (snapshots) | ❌ |
| Détail par bourse | ❌ |
| Événements bruts filtrables | ❌ |
| Bouton déclencher `generate_kpi` | ❌ |

---

### PHASE 4 — FEATURES AVANCÉES & POLISH

#### 4.1 Chatbot IA (Gemini)
| Élément | Statut attendu |
|---------|:-:|
| Widget flottant vitrine (ouvrir/fermer) | ❌ |
| Fetch FAQ depuis BD | ❌ |
| Intégration Gemini API | ❌ |
| Fallback → inciter à contacter l'agence | ❌ |
| Admin : CRUD questions/réponses | ❌ |

#### 4.2 Mode sombre
| Élément | Statut attendu |
|---------|:-:|
| CSS variables thème sombre | ❌ |
| Test chaque page/composant | ❌ |
| Toggle fonctionnel navbar | ❌ |

#### 4.3 Responsive & UX
| Élément | Statut attendu |
|---------|:-:|
| Audit responsive (mobile-first) | ❌ |
| Retirer "Travel Agency" navbar | ❌ |
| Changer photo hero accueil | ❌ |
| Animations page load | ❌ |
| Hover effects cards | ❌ |
| Skeleton loaders génériques | ❌ |

#### 4.4 Cookies & Confidentialité
| Élément | Statut attendu |
|---------|:-:|
| Bannière consentement cookies | ❌ |
| Page `/confidentialite` | ❌ |
| Stockage consentement → activer/bloquer tracking | ❌ |

#### 4.5 Newsletter vitrine
| Élément | Statut attendu |
|---------|:-:|
| Formulaire footer + popup exit-intent | ❌ |
| Champs : email, prénom, niveau, pays cible | ❌ |
| Double opt-in simulé | ❌ |

#### 4.6 Notifications & alertes
| Élément | Statut attendu |
|---------|:-:|
| Email agence après soumission RDV | ❌ |
| Toast notification dashboard admin | ❌ |

#### 4.7 SEO & Performance
| Élément | Statut attendu |
|---------|:-:|
| Métadonnées dynamiques toutes pages | ❌ |
| `robots.txt` + `sitemap.xml` dynamiques | ❌ |
| Optimisation images (next/image, WebP, lazy) | ❌ |
| Audit Lighthouse > 90 | ❌ |
| Domaine backend dans `next.config.ts` (remotePatterns) | ❌ |

---

### PHASE 5 — DÉPLOIEMENT & INFRASTRUCTURE

| Élément | Statut attendu |
|---------|:-:|
| `.env.production` | ❌ |
| `next.config.ts` domaine backend prod | ❌ |
| Deploy Vercel (front) + Hostinger (back) | 🔧 (back V1 déployé) |
| CORS backend pour domaine Vercel | ❌ |
| DNS : `salma-studies.com` → Vercel + API | ❌ |
| Cron `generate_kpi` (Hostinger) | ❌ |
| Migration SQLite → PostgreSQL/MySQL | ❌ |
| Test end-to-end post-déploiement | ❌ |

---

### BACKEND — Todo

| Phase | Élément | Statut attendu |
|-------|---------|:-:|
| 1 | Config environnement + deps | ✅ |
| 1 | Création projet Django + app core | ✅ |
| 1 | Config BD + CORS | ✅ |
| 1 | Structure modulaire | ✅ |
| 1 | Documentation API (Swagger/OpenAPI) | ❌ (partiel) |
| 2 | Modèle `MediaAsset` | ✅ |
| 2 | Stockage fichiers (Media root/url) | ✅ |
| 3 | Modèles Scholarship + FieldVisibility | ✅ |
| 3 | Serializers + Viewsets | ✅ |
| 4 | CMS : SitePage, ContentBlock, SiteConfig, PitchVideo | ✅ |
| 4 | Service + Endpoints | ✅ |
| 5 | ContactRequest + Newsletter + Testimonials + FAQ | ✅ |
| 6 | Custom User + JWT + Permissions | ✅ |
| 7 | VisitorEvent + KpiSnapshot | ✅ |
| Seed | Commande `seed_data` + données réalistes | ✅ |

---

## 📌 6. DOCUMENTS DE RÉFÉRENCE

Quand tu travailles sur ce projet, demande-moi toujours les fichiers suivants si tu ne les as pas déjà :

| Document | Contenu | Quand le consulter |
|----------|---------|-------------------|
| `Salma_contrats_api.md` | Tous les 107 endpoints détaillés | Avant toute liaison API |
| `remarques_clients_sur_le_prototype.md` | Retours client exhaustifs | Avant toute décision UX |
| `maquette_dashboard_avec_stitch.txt` | Maquette HTML du dashboard | Avant tout travail sur l'admin |
| `cahier_de_charge_salma.pdf` | Cahier des charges complet | Pour le cadrage général |
| `backend_actuel` | Code source Django complet | Pour comprendre les modèles/serializers |
| `frontend_actuel` | Code source Next.js complet | Pour comprendre l'architecture existante |

---

## 📌 7. PROCÉDURE À SUIVRE À CHAQUE SESSION

```
1. LIRE ce prompt entièrement
2. Demander les fichiers de contexte à jour (code frontend + backend actuels)
3. AUDITER : parcourir la section 5 (TODO complète) et indiquer le statut RÉEL de chaque item
   → Format : ✅ fait | 🔧 partiel | ❌ non fait
   → Ne sauter AUCUN item, y compris ceux marqués ✅
4. IDENTIFIER les écarts entre le statut attendu et le statut réel
5. RÉSUMER l'avancement global (% par phase)
6. DEMANDER : "Sur quelle tâche veux-tu qu'on travaille ?"
7. EXÉCUTER la tâche demandée en respectant :
   - L'architecture (composant → dictionnaire → repository → api-client)
   - Le TypeScript strict
   - L'i18n (tout texte visible en FR/EN)
   - Le field_visibility sur les bourses
   - Le responsive mobile-first
```

---

## 📌 8. ORDRE D'EXÉCUTION RECOMMANDÉ

1. Types TypeScript manquants (1.1) — base de tout
2. Repositories manquants (1.2) — briques d'accès API
3. Dictionnaires manquants (1.3) — orchestration
4. Dashboard bourses CRUD (3.2) — valeur immédiate pour le client
5. Dashboard CMS (3.3) — autonomie totale du boss
6. Formulaire contact + RDV (2.4, 2.5) — conversion !
7. Témoignages vitrine + admin (2.6, 3.7)
8. Newsletter vitrine + admin (4.5, 3.6)
9. Contacts & candidatures admin (3.5)
10. KPI Dashboard (3.8) — analytics
11. Chatbot Gemini (4.1)
12. Médias admin (3.4)
13. Polish UX (4.2, 4.3) + Cookies (4.4)
14. SEO (4.7) + Notifications (4.6)
15. Déploiement final (Phase 5)

---

> **Rappel** : Le backend V1 est **déjà déployé** sur `https://api-x75k2m8-v1.agtgroupholding.com/api/docs/`. La phase actuelle est la **liaison frontend ↔ backend** et la complétion du dashboard admin. L'objectif est d'arriver au produit complet déployable.

// END OF FILE: prompt.md


// FILE: README.md
-----------------------------------------------
# 🌍 SALMA — Plateforme de Bourses d'Études (by AG Technologies)

> **Slogan :** "Bourse d'étude en Chine chez nous c'est Satisfait ou Remboursé…"

Ce projet est une plateforme web moderne permettant de gérer et de présenter des offres de bourses d'études en **Chine** et en **Allemagne**.

## 🚀 Stack Technique
- **Frontend :** Next.js 15 (App Router), Tailwind CSS v4, Shadcn UI.
- **Backend :** Django, Django REST Framework (API).
- **Base de données :** SQLite (Dev) / PostgreSQL (Prod).

## 📂 Structure du Projet
- `/salma-frontend` : Site vitrine et Dashboard administrateur.
- `/salma-backend` : API REST Django et gestion des données.

## 🛠️ Installation Rapide (Frontend)
1. `cd salma-frontend`
2. `npm install`
3. `npm run dev`
Le site sera disponible sur `http://localhost:3000`.

## 📍 Contacts & Localisation
- **Siège :** Montée Anne rouge, Immeuble Kadji (à côté de BGFI Bank), Yaoundé, Cameroun.
- **Email :** secretariatagtechnologies@gmail.com
- **Téléphones :** +237 6 99 45 09 84 / +237 6 51 74 03 28

// END OF FILE: README.md


// FILE: todo.md
-----------------------------------------------
# 📋 TODO SALMA — Version Mise à Jour
> AG Technologies · Dernière mise à jour : 27/02/2026  
> Stack : Next.js 15 · Tailwind v4 · TypeScript strict · Django DRF · JWT

---

## ✅ DÉJÀ FAIT
- [x] Configuration client API (`api-client.ts` avec `fetch`, Base URL, gestion d'erreurs)
- [x] Thème clair forcé, architecture sémantique CSS variables prête
- [x] Système i18n (dictionnaires fr/en, hook `useLanguage`, `useTheme`)
- [x] Layout admin avec sidebar
- [x] Dashboard admin : tableau des bourses (statique + modal d'ajout/édition)
- [x] Architecture App Router Next.js 15 (routes admin/vitrine séparées)

---

## 🔴 PHASE 1 — SOCLE TECHNIQUE (Bloquant)
> Doit être fait AVANT toute liaison backend

### 1.1 Types TypeScript exhaustifs
- [x] `src/types/api/scholarship.types.ts` — modèle complet (tous les champs Django + `field_visibility: Record<string, boolean>`)
- [x] `src/types/api/service.types.ts`
- [x] `src/types/api/cms.types.ts` (pages, sections, champs CMS)
- [x] `src/types/api/contact.types.ts` (demandes + rendez-vous)
- [x] `src/types/api/newsletter.types.ts` (abonnés + annonces)
- [x] `src/types/api/testimonial.types.ts`
- [x] `src/types/api/chatbot.types.ts` (questions/réponses FAQ)
- [x] `src/types/api/media.types.ts`
- [x] `src/types/api/kpi.types.ts` (snapshots, temps-réel, conversion)
- [x] `src/types/api/auth.types.ts` (JWT tokens, user, profil admin)
- [x] `src/types/index.ts` — barrel export de tous les types

### 1.2 Repositories (couche d'accès données)
> Un repository = 1 module d'API. Ne connaît que `api-client.ts`.

- [x] `src/repositories/scholarship.repository.ts` (25 endpoints : public + admin CRUD + images)
- [x] `src/repositories/service.repository.ts` (11 endpoints)
- [x] `src/repositories/cms.repository.ts` (20 endpoints : pages, sections, champs)
- [] `src/repositories/contact.repository.ts` (5 endpoints)
- [x] `src/repositories/newsletter.repository.ts` (12 endpoints)
- [x] `src/repositories/testimonial.repository.ts` (8 endpoints)
- [x] `src/repositories/chatbot.repository.ts` (6 endpoints)
- [x] `src/repositories/media.repository.ts` (5 endpoints)
- [x] `src/repositories/kpi.repository.ts` (6 endpoints)
- [x] `src/repositories/auth.repository.ts` (9 endpoints : login, refresh, profil, reset pwd)
- [x] `src/repositories/events.repository.ts` (tracking visiteurs — POST `/api/evenements`)

### 1.3 Dictionnaires (couche d'abstraction)
> Un dictionnaire orchestre les repositories. Les Server Components ne connaissent que les dictionnaires.

- [x] `src/dictionaries/data/scholarship.data-dictionary.ts`
- [x] `src/dictionaries/data/cms.data-dictionary.ts`
- [x] `src/dictionaries/data/contact.data-dictionary.ts`
- [x] `src/dictionaries/data/newsletter.data-dictionary.ts`
- [x] `src/dictionaries/data/kpi.data-dictionary.ts`
- [x] Pattern : toutes les fonctions `async`, retournent des données typées, centralisent le `revalidate` ISR

### 1.4 Authentification JWT (admin)
- [x] `src/lib/auth.ts` — helpers pour stocker/lire/rafraîchir tokens (cookies httpOnly côté server)
- [x] `src/middleware.ts` — protection routes `/admin/*`, redirection vers `/admin/login`
- [x] Page `/admin/login` — formulaire typé, appel `auth.repository.ts`, stockage token
- [x] `src/hooks/useAuth.ts` — état auth côté client (token valide, user info)
- [x] Gestion refresh token automatique (intercepteur dans `api-client.ts`)
- [x] Logout (purge cookies + redirect)

---

## 🟠 PHASE 2 — VITRINE DYNAMIQUE (Liaison Backend)

### 2.1 Home Page
- [x] Fetch stats réelles (KPI temps-réel) en SSR → KPIBar
- [x] Bourses à la une — Server Component avec `scholarship.data-dictionary.getFeatured()`
- [x] `ScholarshipCard` : affichage conditionnel selon `field_visibility` (ne montrer que ce que l'admin autorise)
- [x] Bouton WhatsApp flottant contextuel (message pré-rempli selon la page courante)
- [x] Section vidéo de pitch (intégration YouTube/Vimeo ou fichier uploadé)
- [x] Tracking événement `PAGE_VIEW` + `BOURSE_VUE` via `events.repository.ts`

### 2.2 Catalogue complet `/bourses`
- [x] Server Component : fetch liste avec filtres (pays, niveau, domaine, statut)
- [x] Filtres dynamiques côté client (URL params) sans rechargement page
- [x] Pagination serveur (cursor ou offset)
- [x] "Scholarship Matcher" — outil 3 clics (Niveau → Budget → Pays → résultats filtrés)
- [x] Skeleton loaders pendant fetch

### 2.3 Page de détail `/bourses/[slug]`
- [x] Route dynamique SSG + ISR (revalidate 60s)
- [x] Affichage conditionnel de CHAQUE champ selon `field_visibility`
- [x] **Jamais afficher le prix** côté vitrine (contrôle via `field_visibility`)
- [x] CTA fort : "En savoir plus → contacter l'agence" + bouton WhatsApp contextuel
- [x] Métadonnées dynamiques (OpenGraph, SEO)

### 2.4 Formulaire de contact
- [x] Envoi réel vers `POST /api/contact`
- [x] Validation côté client (Zod ou validation native TypeScript)
- [x] Confirmation mail simulé (état success UI)
- [x] Tracking événement `CONTACT_SOUMIS`

### 2.5 Prise de rendez-vous
- [x] Formulaire dédié (nom, email, tel, date souhaitée, objet)
- [x] Envoi vers API contact avec type `rendez-vous`
- [x] Notification agence : email (simulé via backend) + toast dans dashboard admin

### 2.6 Témoignages
- [x] Section témoignages sur la Home (fetch `GET /api/temoignages`)
- [x] Seuls les témoignages `approuvés` s'affichent

---

## 🟡 PHASE 3 — DASHBOARD ADMIN COMPLET

### 3.1 Layout & Navigation admin
- [ ] Sidebar responsive (collapse sur mobile)
- [ ] Navigation vers toutes les sections : Bourses, CMS, Médias, Contacts, Newsletter, Témoignages, Chatbot, KPI
- [ ] Badge notifications (nouvelles demandes de contact non lues)

### 3.2 Gestion des bourses (CRUD complet)
- [ ] Tableau avec pagination, recherche, filtres (statut, pays)
- [ ] Formulaire création/édition COMPLET avec tous les champs du modèle Django
- [ ] **Toggle de visibilité par champ** — l'admin coche/décoche ce qui s'affiche sur le site
- [ ] Upload image principale (via `media.repository.ts`)
- [ ] Galerie d'images additionnelles (add/remove/set-principale)
- [ ] Duplication d'une bourse
- [ ] Publication / Dépublication rapide (toggle statut)

### 3.3 Gestionnaire CMS (contrôle total du contenu vitrine)
- [ ] Interface par page (Home, À propos, Contact, etc.)
- [ ] Chaque section éditable inline : titre, sous-titre, texte, image, CTA
- [ ] Preview en temps réel ou lien vers la page vitrine
- [ ] Sauvegarde via `cms.repository.ts` → ISR invalide le cache automatiquement

### 3.4 Bibliothèque de médias
- [ ] Upload drag-and-drop (images, documents)
- [ ] Grille avec preview, nom, poids, date
- [ ] Copier l'URL, supprimer, renommer (métadonnées)
- [ ] Filtres par type (image / document)

### 3.5 Gestion des contacts & candidatures
- [ ] Liste des demandes (contact + rendez-vous)
- [ ] Statuts : `nouveau`, `en cours`, `traité`
- [ ] Marquer comme traité, noter, archiver
- [ ] Filtres par type et période

### 3.6 Newsletter & abonnés
- [ ] Liste des abonnés (email, date, source)
- [ ] Créer & envoyer une annonce (simulé côté backend → TODO Mailjet/SendGrid)
- [ ] Segmentation de base (actif / inactif)

### 3.7 Témoignages
- [ ] Liste avec statut `en attente` / `approuvé` / `rejeté`
- [ ] Approuver/rejeter en un clic
- [ ] Ordre d'affichage drag-and-drop

### 3.8 KPI & Analytics
- [ ] Vue d'ensemble : visiteurs, vues bourses, contacts, taux de conversion
- [ ] Graphiques temporels (snapshots par période)
- [ ] Détail par bourse (quelle bourse génère le plus de contacts ?)
- [ ] Événements bruts filtrables
- [ ] Commande backend : déclencher `generate_kpi` depuis l'interface (bouton admin)

---

## 🟢 PHASE 4 — FEATURES AVANCÉES & POLISH

### 4.1 Chatbot IA (Gemini)
- [ ] Widget chatbot flottant sur la vitrine (ouverture/fermeture)
- [ ] Fetch FAQ depuis `GET /api/chatbot/questions` (base de connaissances en BD)
- [ ] Intégration Gemini API : recherche dans les FAQs + génération de réponse naturelle
- [ ] Si aucune réponse → incitation à contacter l'agence ou prendre RDV
- [ ] Interface admin : gestion des Q&A (CRUD questions, catégories, statut actif/inactif)

### 4.2 Mode sombre
- [ ] Compléter les CSS variables pour le thème sombre
- [ ] Tester chaque page/composant en dark mode
- [ ] Toggle fonctionnel dans la navbar (ThemeSwitcher)

### 4.3 Responsive & UX
- [ ] Audit responsive complet (mobile-first, priorité smartphones Cameroun)
- [ ] Navbar : retirer "Travel Agency"
- [ ] Changer photo hero page d'accueil
- [ ] Animations page load (staggered reveals CSS)
- [ ] Hover effects sur les cards (scale, shadow, description au survol)
- [ ] Skeleton loaders génériques réutilisables

### 4.4 Cookies & Confidentialité
- [ ] Bannière de consentement cookies (RGPD-friendly)
- [ ] Page `/confidentialite` — politique de confidentialité
- [ ] Stockage consentement (localStorage) → activer/bloquer le tracking KPI

### 4.5 Collecte de prospects (Newsletter vitrine)
- [ ] Formulaire newsletter dans le footer + popup exit-intent
- [ ] Champs : email, prénom, niveau d'études, pays cible → base de prospects qualifiée
- [ ] Double opt-in simulé côté backend

### 4.6 Notifications & alertes agence
- [ ] Après soumission rendez-vous → email à l'agence (backend simulé)
- [ ] Toast notification dans le dashboard admin (polling ou WebSocket basique)
- [ ] Futur : notif WhatsApp Business API

### 4.7 SEO & Performance
- [ ] Métadonnées dynamiques sur toutes les pages (title, description, OG)
- [ ] `robots.txt` et `sitemap.xml` dynamiques
- [ ] Optimisation images (next/image, WebP, lazy loading)
- [ ] Audit Lighthouse > 90 (Performance, A11y, SEO, Best Practices)
- [ ] Ajout du domaine backend à `next.config.ts` (remotePatterns)

---

## 🔵 PHASE 5 — DÉPLOIEMENT & INFRASTRUCTURE

- [ ] Variables d'environnement production (`.env.production`)
- [ ] Config `next.config.ts` pour domaine backend prod
- [ ] Deploy Vercel (frontend) + Hostinger (backend Django)
- [ ] Config CORS backend pour domaine Vercel
- [ ] DNS : `salma-studies.com` → Vercel (front) + `api.salma-studies.com` → Hostinger (back)
- [ ] Commande management Django : `generate_kpi` planifiée (cron Hostinger)
- [ ] Migration SQLite → PostgreSQL/MySQL (prod)
- [ ] Test end-to-end post-déploiement

---

## 🗂️ ARCHITECTURE CIBLE (Séparation des responsabilités)

```
Composant (UI) 
    ↓ connaît uniquement
Dictionnaire de données (`/dictionaries/data/`)
    ↓ appelle
Repository (`/repositories/`)
    ↓ appelle
api-client.ts
    ↓ appelle
Backend Django (REST API)
```

**Règles d'or :**
- Les Server Components fetchent via les dictionnaires de données uniquement
- Les Client Components utilisent des hooks ou reçoivent les données en props
- Zéro appel fetch direct dans un composant UI
- Tout texte visible → dictionnaire i18n (fr/en)
- Tout champ de bourse → soumis au `field_visibility` de l'admin

---

## 📌 ORDRE D'EXÉCUTION RECOMMANDÉ

1. **Types TypeScript** (1.1) — base de tout
2. **Repositories** (1.2) — briques d'accès API
3. **Auth JWT** (1.4) — protège le dashboard
4. **Dictionnaires de données** (1.3) — orchestration
5. **Dashboard bourses CRUD** (3.2) — valeur immédiate pour le client
6. **Dashboard CMS** (3.3) — autonomie totale du boss
7. **Vitrine dynamique** (2.x) — liaison backend
8. **KPI Dashboard** (3.8) — analytics
9. **Chatbot Gemini** (4.1)
10. **Polish UX** (4.2, 4.3) + Déploiement (Phase 5)

// END OF FILE: todo.md


// FILE: tsconfig.json
-----------------------------------------------
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}


// END OF FILE: tsconfig.json

